(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,212180,e=>{"use strict";var s=e.i(843476),t=e.i(271645),a=e.i(266027),r=e.i(437453),i=e.i(908406),l=e.i(380759),n=e.i(402971),d=e.i(13642),o=e.i(515288),c=e.i(519455),m=e.i(793479),x=e.i(110204),h=e.i(487486),u=e.i(302747),p=e.i(776639),j=e.i(967489),g=e.i(248425),f=t.forwardRef((e,t)=>{let{ratio:a=1,style:r,...i}=e;return(0,s.jsx)("div",{style:{position:"relative",width:"100%",paddingBottom:`${100/a}%`},"data-radix-aspect-ratio-wrapper":"",children:(0,s.jsx)(g.Primitive.div,{...i,ref:t,style:{...r,position:"absolute",top:0,right:0,bottom:0,left:0}})})});f.displayName="AspectRatio";var b=e.i(74223);e.i(573690);var y=e.i(829682),v=e.i(653145),N=e.i(994814),w=e.i(50270),C=e.i(954616),k=e.i(903133),S=e.i(531278),D=e.i(514764);let P=w.z.object({friendName:w.z.string().min(2,"Friend's name is required"),friendPhone:w.z.string().min(10,"Valid phone number is required"),friendEmail:w.z.string().email("Valid email is required").optional().or(w.z.literal(""))});function $({open:e,onOpenChange:a,customerName:l,customerPhone:n,customerId:d,referralCode:o}){let{toast:x}=(0,i.useToast)(),[h,u]=(0,t.useState)(!0),[j,g]=(0,t.useState)(!0),f=(0,v.useForm)({resolver:(0,N.zodResolver)(P),defaultValues:{friendName:"",friendPhone:"",friendEmail:""}}),b=(0,C.useMutation)({mutationFn:async e=>(0,r.apiRequest)("POST","/api/referrals/send",{referrerName:l,referrerPhone:n,referrerCustomerId:parseInt(d),referralCode:o,refereeName:e.friendName,refereePhone:e.friendPhone,refereeEmail:e.friendEmail||void 0,sendEmail:h&&!!e.friendEmail,sendSMS:j}),onSuccess:()=>{x({title:"Referral sent!",description:"Your friend will receive an SMS and email about your referral."}),f.reset(),a(!1)},onError:e=>{x({title:"Failed to send referral",description:e.message||"Please try again",variant:"destructive"})}});return(0,s.jsx)(p.Dialog,{open:e,onOpenChange:a,children:(0,s.jsxs)(p.DialogContent,{className:"sm:max-w-md",children:[(0,s.jsxs)(p.DialogHeader,{children:[(0,s.jsx)(p.DialogTitle,{children:"Send a Referral"}),(0,s.jsx)(p.DialogDescription,{children:"Invite your friend to Economy Plumbing and you'll both benefit! They get $25 off and you earn credits."})]}),(0,s.jsx)(k.Form,{...f,children:(0,s.jsxs)("form",{onSubmit:f.handleSubmit(e=>{b.mutate(e)}),className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2 p-3 bg-muted rounded-lg",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:"Your Information"}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground space-y-1",children:[(0,s.jsx)("p",{children:l}),(0,s.jsx)("p",{children:n})]})]}),(0,s.jsx)(k.FormField,{control:f.control,name:"friendName",render:({field:e})=>(0,s.jsxs)(k.FormItem,{children:[(0,s.jsx)(k.FormLabel,{children:"Friend's Name"}),(0,s.jsx)(k.FormControl,{children:(0,s.jsx)(m.Input,{placeholder:"John Smith",...e,"data-testid":"input-friend-name"})}),(0,s.jsx)(k.FormMessage,{})]})}),(0,s.jsx)(k.FormField,{control:f.control,name:"friendPhone",render:({field:e})=>(0,s.jsxs)(k.FormItem,{children:[(0,s.jsx)(k.FormLabel,{children:"Friend's Phone Number"}),(0,s.jsx)(k.FormControl,{children:(0,s.jsx)(m.Input,{type:"tel",placeholder:"(512) 555-1234",...e,"data-testid":"input-friend-phone"})}),(0,s.jsx)(k.FormDescription,{children:"They'll receive an SMS with your referral link"}),(0,s.jsx)(k.FormMessage,{})]})}),(0,s.jsx)(k.FormField,{control:f.control,name:"friendEmail",render:({field:e})=>(0,s.jsxs)(k.FormItem,{children:[(0,s.jsx)(k.FormLabel,{children:"Friend's Email (Optional)"}),(0,s.jsx)(k.FormControl,{children:(0,s.jsx)(m.Input,{type:"email",placeholder:"friend@example.com",...e,"data-testid":"input-friend-email"})}),(0,s.jsx)(k.FormDescription,{children:"They'll also receive an email with your referral link"}),(0,s.jsx)(k.FormMessage,{})]})}),(0,s.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,s.jsx)(c.Button,{type:"submit",className:"flex-1",disabled:b.isPending,"data-testid":"button-send-referral",children:b.isPending?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(S.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(D.Send,{className:"w-4 h-4 mr-2"}),"Send Referral"]})}),(0,s.jsx)(c.Button,{type:"button",variant:"outline",onClick:()=>a(!1),"data-testid":"button-cancel",children:"Cancel"})]})]})})]})})}var F=e.i(284614),T=e.i(761911),E=e.i(87316),I=e.i(178583),B=e.i(212426),H=e.i(503116),M=e.i(269638),A=e.i(63209),L=e.i(343432),O=e.i(263488),U=e.i(730699),R=e.i(790597),W=e.i(243553),V=e.i(870273),Y=e.i(98919),z=e.i(195116),q=e.i(346897),J=e.i(694351),G=e.i(686311),K=e.i(662031),_=e.i(174886),Q=e.i(643531),X=e.i(25652),Z=e.i(475254);let ee=(0,Z.default)("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);var es=e.i(607486);let et=(0,Z.default)("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);var ea=e.i(868127);function er(){let e,g,v,N,w,C,k,S,D,P,Z,er,ei,el,en,ed,eo,ec,[em,ex]=(0,t.useState)(""),[eh,eu]=(0,t.useState)("email"),[ep,ej]=(0,t.useState)(null),[eg,ef]=(0,t.useState)(null),[eb,ey]=(0,t.useState)(null),[ev,eN]=(0,t.useState)(!1),[ew,eC]=(0,t.useState)(!1),[ek,eS]=(0,t.useState)(!1),[eD,eP]=(0,t.useState)([]),[e$,eF]=(0,t.useState)([]),[eT,eE]=(0,t.useState)(!1),[eI,eB]=(0,t.useState)("lookup"),[eH,eM]=(0,t.useState)(""),[eA,eL]=(0,t.useState)(""),[eO,eU]=(0,t.useState)(!1),[eR,eW]=(0,t.useState)(""),[eV,eY]=(0,t.useState)(""),[ez,eq]=(0,t.useState)(""),[eJ,eG]=(0,t.useState)(!1),[eK,e_]=(0,t.useState)(!1),[eQ,eX]=(0,t.useState)(!1),[eZ,e0]=(0,t.useState)(null),[e2,e1]=(0,t.useState)(""),[e4,e5]=(0,t.useState)(""),[e3,e6]=(0,t.useState)(!1),[e8,e7]=(0,t.useState)(!1),[e9,se]=(0,t.useState)(""),[ss,st]=(0,t.useState)(""),[sa,sr]=(0,t.useState)(!1),[si,sl]=(0,t.useState)(!1),[sn,sd]=(0,t.useState)(null),[so,sc]=(0,t.useState)(!1),[sm,sx]=(0,t.useState)(!1),[sh,su]=(0,t.useState)(""),[sp,sj]=(0,t.useState)(""),[sg,sf]=(0,t.useState)(""),[sb,sy]=(0,t.useState)(""),[sv,sN]=(0,t.useState)(!1),[sw,sC]=(0,t.useState)(null),[sk,sS]=(0,t.useState)(!1),[sD,sP]=(0,t.useState)(""),[s$,sF]=(0,t.useState)(""),[sT,sE]=(0,t.useState)(""),[sI,sB]=(0,t.useState)(""),[sH,sM]=(0,t.useState)(""),[sA,sL]=(0,t.useState)(!1),[sO,sU]=(0,t.useState)(!1),[sR,sW]=(0,t.useState)(0),[sV,sY]=(0,t.useState)(""),[sz,sq]=(0,t.useState)(!1),[sJ,sG]=(0,t.useState)(!1),[sK,s_]=(0,t.useState)(null),sQ=(0,y.usePhoneConfig)(),{toast:sX}=(0,i.useToast)(),{data:sZ,isLoading:s0,error:s2}=(0,a.useQuery)({queryKey:["/api/servicetitan/customer",ep],enabled:!!ep}),{data:s1}=(0,a.useQuery)({queryKey:["/api/referrals/customer",ep],enabled:!!ep}),{data:s4}=(0,a.useQuery)({queryKey:["/api/referrals/code",ep],enabled:!!ep}),{data:s5}=(0,a.useQuery)({queryKey:["/api/servicetitan/arrival-windows"]}),{data:s3}=(0,a.useQuery)({queryKey:["/api/portal/customer-stats",ep],enabled:!!ep}),{data:s6}=(0,a.useQuery)({queryKey:["/api/portal/customer-locations",ep],enabled:!!ep}),{data:s8}=(0,a.useQuery)({queryKey:["/api/portal/customer",ep,"emails"],enabled:!!ep}),s7=s5?.windows||[],s9=s6?.locations||[],te=sZ?.appointments.filter(e=>{let s=new Date(e.start)>new Date,t=!["Done","Completed","Cancelled"].includes(e.status);return s&&t})||[],ts=sZ?.appointments.filter(e=>{let s=new Date(e.start)<=new Date,t=["Done","Completed","Cancelled"].includes(e.status);return s||t})||[];(0,t.useEffect)(()=>{let e=new URLSearchParams(window.location.search).get("token");e?ta(e):tt()},[]);let tt=async()=>{try{let e=await fetch("/api/portal/session");if(e.ok){let s=await e.json();s.customerId&&(console.log("[Portal] Found active session, auto-logging in..."),ej(s.customerId.toString()),eF(s.availableCustomerIds||[s.customerId]),eB("authenticated"))}}catch(e){console.log("[Portal] No active session found")}},ta=async e=>{eU(!0);try{let s=await fetch("/api/portal/auth/verify-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contactValue:"",code:e})});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||"Invalid or expired magic link")}let t=await s.json();if(t.customers&&t.customers.length>1)eP(t.customers),eF(t.customers.map(e=>e.id)),eB("select-account"),ey("Please select which account you'd like to access");else if(t.customers&&1===t.customers.length){let e=t.customers[0].id.toString();ej(e),eF([t.customers[0].id]),eB("authenticated"),ey("Welcome to your customer portal!")}else if(t.customerId){let e=t.customerId.toString();ej(e),eF([t.customerId]),eB("authenticated"),ey("Welcome to your customer portal!")}else throw Error("No customer data returned");ef(null),window.history.replaceState({},document.title,window.location.pathname)}catch(e){console.error("Magic link verification failed:",e),ef(e.message||"The magic link is invalid or has expired. Please try again."),ey(null)}finally{eU(!1)}},tr=async()=>{if(em.trim()){ef(null),ey(null),eN(!0);try{let e=await fetch("/api/portal/auth/send-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contactValue:em,verificationType:"phone"===eh?"sms":"email"})});if(!e.ok){let s=await e.json().catch(()=>({}));throw Error(s.error||"Customer not found")}let s=await e.json();eB("verify-code"),eL(s.message),ey(s.message)}catch(e){console.error("Customer lookup failed:",e),ef(e.message||"We couldn't find an account with that information. Please verify and try again.")}finally{eN(!1)}}},ti=async()=>{if(eH.trim()){ef(null),ey(null),eU(!0);try{let e=await fetch("/api/portal/auth/verify-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contactValue:em,code:eH})});if(!e.ok){let s=await e.json().catch(()=>({}));throw Error(s.error||"Invalid verification code")}let s=await e.json();if(s.customers&&s.customers.length>1)eP(s.customers),eF(s.customers.map(e=>e.id)),eB("select-account"),ey("Please select which account you'd like to access");else if(s.customers&&1===s.customers.length){let e=s.customers[0].id.toString();ej(e),eF([s.customers[0].id]),eB("authenticated"),ey("Welcome to your customer portal!")}else if(s.customerId){let e=s.customerId.toString();ej(e),eF([s.customerId]),eB("authenticated"),ey("Welcome to your customer portal!")}else throw Error("No customer data returned")}catch(e){console.error("Verification failed:",e),ef(e.message||"Invalid verification code. Please try again.")}finally{eU(!1)}}},tl=async e=>{try{if("select-account"===eI)ej(e.toString()),eB("authenticated"),eE(!1);else{if(!(await fetch("/api/portal/switch-account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:e})})).ok)throw Error("Failed to switch account");ej(e.toString()),eE(!1),r.queryClient.invalidateQueries({queryKey:["/api/servicetitan/customer"]})}}catch(e){console.error("Account switch error:",e),ef("Failed to switch account. Please try again.")}},tn=async()=>{if(e$.length>1)try{let e=e$.map(async e=>{let s=await fetch(`/api/servicetitan/customer/${e}`),t=await s.json();return{id:t.customer.id,name:t.customer.name,type:"Residential",address:t.customer.address?[t.customer.address.street,t.customer.address.city,t.customer.address.state].filter(Boolean).join(", "):void 0}}),s=await Promise.all(e);eP(s),eE(!0)}catch(e){console.error("Failed to load account details:",e),ef("Failed to load account details")}},td=()=>{eB("lookup"),eM(""),ef(null),eL(""),eW(""),eY(""),eq("")},to=async()=>{if(eR.trim()){ef(null),ey(null),eG(!0);try{let e=await fetch("/api/portal/auth/lookup-by-phone",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:eR})});if(!e.ok){let s=await e.json().catch(()=>({}));throw Error(s.error||"Account not found")}let s=await e.json();eY(s.maskedEmail),eq(s.lookupToken),eB("phone-email-found"),ey(`We found your account! We'll send a login link to ${s.maskedEmail}`)}catch(e){console.error("Phone lookup failed:",e),ef(e.message||"We couldn't find an account with that phone number.")}finally{eG(!1)}}},tc=async()=>{ef(null),ey(null),e_(!0);try{let e=await fetch("/api/portal/auth/send-phone-magic-link",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lookupToken:ez})});if(!e.ok){let s=await e.json().catch(()=>({}));throw Error(s.error||"Failed to send login link")}let s=await e.json();ey(s.message||`Magic link sent to ${eV}! Check your email.`),sX({title:"Check your email!",description:`We've sent a login link to ${eV}`})}catch(e){console.error("Send magic link failed:",e),ef(e.message||"Failed to send login link. Please try again.")}finally{e_(!1)}},tm=async()=>{if(eZ&&e2&&e4&&ep){e6(!0);try{let[e,s]=e4.split("-");if(!s7.find(e=>`${e.start}-${e.end}`===e4))throw Error("Invalid time window selected");let t=new Date(`${e2}T${e}:00`),a=new Date(`${e2}T${s}:00`),r=await fetch("/api/portal/reschedule-appointment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appointmentId:eZ.id,newStart:t.toISOString(),newEnd:a.toISOString(),customerId:ep})}),i=await r.json();if(!r.ok)throw Error(i.error||"Failed to reschedule appointment");window.location.reload(),eX(!1)}catch(e){console.error("Reschedule error:",e)}finally{e6(!1)}}},tx=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),th=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),tu=async()=>{if(s4?.url)try{await navigator.clipboard.writeText(s4.url),eC(!0),setTimeout(()=>eC(!1),2e3)}catch(e){console.error("Copy failed:",e)}},tp=async(e,s,t,a)=>{try{if(!(await fetch("/api/portal/request-pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:e,number:s,id:t,customerId:a.customerId,customerName:a.customerName,customerEmail:a.customerEmail})})).ok)throw Error("Failed to send request");sX({title:"PDF Request Received",description:`We'll email the ${e} PDF to ${a.customerEmail} by the next business day.`})}catch(e){console.error("PDF request failed:",e),sX({title:"Request Failed",description:"Unable to send the PDF request. Please try again or contact support.",variant:"destructive"})}},tj=async()=>{if(ep){sr(!0);try{if(!(await fetch("/api/portal/update-contacts",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:parseInt(ep),email:e9,phone:ss})})).ok)throw Error("Failed to update contacts");e7(!1),window.location.reload()}catch(e){console.error("Update contacts error:",e)}finally{sr(!1)}}},tg=async()=>{try{if(!(await fetch("/api/portal/logout",{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw Error("Failed to logout");ej(null),eF([]),eB("lookup"),eu("phone"),ex(""),eM(""),sX({title:"Signed out",description:"You have been successfully signed out."})}catch(e){console.error("Logout error:",e),sX({title:"Error",description:"Failed to sign out. Please try again.",variant:"destructive"})}},tf=async()=>{if(ep&&sn){sc(!0);try{let e=await fetch("/api/portal/delete-contact",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:parseInt(ep),contactId:sn.id})});if(!e.ok){let s=await e.json().catch(()=>({error:"Failed to delete contact"}));throw Error(s.error||"Failed to delete contact")}sX({title:"Contact deleted",description:`${sn.type} successfully removed from your account.`}),sl(!1),sd(null),r.queryClient.invalidateQueries({queryKey:["/api/servicetitan/customer",ep]})}catch(e){console.error("Delete contact error:",e),sX({title:"Error deleting contact",description:e.message||"Failed to delete contact. Please try again.",variant:"destructive"})}finally{sc(!1)}}},tb=async()=>{if(ep&&sw&&sh&&sp&&sg&&sb){sN(!0);try{if(!(await fetch("/api/portal/update-address",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:parseInt(ep),locationId:sw,street:sh,city:sp,state:sg,zip:sb})})).ok)throw Error("Failed to update address");sx(!1),window.location.reload()}catch(e){console.error("Update address error:",e)}finally{sN(!1)}}},ty=e=>new Date(e).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),tv=e=>{let t=e.toLowerCase();return t.includes("scheduled")||t.includes("pending")?(0,s.jsxs)(h.Badge,{variant:"secondary","data-testid":`badge-status-${e}`,children:[(0,s.jsx)(H.Clock,{className:"w-3 h-3 mr-1"}),e]}):t.includes("completed")||t.includes("paid")?(0,s.jsxs)(h.Badge,{"data-testid":`badge-status-${e}`,children:[(0,s.jsx)(M.CheckCircle,{className:"w-3 h-3 mr-1"}),e]}):t.includes("cancelled")||t.includes("overdue")?(0,s.jsxs)(h.Badge,{variant:"destructive","data-testid":`badge-status-${e}`,children:[(0,s.jsx)(A.AlertCircle,{className:"w-3 h-3 mr-1"}),e]}):(0,s.jsx)(h.Badge,{variant:"outline","data-testid":`badge-status-${e}`,children:e})},tN=e=>e.expirationStatus?"expired"===e.expirationStatus?(0,s.jsxs)(h.Badge,{variant:"destructive",className:"text-xs",children:[(0,s.jsx)(A.AlertCircle,{className:"w-3 h-3 mr-1"}),"Expired"]}):"expiring_soon"===e.expirationStatus?(0,s.jsxs)(h.Badge,{variant:"secondary",className:"text-xs bg-yellow-500/10 text-yellow-600 dark:text-yellow-400",children:[(0,s.jsx)(H.Clock,{className:"w-3 h-3 mr-1"}),"Expires in ",e.daysUntilExpiration," days"]}):e.daysUntilExpiration<30?(0,s.jsxs)(h.Badge,{variant:"outline",className:"text-xs",children:["Valid for ",e.daysUntilExpiration," days"]}):null:null;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.SEOHead,{title:"Customer Portal - Economy Plumbing Services",description:"Access your service history, appointments, and invoices. View your Economy Plumbing Services account information and upcoming appointments."}),(0,s.jsx)(n.default,{isPortalAuthenticated:"authenticated"===eI,onPortalLogout:tg}),(0,s.jsx)("main",{className:"min-h-screen py-12 px-4",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,s.jsxs)("div",{className:"text-center mb-12",children:[(0,s.jsx)("h1",{className:"text-4xl md:text-5xl font-bold mb-4",children:"authenticated"===eI&&sZ?(e=new Date().getHours(),g=new Date().getDay(),v=new Date().getMonth(),N=s3?.serviceCount||0,w=sZ.customer.name?.split(" ")[0]||"there",C=[],e<12?(C.push(`Good morning, ${w}!`),C.push(`Rise and shine, ${w}!`),C.push(`Morning, ${w}! Ready to tackle the day?`)):e<17?(C.push(`Good afternoon, ${w}!`),C.push(`Hey ${w}, hope your day is going well!`),C.push(`Afternoon, ${w}!`)):(C.push(`Good evening, ${w}!`),C.push(`Evening, ${w}!`),C.push(`Hey ${w}, winding down for the day?`)),1===g?(C.push(`Happy Monday, ${w}!`),C.push(`Monday motivation, ${w}!`)):5===g?(C.push(`TGIF, ${w}!`),C.push(`Happy Friday, ${w}!`)):(0===g||6===g)&&(C.push(`Happy weekend, ${w}!`),C.push(`Enjoying your weekend, ${w}?`)),N>20?(C.push(`Welcome back, ${w}! You're practically family!`),C.push(`Hey ${w}, our VIP customer!`),C.push(`${w}, always great to see you!`)):N>10?(C.push(`Welcome back, ${w}! Thanks for your loyalty!`),C.push(`Great to see you again, ${w}!`)):N>5?(C.push(`Welcome back, ${w}!`),C.push(`Good to see you, ${w}!`)):0===N?(C.push(`Welcome, ${w}! Excited to serve you!`),C.push(`Hello ${w}! Let's get started!`)):(C.push(`Welcome back, ${w}!`),C.push(`Hello again, ${w}!`)),11===v?(C.push(`Happy holidays, ${w}!`),C.push(`Season's greetings, ${w}!`)):0===v?C.push(`Happy New Year, ${w}!`):6===v||7===v?(C.push(`Enjoying the summer, ${w}?`),C.push(`Stay cool, ${w}!`)):2===v||3===v?C.push(`Happy spring, ${w}!`):(9===v||10===v)&&C.push(`Happy fall, ${w}!`),C.push(`Hey ${w}! How can we help today?`),C.push(`${w}, great to have you here!`),C.push(`Welcome, ${w}!`),C.push(`Hello ${w}! What brings you here today?`),C.push(`${w}, we're here to help!`),k=Math.floor(Math.random()*C.length),C[k]):"Customer Portal"}),(0,s.jsx)("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"authenticated"===eI?"Your service history, appointments, and account details":"Access your service history, appointments, and invoices"})]}),ep?(0,s.jsx)("div",{className:"space-y-6",children:s0?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center space-y-4 p-8 max-w-md",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-primary border-t-transparent mx-auto"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold",children:"Loading Your Account"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"We're fetching your service history, appointments, and account details..."})]})]})}),(0,s.jsxs)("div",{className:"space-y-6 opacity-30 pointer-events-none",children:[(0,s.jsxs)(o.Card,{children:[(0,s.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(u.Skeleton,{className:"h-8 w-8 rounded-full"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(u.Skeleton,{className:"h-6 w-32 mb-2"}),(0,s.jsx)(u.Skeleton,{className:"h-4 w-24"})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(u.Skeleton,{className:"h-10 w-32"}),(0,s.jsx)(u.Skeleton,{className:"h-10 w-28"}),(0,s.jsx)(u.Skeleton,{className:"h-10 w-24"})]})]}),(0,s.jsx)(o.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(u.Skeleton,{className:"h-4 w-32"}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsx)(u.Skeleton,{className:"h-20"}),(0,s.jsx)(u.Skeleton,{className:"h-20"})]}),(0,s.jsx)(u.Skeleton,{className:"h-4 w-32 mt-6"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(u.Skeleton,{className:"h-20"}),(0,s.jsx)(u.Skeleton,{className:"h-20"})]})]})})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,s.jsxs)(o.Card,{children:[(0,s.jsxs)(o.CardHeader,{children:[(0,s.jsx)(u.Skeleton,{className:"h-6 w-48"}),(0,s.jsx)(u.Skeleton,{className:"h-4 w-32 mt-2"})]}),(0,s.jsx)(o.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(u.Skeleton,{className:"h-32"}),(0,s.jsx)(u.Skeleton,{className:"h-32"})]})})]}),(0,s.jsxs)(o.Card,{children:[(0,s.jsxs)(o.CardHeader,{children:[(0,s.jsx)(u.Skeleton,{className:"h-6 w-40"}),(0,s.jsx)(u.Skeleton,{className:"h-4 w-28 mt-2"})]}),(0,s.jsx)(o.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(u.Skeleton,{className:"h-32"}),(0,s.jsx)(u.Skeleton,{className:"h-32"})]})})]})]}),(0,s.jsxs)(o.Card,{children:[(0,s.jsxs)(o.CardHeader,{children:[(0,s.jsx)(u.Skeleton,{className:"h-6 w-36"}),(0,s.jsx)(u.Skeleton,{className:"h-4 w-48 mt-2"})]}),(0,s.jsx)(o.CardContent,{children:(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsx)(u.Skeleton,{className:"h-40"}),(0,s.jsx)(u.Skeleton,{className:"h-40"})]})})]})]})]}):s2?(0,s.jsx)(o.Card,{children:(0,s.jsx)(o.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)(A.AlertCircle,{className:"w-12 h-12 mx-auto mb-4 text-destructive"}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Error Loading Data"}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:"We couldn't load your account information. Please try again."}),(0,s.jsx)(c.Button,{onClick:()=>ej(null),"data-testid":"button-try-again",children:"Try Again"})]})})}):sZ?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(o.Card,{children:[(0,s.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-4 flex-wrap",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(F.User,{className:"w-8 h-8 text-primary"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(o.CardTitle,{children:sZ.customer.name}),(0,s.jsx)(o.CardDescription,{children:"Customer Account"})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,s.jsxs)(c.Button,{onClick:b.openScheduler,"data-testid":"button-schedule-appointment",children:[(0,s.jsx)(E.Calendar,{className:"w-4 h-4 mr-2"}),"Schedule Appointment"]}),(0,s.jsx)(c.Button,{asChild:!0,variant:"outline","data-testid":"button-call",children:(0,s.jsxs)("a",{href:`tel:${sQ.tel}`,children:[(0,s.jsx)(L.Phone,{className:"w-4 h-4 mr-2"}),"Call ",sQ.display]})}),(0,s.jsx)(c.Button,{asChild:!0,variant:"outline","data-testid":"button-text",children:(0,s.jsxs)("a",{href:`sms:${sQ.tel}`,children:[(0,s.jsx)(G.MessageSquare,{className:"w-4 h-4 mr-2"}),"Text Us"]})}),(0,s.jsxs)(c.Button,{variant:"outline","data-testid":"button-email-us",onClick:()=>{sE(sZ?.customer?.name||""),sB(sZ?.customer?.email||""),sM(sZ?.customer?.phoneNumber||""),sP(""),sF(""),sS(!0)},children:[(0,s.jsx)(O.Mail,{className:"w-4 h-4 mr-2"}),"Email Us"]}),e$.length>1&&(0,s.jsxs)(c.Button,{variant:"outline",onClick:tn,"data-testid":"button-switch-account",children:[(0,s.jsx)(T.Users,{className:"w-4 h-4 mr-2"}),"Switch Account"]})]})]}),(0,s.jsx)(o.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold",children:"Contact Information"}),(0,s.jsx)(c.Button,{variant:"ghost",size:"sm",onClick:()=>{sZ&&(se(sZ.customer.email||""),st(sZ.customer.phoneNumber||""),e7(!0))},"data-testid":"button-edit-contacts",children:"Edit"})]}),sZ.customer.contacts&&sZ.customer.contacts.length>0?(0,s.jsx)("div",{className:"space-y-3",children:sZ.customer.contacts.map((e,t)=>{let a="Email"===e.type,r="Phone"===e.type||"MobilePhone"===e.type;return a||r?(0,s.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-lg",children:[a?(0,s.jsx)(O.Mail,{className:"w-4 h-4 text-primary flex-shrink-0 mt-0.5"}):(0,s.jsx)(L.Phone,{className:"w-4 h-4 text-primary flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-0.5",children:"MobilePhone"===e.type?"Mobile":e.type}),(0,s.jsx)("p",{className:"font-medium break-all","data-testid":`contact-${e.type.toLowerCase()}-${t}`,children:e.value}),e.memo&&"email"!==e.memo&&"Phone"!==e.memo&&"mobile"!==e.memo&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5",children:e.memo})]}),(0,s.jsx)(c.Button,{variant:"ghost",size:"sm",onClick:()=>{sd({id:e.id,type:e.type,value:e.value}),sl(!0)},"data-testid":`button-delete-contact-${e.id}`,className:"flex-shrink-0 text-destructive hover:text-destructive",children:"Delete"})]},e.id):null})}):(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Phone"}),(0,s.jsx)("p",{className:"font-medium","data-testid":"text-customer-phone",children:sZ.customer.phoneNumber||"Not provided"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Email"}),(0,s.jsx)("p",{className:"font-medium","data-testid":"text-customer-email",children:sZ.customer.email||"Not provided"})]})]})]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsx)(f,{ratio:1,children:(S=sZ.memberships&&sZ.memberships.length>0?sZ.memberships[0]:null,D=S?.membershipType?.toLowerCase()||"",P={bgClass:"bg-background",borderClass:"border-primary/20",iconClass:"text-primary",icon:W.Crown,name:"VIP"},D.includes("platinum")?P={bgClass:"bg-gradient-to-br from-purple-50 to-slate-50 dark:from-purple-950/20 dark:to-slate-950/20",borderClass:"border-purple-300/50 dark:border-purple-700/50",iconClass:"text-purple-600 dark:text-purple-400",icon:W.Crown,name:"Platinum"}:D.includes("silver")?P={bgClass:"bg-gradient-to-br from-slate-50 to-gray-50 dark:from-slate-900/20 dark:to-gray-900/20",borderClass:"border-slate-300/50 dark:border-slate-600/50",iconClass:"text-slate-600 dark:text-slate-400",icon:Y.Shield,name:"Silver"}:D.includes("rental")?P={bgClass:"bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20",borderClass:"border-blue-300/50 dark:border-blue-700/50",iconClass:"text-blue-600 dark:text-blue-400",icon:es.Building2,name:"Rental"}:D.includes("commercial")&&(P={bgClass:"bg-gradient-to-br from-slate-900 to-slate-800 dark:from-slate-950 dark:to-slate-900",borderClass:"border-amber-400/50 dark:border-amber-500/50",iconClass:"text-amber-500 dark:text-amber-400",icon:et,name:"Commercial"}),Z=P.icon,er=S?.isExpired||!1,ei=S&&!er,(0,s.jsx)(o.Card,{className:`hover-elevate w-full h-full overflow-hidden cursor-pointer border-2 ${P.borderClass} ${P.bgClass}`,"data-testid":"card-vip-status",onClick:()=>{let e=document.getElementById("vip-membership-section");e?.scrollIntoView({behavior:"smooth",block:"start"})},children:(0,s.jsxs)(o.CardContent,{className:"p-4 flex flex-col items-center justify-center text-center w-full h-full relative",children:[(0,s.jsx)(Z,{className:`w-8 h-8 mb-2 ${P.iconClass}`}),ei?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"text-base font-bold mb-1",children:[P.name," Member"]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-1 truncate w-full px-2",children:S.membershipType}),S.expirationDate&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mb-1",children:["Until ",new Date(S.expirationDate).toLocaleDateString("en-US",{month:"short",year:"numeric"})]}),(0,s.jsx)(h.Badge,{variant:"default",className:"text-xs mt-1",children:"Active"})]}):er&&S?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"text-base font-bold mb-1",children:"Membership Expired"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-1 truncate w-full px-2",children:S.membershipType}),S.expirationDate&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mb-1",children:["Expired ",new Date(S.expirationDate).toLocaleDateString("en-US",{month:"short",year:"numeric"})]}),(0,s.jsx)(c.Button,{size:"sm",variant:"default",className:"text-xs mt-1",onClick:e=>{e.stopPropagation(),window.open("/vip-membership","_blank")},children:"Renew Now"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"text-base font-bold mb-1",children:"Not a Member"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:"Join our VIP Program"}),(0,s.jsx)(c.Button,{size:"sm",variant:"default",className:"text-xs",onClick:e=>{e.stopPropagation(),window.open("/vip-membership","_blank")},children:"Start Membership"})]}),(0,s.jsx)("p",{className:"text-xs text-primary mt-2 absolute bottom-2",children:"View Details ‚Üí"})]})}))}),s3&&(0,s.jsx)(f,{ratio:1,children:(()=>{if(0===s3.serviceCount||null===s3.topPercentile)return(0,s.jsx)(o.Card,{className:"hover-elevate w-full h-full overflow-hidden cursor-pointer","data-testid":"card-service-history",onClick:()=>{let e=document.getElementById("job-history-section");e?.scrollIntoView({behavior:"smooth",block:"start"})},children:(0,s.jsxs)(o.CardContent,{className:"p-4 flex flex-col items-center justify-center text-center w-full h-full relative",children:[(0,s.jsx)(J.Home,{className:"w-8 h-8 text-primary mb-2"}),(0,s.jsx)("div",{className:"text-base font-bold mb-1",children:"Welcome!"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:"New to Economy Plumbing"}),(0,s.jsx)(h.Badge,{variant:"secondary",className:"text-xs mb-1",children:"üéâ First Time Customer"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1 px-2 line-clamp-3",children:"We're excited to serve you! Schedule your first service or call us at (512) 259-7222 for any plumbing needs."}),(0,s.jsx)("p",{className:"text-xs text-primary mt-2 absolute bottom-2",children:"Get Started ‚Üí"})]})});let e=Math.min(99,100-s3.topPercentile),t="",a=R.Heart,r="default",i="‚≠ê";s3.topPercentile<=5?(t=`You're in our elite ${s3.topPercentile}%! You've had more services than ${e}% of our customers. Thank you for being such a loyal customer!`,a=V.Star,i="üåü",r="default"):s3.topPercentile<=25?(t=`You've had more services than ${e}% of our customers. We really appreciate your business!`,a=R.Heart,i="‚≠ê",r="default"):s3.topPercentile<=50?(t=`Thank you for choosing us! You've had more services than ${e}% of our customers.`,a=R.Heart,i="‚úì",r="secondary"):(t="We're here when you need us! Remember, we offer maintenance plans, emergency services, and more. Give us a call anytime at (512) 259-7222!",a=L.Phone,i="üìû",r="outline");let l=a;return(0,s.jsx)(o.Card,{className:"hover-elevate w-full h-full overflow-hidden cursor-pointer","data-testid":"card-service-history",onClick:()=>{let e=document.getElementById("job-history-section");e?.scrollIntoView({behavior:"smooth",block:"start"})},children:(0,s.jsxs)(o.CardContent,{className:"p-4 flex flex-col items-center justify-center text-center w-full h-full relative",children:[(0,s.jsx)(l,{className:"w-8 h-8 text-primary mb-2"}),(0,s.jsx)("div",{className:"text-base font-bold mb-1",children:s3.topPercentile<=5?"Elite Customer!":s3.topPercentile<=25?"Valued Customer!":s3.topPercentile<=50?"Thank You!":"We Miss You!"}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mb-2",children:[s3.serviceCount," service",1===s3.serviceCount?"":"s"," with us"]}),s3.topPercentile<=50&&(0,s.jsxs)(h.Badge,{variant:r,className:"text-xs mb-1",children:[i," Better than ",e,"%"]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1 px-2 line-clamp-3",children:t}),(0,s.jsx)("p",{className:"text-xs text-primary mt-2 absolute bottom-2",children:"View History ‚Üí"})]})})})()}),(0,s.jsx)(f,{ratio:1,children:(0,s.jsx)(o.Card,{className:"hover-elevate w-full h-full overflow-hidden cursor-pointer","data-testid":"card-referrals",onClick:()=>{let e=document.getElementById("referral-section");e?.scrollIntoView({behavior:"smooth",block:"start"})},children:(0,s.jsxs)(o.CardContent,{className:"p-4 flex flex-col items-center justify-center text-center w-full h-full relative",children:[(0,s.jsx)(K.Share2,{className:"w-8 h-8 text-primary mb-2"}),(el=(s1?.referrals.filter(e=>"credited"===e.status)||[]).reduce((e,s)=>e+(s.creditAmount||0),0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-primary mb-1","data-testid":"text-account-credit",children:tx(el/100)}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"Account Credit"}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[s1?.referrals.length||0," referral",s1?.referrals.length===1?"":"s"]})]})),(0,s.jsx)("p",{className:"text-xs text-primary mt-2 absolute bottom-2",children:"View Details ‚Üí"})]})})}),(0,s.jsx)(f,{ratio:1,children:(0,s.jsx)(o.Card,{className:"hover-elevate w-full h-full overflow-hidden cursor-pointer","data-testid":"card-upcoming-appointments",onClick:()=>{let e=document.getElementById("appointments-section");e?.scrollIntoView({behavior:"smooth",block:"start"})},children:(0,s.jsxs)(o.CardContent,{className:"p-4 flex flex-col items-center justify-center text-center w-full h-full relative",children:[(0,s.jsx)(E.Calendar,{className:"w-8 h-8 text-primary mb-2"}),te.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"text-base font-bold mb-1","data-testid":"text-next-appointment-date",children:new Date(te[0].start).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:ty(te[0].start)}),te[0].businessUnitName&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground truncate w-full px-1",children:te[0].businessUnitName}),te.length>1&&(0,s.jsxs)(h.Badge,{variant:"secondary",className:"text-xs mt-1",children:["+",te.length-1," more"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"text-base font-bold mb-1",children:"None Scheduled"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"No upcoming appointments"})]}),(0,s.jsx)("p",{className:"text-xs text-primary mt-2 absolute bottom-2",children:"View All ‚Üí"})]})})})]}),(ed=.15*(en=sZ.invoices.filter(e=>e.status.toLowerCase().includes("paid")||e.status.toLowerCase().includes("complete")).reduce((e,s)=>e+s.total,0)),eo=sZ.memberships&&sZ.memberships.length>0,en<100?null:(0,s.jsxs)(o.Card,{className:`border-2 ${eo?"border-primary/30 bg-gradient-to-br from-primary/10 via-primary/5 to-background":"border-amber-500/30 bg-gradient-to-br from-amber-500/10 via-amber-500/5 to-background"}`,children:[(0,s.jsx)(o.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${eo?"bg-primary/20":"bg-amber-500/20"}`,children:(0,s.jsx)(X.TrendingUp,{className:`w-6 h-6 ${eo?"text-primary":"text-amber-600 dark:text-amber-500"}`})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(o.CardTitle,{className:"text-2xl",children:eo?(0,s.jsxs)("span",{className:"text-primary",children:["You've Saved ",tx(ed)]}):(0,s.jsxs)("span",{className:"text-amber-600 dark:text-amber-500",children:["Save ",tx(ed)]})}),(0,s.jsx)(o.CardDescription,{className:"mt-1",children:eo?"with your VIP membership":"by becoming a VIP member"})]})]}),!eo&&(0,s.jsx)(h.Badge,{variant:"outline",className:"text-amber-600 border-amber-500/50 dark:text-amber-500",children:"Opportunity"})]})}),(0,s.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 bg-background/50 rounded-lg border",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Services"}),(0,s.jsx)("p",{className:"text-2xl font-bold","data-testid":"text-total-paid",children:tx(en)})]}),(0,s.jsx)(B.DollarSign,{className:"w-8 h-8 text-muted-foreground/30"})]}),eo?(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:["As a VIP member, you've enjoyed ",(0,s.jsx)("strong",{className:"text-primary",children:"member-only discounts"})," on every service call, plus priority scheduling, no trip charges, and waived diagnostic fees."]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg border border-primary/20",children:[(0,s.jsx)(M.CheckCircle,{className:"w-5 h-5 text-primary flex-shrink-0"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:"Your membership is saving you money on every visit!"})]})]}):(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:["Based on your service history, you could save approximately ",(0,s.jsx)("strong",{className:"text-amber-600 dark:text-amber-500",children:tx(ed)})," per year as a VIP member, plus enjoy priority scheduling, no trip charges, and waived diagnostic fees."]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground italic",children:"*Estimated savings based on typical 15% member discount applied to your historical spending"}),(0,s.jsx)(c.Button,{asChild:!0,className:"w-full bg-amber-600 hover:bg-amber-700 text-white dark:bg-amber-500 dark:hover:bg-amber-600",size:"lg","data-testid":"button-join-vip-savings",children:(0,s.jsxs)("a",{href:"/membership-benefits",children:[(0,s.jsx)(W.Crown,{className:"w-4 h-4 mr-2"}),"Start Saving with VIP Membership"]})})]})]})]})),(0,s.jsx)("div",{id:"vip-membership-section",children:sZ.memberships&&sZ.memberships.length>0?(0,s.jsxs)(o.Card,{className:"border-primary/20 bg-gradient-to-br from-primary/5 to-background",children:[(0,s.jsx)(o.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(W.Crown,{className:"w-6 h-6 text-primary"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(o.CardTitle,{children:"VIP Member"}),(0,s.jsx)(o.CardDescription,{className:"mt-1",children:sZ.memberships[0].membershipType})]})]}),(0,s.jsx)(h.Badge,{variant:"default",className:"text-xs bg-primary",children:sZ.memberships[0].status})]})}),(0,s.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid gap-3",children:[sZ.memberships[0].startDate&&(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Member Since"}),(0,s.jsx)("span",{className:"font-medium",children:new Date(sZ.memberships[0].startDate).toLocaleDateString("en-US",{month:"short",year:"numeric"})})]}),sZ.memberships[0].expirationDate&&(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Expires"}),(0,s.jsx)("span",{className:"font-medium",children:new Date(sZ.memberships[0].expirationDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),sZ.memberships[0].renewalDate&&(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Next Renewal"}),(0,s.jsx)("span",{className:"font-medium",children:new Date(sZ.memberships[0].renewalDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]}),(0,s.jsxs)("div",{className:"pt-3 border-t",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Your Benefits"}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(B.DollarSign,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,s.jsx)("span",{children:"Savings on EVERY service call"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(V.Star,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,s.jsx)("span",{children:"Priority same-day service"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(Y.Shield,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,s.jsx)("span",{children:"No trip charges"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(z.Wrench,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,s.jsx)("span",{children:"Annual plumbing inspection included"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(H.Clock,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,s.jsx)("span",{children:"After-hours service at regular rates"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(M.CheckCircle,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,s.jsx)("span",{children:"Waived diagnostic fees"})]})]})]})]})]}):(0,s.jsxs)(o.Card,{className:"border-primary/20 bg-gradient-to-br from-primary/5 to-background",children:[(0,s.jsx)(o.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(W.Crown,{className:"w-6 h-6 text-primary"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(o.CardTitle,{children:"VIP Membership"}),(0,s.jsx)(o.CardDescription,{className:"mt-1",children:"Not a VIP member yet"})]})]}),(0,s.jsx)(h.Badge,{variant:"outline",className:"text-xs",children:"Available"})]})}),(0,s.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Join our VIP Membership program and save on every service call, plus enjoy priority same-day service, no trip charges, and more!"}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(B.DollarSign,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"Savings on EVERY service call"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(V.Star,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"Priority same-day service"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(Y.Shield,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"No trip charges"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(z.Wrench,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"Annual plumbing inspection"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(H.Clock,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"After-hours service at regular rates"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(M.CheckCircle,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"Waived diagnostic fees"})]})]}),(0,s.jsx)("div",{className:"pt-2 border-t",children:(0,s.jsx)(c.Button,{asChild:!0,className:"w-full","data-testid":"button-vip-membership",children:(0,s.jsxs)("a",{href:"/vip-membership",children:[(0,s.jsx)(W.Crown,{className:"w-4 h-4 mr-2"}),"Learn About VIP Membership"]})})})]})]})}),s9.length>0&&(0,s.jsxs)(o.Card,{children:[(0,s.jsxs)(o.CardHeader,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(q.MapPin,{className:"w-6 h-6 text-primary"}),(0,s.jsxs)(o.CardTitle,{children:["Service Locations (",s9.length,")"]})]}),(0,s.jsx)(o.CardDescription,{children:1===s9.length?"Your service address":"All your service addresses"})]}),(0,s.jsxs)(o.CardContent,{className:"space-y-3",children:[s9.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-muted/30 rounded-lg border","data-testid":`location-card-${e.id}`,children:[(0,s.jsx)(J.Home,{className:"w-5 h-5 text-primary flex-shrink-0 mt-1"}),(0,s.jsxs)("div",{className:"flex-1",children:[e.name&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:e.name}),(0,s.jsx)("p",{className:"font-medium","data-testid":`text-location-street-${e.id}`,children:e.address.street}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.address.city,", ",e.address.state," ",e.address.zip]}),0===t&&s9.length>1&&(0,s.jsx)(h.Badge,{variant:"secondary",className:"mt-2 text-xs",children:"Primary"})]})]},e.id)),(0,s.jsx)("p",{className:"text-xs text-muted-foreground text-center pt-2",children:"Service addresses are managed by our team for security"})]})]}),0===(ec=sZ.estimates||[]).length?null:(0,s.jsxs)(o.Card,{children:[(0,s.jsxs)(o.CardHeader,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(I.FileText,{className:"w-6 h-6 text-primary"}),(0,s.jsx)(o.CardTitle,{children:"Open Estimates"})]}),(0,s.jsx)(o.CardDescription,{children:"Your pending estimates and quotes (valid for 30 days)"})]}),(0,s.jsx)(o.CardContent,{children:(0,s.jsx)("div",{className:"overflow-x-auto pb-2",children:(0,s.jsx)("div",{className:"flex gap-4 min-w-max",children:ec.map(e=>(0,s.jsx)(o.Card,{className:"w-80 flex-shrink-0 hover-elevate active-elevate-2 cursor-pointer",onClick:()=>{s_(e),sG(!0)},"data-testid":`estimate-card-${e.id}`,children:(0,s.jsxs)(o.CardContent,{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-3",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("h4",{className:"font-semibold",children:["Estimate #",e.estimateNumber]}),e.summary&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-1",children:e.summary})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1 items-end",children:[tv(e.status),tN(e)]})]}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Total:"}),(0,s.jsx)("span",{className:"font-semibold text-primary",children:tx(e.total)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Created:"}),(0,s.jsx)("span",{children:th(e.createdOn)})]}),e.expiresOn&&(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Expires:"}),(0,s.jsx)("span",{children:th(e.expiresOn)})]})]})]})},e.id))})})})]}),(0,s.jsx)("div",{id:"appointments-section",children:(0,s.jsxs)(o.Card,{children:[(0,s.jsxs)(o.CardHeader,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(E.Calendar,{className:"w-6 h-6 text-primary"}),(0,s.jsx)(o.CardTitle,{children:"Upcoming Appointments"})]}),(0,s.jsx)(o.CardDescription,{children:"Your scheduled service appointments"})]}),(0,s.jsx)(o.CardContent,{children:0===te.length?(0,s.jsx)("p",{className:"text-center py-8 text-muted-foreground","data-testid":"text-no-appointments",children:"No upcoming appointments"}):(0,s.jsx)("div",{className:"space-y-4",children:te.map(e=>(0,s.jsxs)("div",{className:"flex items-start gap-4 p-4 border rounded-lg","data-testid":`appointment-${e.id}`,children:[(0,s.jsx)(E.Calendar,{className:"w-5 h-5 text-primary mt-1"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold",children:e.jobType}),e.summary&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:e.summary})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[tv(e.status),(0,s.jsxs)(c.Button,{variant:"outline",size:"sm",onClick:()=>(e=>{if(e0(e),e1(new Date(e.start).toISOString().split("T")[0]),e.arrivalWindowStart&&e.arrivalWindowEnd&&s7.length>0){let s=new Date(e.arrivalWindowStart),t=new Date(e.arrivalWindowEnd),a=`${s.getUTCHours().toString().padStart(2,"0")}:${s.getUTCMinutes().toString().padStart(2,"0")}`,r=`${t.getUTCHours().toString().padStart(2,"0")}:${t.getUTCMinutes().toString().padStart(2,"0")}`,i=s7.find(e=>e.start===a&&e.end===r);i?e5(`${i.start}-${i.end}`):s7.length>0&&e5(`${s7[0].start}-${s7[0].end}`)}else s7.length>0&&e5(`${s7[0].start}-${s7[0].end}`);eX(!0)})(e),"data-testid":`button-reschedule-${e.id}`,children:[(0,s.jsx)(ee,{className:"w-4 h-4 mr-1"}),"Reschedule"]})]})]}),(0,s.jsxs)("div",{className:"text-sm space-y-1",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Date:"})," ",th(e.start)]}),e.arrivalWindowStart&&e.arrivalWindowEnd&&(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Arrival Window:"})," ",ty(e.arrivalWindowStart)," - ",ty(e.arrivalWindowEnd)]}),e.jobNumber&&(0,s.jsxs)("p",{className:"text-muted-foreground",children:["Job #",e.jobNumber]})]})]})]},e.id))})})]})}),(0,s.jsx)("div",{id:"job-history-section",children:(0,s.jsxs)(o.Card,{children:[(0,s.jsxs)(o.CardHeader,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(I.FileText,{className:"w-6 h-6 text-primary"}),(0,s.jsx)(o.CardTitle,{children:"Invoices"})]}),(0,s.jsx)(o.CardDescription,{children:"Your service invoices and payment history"})]}),(0,s.jsx)(o.CardContent,{children:0===sZ.invoices.length?(0,s.jsx)("p",{className:"text-center py-8 text-muted-foreground","data-testid":"text-no-invoices",children:"No invoices found"}):(0,s.jsx)("div",{className:"space-y-4",children:sZ.invoices.map(e=>(0,s.jsxs)("div",{className:"flex items-start gap-4 p-4 border rounded-lg","data-testid":`invoice-${e.id}`,children:[(0,s.jsx)(B.DollarSign,{className:"w-5 h-5 text-primary mt-1"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"font-semibold",children:["Invoice #",e.invoiceNumber]}),e.summary&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:e.summary})]}),tv(e.status)]}),(0,s.jsxs)("div",{className:"text-sm space-y-1",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:(0,s.jsx)("strong",{children:"Total:"})}),(0,s.jsx)("span",{className:"font-semibold",children:tx(e.total)})]}),e.balance>0&&(0,s.jsxs)("div",{className:"flex justify-between text-destructive",children:[(0,s.jsx)("span",{children:(0,s.jsx)("strong",{children:"Balance Due:"})}),(0,s.jsx)("span",{className:"font-semibold",children:tx(e.balance)})]}),(0,s.jsxs)("p",{className:"text-muted-foreground",children:["Created: ",th(e.createdOn)]}),e.dueDate&&(0,s.jsxs)("p",{className:"text-muted-foreground",children:["Due: ",th(e.dueDate)]}),e.jobNumber&&(0,s.jsxs)("p",{className:"text-muted-foreground",children:["Job #",e.jobNumber]})]}),(0,s.jsx)("div",{className:"mt-3 pt-3 border-t",children:(0,s.jsxs)(c.Button,{variant:"outline",size:"sm",onClick:()=>tp("invoice",e.invoiceNumber,e.id,{customerId:sZ.customer.id,customerName:sZ.customer.name,customerEmail:sZ.customer.email}),"data-testid":`button-request-invoice-pdf-${e.id}`,children:[(0,s.jsx)(I.FileText,{className:"w-4 h-4 mr-2"}),"Request PDF Copy"]})})]})]},e.id))})})]})}),(0,s.jsx)("div",{id:"referral-section",children:s4&&(0,s.jsxs)(o.Card,{className:"border-primary/20 bg-gradient-to-br from-primary/10 via-primary/5 to-background",children:[(0,s.jsx)(o.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center",children:(0,s.jsx)(U.Gift,{className:"w-6 h-6 text-primary"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(o.CardTitle,{children:"Referral Rewards Program"}),(0,s.jsx)(o.CardDescription,{className:"mt-1",children:s1?.referrals.length===0?"Start earning rewards today! Share your link below.":`You've referred ${s1?.referrals.length} ${s1?.referrals.length===1?"friend":"friends"} - thank you for spreading the word!`})]})]}),(0,s.jsx)(h.Badge,{variant:"default",className:"bg-primary",children:"Active"})]})}),(0,s.jsxs)(o.CardContent,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"p-4 bg-primary/10 rounded-lg border border-primary/20 text-center",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Your Referral Code"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-primary tracking-wide","data-testid":"text-referral-code",children:s4.code})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"referral-link",children:"Your Unique Referral Link"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(m.Input,{id:"referral-link",value:s4.url,readOnly:!0,className:"font-mono text-sm","data-testid":"input-referral-link"}),(0,s.jsx)(c.Button,{onClick:tu,variant:ew?"default":"outline",size:"icon",className:ew?"bg-green-600 hover:bg-green-700":"","data-testid":"button-copy-link",children:ew?(0,s.jsx)(Q.Check,{className:"w-4 h-4"}):(0,s.jsx)(_.Copy,{className:"w-4 h-4"})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-background rounded-lg border text-center",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Total Referrals"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-primary","data-testid":"text-total-referrals-stat",children:s1?.referrals.length||0})]}),(0,s.jsxs)("div",{className:"p-4 bg-background rounded-lg border text-center",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Conversions"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-primary","data-testid":"text-conversions",children:s4.conversions})]}),(0,s.jsxs)("div",{className:"p-4 bg-background rounded-lg border text-center",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Clicks"}),(0,s.jsx)("p",{className:"text-2xl font-bold","data-testid":"text-clicks",children:s4.clicks})]})]}),s1&&s1.referrals.length>0?(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h4",{className:"font-semibold",children:"Your Referrals"}),s1.referrals.slice(0,5).map(e=>{let t=e.referrerCustomerId===parseInt(ep);return(0,s.jsxs)("div",{className:"p-3 bg-background rounded-lg border",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-1",children:[(0,s.jsx)("p",{className:"font-medium text-sm",children:t?e.refereeName:e.referrerName}),(0,s.jsx)(h.Badge,{className:{pending:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100",contacted:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100",job_completed:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100",credited:"bg-primary/10 text-primary"}[e.status]||"bg-gray-100 text-gray-800","data-testid":`badge-referral-status-${e.id}`,children:e.status.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())})]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Submitted: ",new Date(e.submittedAt).toLocaleDateString()]}),"credited"===e.status&&e.creditAmount&&(0,s.jsxs)("p",{className:"text-xs text-primary font-medium mt-1",children:["Credit: $",(e.creditAmount/100).toFixed(2)]})]},e.id)}),s1.referrals.length>5&&(0,s.jsxs)("p",{className:"text-xs text-center text-muted-foreground",children:["Showing 5 most recent (",s1.referrals.length," total)"]})]}):s1&&(0,s.jsxs)("div",{className:"p-6 bg-gradient-to-r from-primary/5 via-primary/10 to-primary/5 rounded-lg border border-primary/20 text-center space-y-4",children:[(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(U.Gift,{className:"w-12 h-12 text-primary animate-pulse"})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h4",{className:"font-semibold text-lg",children:"Be the First to Start Earning!"}),(0,s.jsx)("p",{className:"text-muted-foreground max-w-md mx-auto",children:"You haven't made any referrals yet, but there's great potential waiting! Share your unique link with friends and family to start earning $25 rewards."}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"It's simple: they save $25, you earn $25. Everyone wins!"})]}),(0,s.jsxs)("div",{className:"flex flex-wrap justify-center gap-3 pt-2",children:[(0,s.jsxs)(c.Button,{onClick:()=>{let e=`Save $25 on your first plumbing service with Economy Plumbing! Use my referral link: ${s4.url}`,s=`https://twitter.com/intent/tweet?text=${encodeURIComponent(e)}`;window.open(s,"_blank","width=600,height=400")},variant:"outline",size:"sm",className:"gap-2","data-testid":"button-share-twitter",children:[(0,s.jsx)(K.Share2,{className:"w-4 h-4"}),"Share on X"]}),(0,s.jsxs)(c.Button,{onClick:()=>{let e=`Check out Economy Plumbing Services! Save $25 on your first service using my referral link: ${s4.url}`,s=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(s4.url)}&quote=${encodeURIComponent(e)}`;window.open(s,"_blank","width=600,height=400")},variant:"outline",size:"sm",className:"gap-2","data-testid":"button-share-facebook",children:[(0,s.jsx)(K.Share2,{className:"w-4 h-4"}),"Share on Facebook"]}),(0,s.jsxs)(c.Button,{onClick:()=>{let e=`Hi! I wanted to share this with you - Economy Plumbing Services has been amazing for us. You can save $25 on your first service using my referral link: ${s4.url}`,s=`mailto:?subject=Save $25 on Plumbing Services&body=${encodeURIComponent(e)}`;window.location.href=s},variant:"outline",size:"sm",className:"gap-2","data-testid":"button-share-email",children:[(0,s.jsx)(O.Mail,{className:"w-4 h-4"}),"Share via Email"]})]})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-background rounded-lg border",children:[(0,s.jsx)(U.Gift,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"You Get $25"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"When your referral completes a service of $200+"})]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-background rounded-lg border",children:[(0,s.jsx)(R.Heart,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"They Get $25"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Your friend saves on their first service call"})]})]})]}),(0,s.jsxs)(c.Button,{onClick:()=>eS(!0),className:"w-full",size:"lg","data-testid":"button-share-referral",children:[(0,s.jsx)(K.Share2,{className:"w-4 h-4 mr-2"}),"Share Referral Link"]})]})]})}),ts.length>0&&(0,s.jsxs)(o.Card,{className:"border-primary/20 bg-gradient-to-br from-primary/5 to-background",children:[(0,s.jsxs)(o.CardHeader,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(V.Star,{className:"w-6 h-6 text-primary fill-primary"}),(0,s.jsx)(o.CardTitle,{children:"Love Our Service?"})]}),(0,s.jsx)(o.CardDescription,{children:"Share your experience and help others find great plumbing service"})]}),(0,s.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-background rounded-lg border",children:[(0,s.jsx)(M.CheckCircle,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"Your Review Matters"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Help your neighbors find reliable plumbing service. Your honest feedback helps us improve and helps others make informed decisions."})]})]}),(0,s.jsxs)(c.Button,{className:"w-full",size:"lg","data-testid":"button-leave-review",onClick:()=>{sW(0),sY(""),sU(!0)},children:[(0,s.jsx)(V.Star,{className:"w-4 h-4 mr-2"}),"Leave a Review"]}),(0,s.jsx)("p",{className:"text-xs text-center text-muted-foreground",children:"Choose from Google, Facebook, BBB, or Yelp - takes just 2 minutes!"})]})]})]}):null}):"lookup"===eI?(0,s.jsxs)(o.Card,{className:"max-w-md mx-auto",children:[(0,s.jsxs)(o.CardHeader,{children:[(0,s.jsx)(o.CardTitle,{children:"Find Your Account"}),(0,s.jsx)(o.CardDescription,{children:"Enter your email address to access your account"})]}),(0,s.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"lookup-input",children:"Email Address"}),(0,s.jsx)(m.Input,{id:"lookup-input",type:"email",placeholder:"your@email.com",value:em,onChange:e=>ex(e.target.value),onKeyDown:e=>"Enter"===e.key&&tr(),"data-testid":"input-lookup"})]}),(0,s.jsx)(c.Button,{onClick:tr,className:"w-full",disabled:!em.trim()||ev,"data-testid":"button-lookup-submit",children:ev?"Searching...":"Access My Account"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,s.jsx)("span",{className:"w-full border-t"})}),(0,s.jsx)("div",{className:"relative flex justify-center text-xs uppercase",children:(0,s.jsx)("span",{className:"bg-background px-2 text-muted-foreground",children:"Or"})})]}),(0,s.jsxs)(c.Button,{variant:"outline",onClick:()=>eB("phone-lookup"),className:"w-full","data-testid":"button-phone-login",children:[(0,s.jsx)(L.Phone,{className:"w-4 h-4 mr-2"}),"Login with Phone Number"]}),eb&&(0,s.jsx)("div",{className:"bg-green-500/10 border border-green-500/20 rounded-lg p-4 text-sm",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(M.CheckCircle,{className:"w-5 h-5 text-green-600 dark:text-green-500 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"text-green-700 dark:text-green-400",children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"Success"}),(0,s.jsx)("p",{children:eb})]})]})}),eg&&(0,s.jsx)("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4 text-sm",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(A.AlertCircle,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"text-destructive",children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"Error"}),(0,s.jsx)("p",{children:eg})]})]})})]})]}):"phone-lookup"===eI?(0,s.jsxs)(o.Card,{className:"max-w-md mx-auto",children:[(0,s.jsxs)(o.CardHeader,{children:[(0,s.jsx)(o.CardTitle,{children:"Login with Phone Number"}),(0,s.jsx)(o.CardDescription,{children:"Enter your phone number and we'll send a login link to your email"})]}),(0,s.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"phone-lookup-input",children:"Phone Number"}),(0,s.jsx)(m.Input,{id:"phone-lookup-input",type:"tel",placeholder:"(512) 555-1234",value:eR,onChange:e=>eW(e.target.value),onKeyDown:e=>"Enter"===e.key&&to(),"data-testid":"input-phone-lookup"})]}),(0,s.jsx)(c.Button,{onClick:to,className:"w-full",disabled:!eR.trim()||eJ,"data-testid":"button-phone-lookup-submit",children:eJ?"Looking up...":"Find My Account"}),(0,s.jsx)(c.Button,{variant:"ghost",onClick:td,className:"w-full","data-testid":"button-back-to-email",children:"Back to Email Login"}),eb&&(0,s.jsx)("div",{className:"bg-green-500/10 border border-green-500/20 rounded-lg p-4 text-sm",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(M.CheckCircle,{className:"w-5 h-5 text-green-600 dark:text-green-500 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"text-green-700 dark:text-green-400",children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"Success"}),(0,s.jsx)("p",{children:eb})]})]})}),eg&&(0,s.jsx)("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4 text-sm",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(A.AlertCircle,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"text-destructive",children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"Error"}),(0,s.jsx)("p",{children:eg})]})]})})]})]}):"phone-email-found"===eI?(0,s.jsxs)(o.Card,{className:"max-w-md mx-auto",children:[(0,s.jsxs)(o.CardHeader,{children:[(0,s.jsx)(o.CardTitle,{children:"Account Found!"}),(0,s.jsx)(o.CardDescription,{children:"We'll send a login link to your email address"})]}),(0,s.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,s.jsx)("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(O.Mail,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"Email Address"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:eV}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"For security, we've hidden part of your email address"})]})]})}),(0,s.jsx)(c.Button,{onClick:tc,className:"w-full",disabled:eK,"data-testid":"button-send-phone-magic-link",children:eK?"Sending...":"Send Login Link"}),(0,s.jsx)(c.Button,{variant:"ghost",onClick:td,className:"w-full","data-testid":"button-back-from-phone",children:"Use Different Method"}),eb&&(0,s.jsx)("div",{className:"bg-green-500/10 border border-green-500/20 rounded-lg p-4 text-sm",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(M.CheckCircle,{className:"w-5 h-5 text-green-600 dark:text-green-500 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"text-green-700 dark:text-green-400",children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"Success"}),(0,s.jsx)("p",{children:eb})]})]})}),eg&&(0,s.jsx)("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4 text-sm",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(A.AlertCircle,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"text-destructive",children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"Error"}),(0,s.jsx)("p",{children:eg})]})]})})]})]}):"verify-code"===eI?(0,s.jsxs)(o.Card,{className:"max-w-md mx-auto",children:[(0,s.jsxs)(o.CardHeader,{children:[(0,s.jsx)(o.CardTitle,{children:"Enter Verification Code"}),(0,s.jsx)(o.CardDescription,{children:eA})]}),(0,s.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"verification-code",children:"phone"===eh?"6-Digit Code":"Check your email for the access link"}),"phone"===eh&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.Input,{id:"verification-code",type:"text",placeholder:"123456",value:eH,onChange:e=>eM(e.target.value.replace(/\D/g,"").slice(0,6)),onKeyDown:e=>"Enter"===e.key&&ti(),maxLength:6,"data-testid":"input-verification-code"}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Enter the 6-digit code sent to ",em]})]}),"email"===eh&&(0,s.jsx)("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(O.Mail,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"Check your email"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["We sent a secure access link to ",em,". Click the link in the email to access your portal."]})]})]})})]}),"phone"===eh&&(0,s.jsx)(c.Button,{onClick:ti,className:"w-full",disabled:6!==eH.length||eO,"data-testid":"button-verify-code",children:eO?"Verifying...":"Verify Code"}),(0,s.jsx)(c.Button,{variant:"outline",onClick:td,className:"w-full","data-testid":"button-back-to-lookup",children:"Try Another Method"}),eb&&(0,s.jsx)("div",{className:"bg-green-500/10 border border-green-500/20 rounded-lg p-4 text-sm",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(M.CheckCircle,{className:"w-5 h-5 text-green-600 dark:text-green-500 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"text-green-700 dark:text-green-400",children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"Success"}),(0,s.jsx)("p",{children:eb})]})]})}),eg&&(0,s.jsx)("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4 text-sm",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(A.AlertCircle,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"text-destructive",children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"Error"}),(0,s.jsx)("p",{children:eg})]})]})})]})]}):"select-account"===eI?(0,s.jsxs)(o.Card,{className:"max-w-2xl mx-auto",children:[(0,s.jsxs)(o.CardHeader,{children:[(0,s.jsx)(o.CardTitle,{children:"Select Your Account"}),(0,s.jsx)(o.CardDescription,{children:"We found multiple accounts associated with your contact information. Please select which account you'd like to access."})]}),(0,s.jsxs)(o.CardContent,{className:"space-y-3",children:[eD.map(e=>(0,s.jsx)(o.Card,{className:"hover-elevate active-elevate-2 cursor-pointer",onClick:()=>tl(e.id),"data-testid":`account-option-${e.id}`,children:(0,s.jsx)(o.CardContent,{className:"p-4",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:["Commercial"===e.type?(0,s.jsx)(T.Users,{className:"w-6 h-6 text-primary flex-shrink-0 mt-0.5"}):(0,s.jsx)(J.Home,{className:"w-6 h-6 text-primary flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("p",{className:"font-semibold",children:e.name}),(0,s.jsx)(h.Badge,{variant:"secondary",className:"text-xs",children:e.type})]}),e.address&&(0,s.jsxs)("p",{className:"text-sm text-muted-foreground flex items-start gap-1",children:[(0,s.jsx)(q.MapPin,{className:"w-3 h-3 flex-shrink-0 mt-0.5"}),e.address]})]})]})})},e.id)),(0,s.jsx)(c.Button,{variant:"outline",onClick:td,className:"w-full mt-4","data-testid":"button-back-to-lookup-from-select",children:"Back"})]})]}):null]})}),(0,s.jsx)(d.default,{}),sZ&&s4&&(0,s.jsx)($,{open:ek,onOpenChange:eS,customerName:sZ.customer.name,customerPhone:sZ.customer.phoneNumber,customerId:ep,referralCode:s4.code}),(0,s.jsx)(p.Dialog,{open:sJ,onOpenChange:sG,children:(0,s.jsxs)(p.DialogContent,{className:"max-w-2xl max-h-[80vh]","data-testid":"dialog-estimate-detail",children:[(0,s.jsxs)(p.DialogHeader,{children:[(0,s.jsx)(p.DialogTitle,{children:"Estimate Details"}),(0,s.jsx)(p.DialogDescription,{children:"Complete breakdown of your estimate"})]}),sK&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-muted/30 rounded-lg border",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4 mb-3",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("h3",{className:"font-semibold text-lg",children:["Estimate #",sK.estimateNumber]}),sK.summary&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:sK.summary})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1 items-end",children:[tv(sK.status),tN(sK)]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Total:"}),(0,s.jsx)("p",{className:"font-semibold text-lg text-primary",children:tx(sK.total)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Created:"}),(0,s.jsx)("p",{className:"font-medium",children:th(sK.createdOn)})]}),sK.expiresOn&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Expires:"}),(0,s.jsx)("p",{className:"font-medium",children:th(sK.expiresOn)})]})}),sK.jobNumber&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Job #:"}),(0,s.jsx)("p",{className:"font-medium",children:sK.jobNumber})]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h4",{className:"font-semibold",children:"Items"}),(0,s.jsx)("div",{className:"max-h-96 overflow-y-auto space-y-3 pr-2",children:sK.items&&sK.items.length>0?sK.items.map((e,t)=>(0,s.jsx)("div",{className:"p-3 bg-background rounded-lg border","data-testid":`estimate-item-${t}`,children:(0,s.jsxs)("div",{className:"flex gap-3",children:[e.pricebookDetails?.imageUrl&&(0,s.jsx)("img",{src:e.pricebookDetails.imageUrl,alt:e.pricebookDetails.name||e.description,className:"w-16 h-16 object-cover rounded"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-medium",children:e.pricebookDetails?.name||e.sku?.name||"Service Item"}),e.description&&(0,s.jsx)("div",{className:"text-sm text-muted-foreground mt-1",dangerouslySetInnerHTML:{__html:e.description}}),(0,s.jsxs)("div",{className:"mt-3 space-y-1",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Quantity:"}),(0,s.jsx)("span",{children:e.quantity||e.qty||1})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Unit Price:"}),(0,s.jsx)("span",{children:tx(e.unitRate||0)})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center pt-1 border-t",children:[(0,s.jsx)("span",{className:"font-medium",children:"Line Total:"}),(0,s.jsx)("span",{className:"font-semibold text-primary",children:tx(e.total||0)})]})]})]})]})},t)):(0,s.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"No items found"})})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-4 border-t",children:[(0,s.jsx)(c.Button,{variant:"outline",className:"flex-1",onClick:()=>sG(!1),"data-testid":"button-close-estimate-detail",children:"Close"}),(0,s.jsxs)(c.Button,{className:"flex-1",onClick:()=>{tp("estimate",sK.estimateNumber,sK.id,{customerId:sZ.customer.id,customerName:sZ.customer.name,customerEmail:sZ.customer.email}),sG(!1)},"data-testid":"button-request-estimate-pdf-modal",children:[(0,s.jsx)(I.FileText,{className:"w-4 h-4 mr-2"}),"Request PDF Copy"]})]})]})]})}),(0,s.jsx)(p.Dialog,{open:eQ,onOpenChange:eX,children:(0,s.jsxs)(p.DialogContent,{"data-testid":"dialog-reschedule",children:[(0,s.jsxs)(p.DialogHeader,{children:[(0,s.jsx)(p.DialogTitle,{children:"Reschedule Appointment"}),(0,s.jsx)(p.DialogDescription,{children:"Choose a new date and time window for your appointment. We'll update your schedule right away."})]}),eZ&&(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-muted/30 rounded-lg border",children:[(0,s.jsx)("p",{className:"text-sm font-medium mb-2",children:"Current Appointment:"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:eZ.jobType}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:[th(eZ.start)," at ",ty(eZ.start)]})]}),(0,s.jsxs)("div",{className:"grid gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"new-date",children:"New Date"}),(0,s.jsx)(m.Input,{id:"new-date",type:"date",value:e2,onChange:e=>e1(e.target.value),min:new Date().toISOString().split("T")[0],"data-testid":"input-new-date"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"new-window",children:"Time Window"}),(0,s.jsxs)(j.Select,{value:e4,onValueChange:e5,children:[(0,s.jsx)(j.SelectTrigger,{id:"new-window","data-testid":"select-time-window",children:(0,s.jsx)(j.SelectValue,{placeholder:"Select a time window"})}),(0,s.jsx)(j.SelectContent,{children:s7.map(e=>(0,s.jsx)(j.SelectItem,{value:`${e.start}-${e.end}`,"data-testid":`option-${e.start}-${e.end}`,children:e.label},`${e.start}-${e.end}`))})]})]})]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Note: This will update your appointment in our system. You can also call us at ",sQ.display," for assistance."]})]}),(0,s.jsxs)(p.DialogFooter,{children:[(0,s.jsx)(c.Button,{variant:"outline",onClick:()=>eX(!1),disabled:e3,"data-testid":"button-cancel-reschedule",children:"Cancel"}),(0,s.jsx)(c.Button,{onClick:tm,disabled:e3||!e2||!e4,"data-testid":"button-confirm-reschedule",children:e3?"Rescheduling...":"Confirm Reschedule"})]})]})}),(0,s.jsx)(p.Dialog,{open:e8,onOpenChange:e7,children:(0,s.jsxs)(p.DialogContent,{"data-testid":"dialog-edit-contacts",children:[(0,s.jsxs)(p.DialogHeader,{children:[(0,s.jsx)(p.DialogTitle,{children:"Update Contact Information"}),(0,s.jsx)(p.DialogDescription,{children:"Update your phone number and email address. This will be reflected in our system."})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"edit-phone",children:"Phone Number"}),(0,s.jsx)(m.Input,{id:"edit-phone",type:"tel",value:ss,onChange:e=>st(e.target.value),placeholder:"(512) 123-4567","data-testid":"input-edit-phone"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"edit-email",children:"Email Address"}),(0,s.jsx)(m.Input,{id:"edit-email",type:"email",value:e9,onChange:e=>se(e.target.value),placeholder:"you@example.com","data-testid":"input-edit-email"})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Note: Changes will update your contact information across all our systems."})]}),(0,s.jsxs)(p.DialogFooter,{children:[(0,s.jsx)(c.Button,{variant:"outline",onClick:()=>e7(!1),disabled:sa,"data-testid":"button-cancel-edit-contacts",children:"Cancel"}),(0,s.jsx)(c.Button,{onClick:tj,disabled:sa||!ss&&!e9,"data-testid":"button-save-contacts",children:sa?"Updating...":"Save Changes"})]})]})}),(0,s.jsx)(p.Dialog,{open:si,onOpenChange:sl,children:(0,s.jsxs)(p.DialogContent,{"data-testid":"dialog-delete-contact",children:[(0,s.jsxs)(p.DialogHeader,{children:[(0,s.jsx)(p.DialogTitle,{children:"Delete Contact?"}),(0,s.jsx)(p.DialogDescription,{children:"Are you sure you want to delete this contact information? This action cannot be undone."})]}),sn&&(0,s.jsx)("div",{className:"py-4",children:(0,s.jsxs)("div",{className:"bg-muted/50 p-4 rounded-lg",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"MobilePhone"===sn.type?"Mobile":sn.type}),(0,s.jsx)("p",{className:"font-medium",children:sn.value})]})}),(0,s.jsxs)(p.DialogFooter,{children:[(0,s.jsx)(c.Button,{variant:"outline",onClick:()=>{sl(!1),sd(null)},disabled:so,"data-testid":"button-cancel-delete-contact",children:"Cancel"}),(0,s.jsx)(c.Button,{variant:"destructive",onClick:tf,disabled:so,"data-testid":"button-confirm-delete-contact",children:so?"Deleting...":"Delete Contact"})]})]})}),(0,s.jsx)(p.Dialog,{open:sm,onOpenChange:sx,children:(0,s.jsxs)(p.DialogContent,{"data-testid":"dialog-edit-address",children:[(0,s.jsxs)(p.DialogHeader,{children:[(0,s.jsx)(p.DialogTitle,{children:"Update Service Address"}),(0,s.jsx)(p.DialogDescription,{children:"Update your service address where we provide plumbing services."})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"edit-street",children:"Street Address"}),(0,s.jsx)(m.Input,{id:"edit-street",type:"text",value:sh,onChange:e=>su(e.target.value),placeholder:"123 Main Street","data-testid":"input-edit-street"})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"edit-city",children:"City"}),(0,s.jsx)(m.Input,{id:"edit-city",type:"text",value:sp,onChange:e=>sj(e.target.value),placeholder:"Austin","data-testid":"input-edit-city"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"edit-state",children:"State"}),(0,s.jsx)(m.Input,{id:"edit-state",type:"text",value:sg,onChange:e=>sf(e.target.value),placeholder:"TX",maxLength:2,"data-testid":"input-edit-state"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"edit-zip",children:"ZIP Code"}),(0,s.jsx)(m.Input,{id:"edit-zip",type:"text",value:sb,onChange:e=>sy(e.target.value),placeholder:"78701",maxLength:5,"data-testid":"input-edit-zip"})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Note: This updates your primary service address in our system."})]}),(0,s.jsxs)(p.DialogFooter,{children:[(0,s.jsx)(c.Button,{variant:"outline",onClick:()=>sx(!1),disabled:sv,"data-testid":"button-cancel-edit-address",children:"Cancel"}),(0,s.jsx)(c.Button,{onClick:tb,disabled:sv||!sh||!sp||!sg||!sb,"data-testid":"button-save-address",children:sv?"Updating...":"Save Changes"})]})]})}),(0,s.jsx)(p.Dialog,{open:sk,onOpenChange:sS,children:(0,s.jsxs)(p.DialogContent,{"data-testid":"dialog-email-us",children:[(0,s.jsxs)(p.DialogHeader,{children:[(0,s.jsx)(p.DialogTitle,{children:"Email Us"}),(0,s.jsx)(p.DialogDescription,{children:"Send us a message and we'll get back to you as soon as possible."})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"email-name",children:"Name"}),(0,s.jsx)(m.Input,{id:"email-name",type:"text",value:sT,onChange:e=>sE(e.target.value),placeholder:"Your Name","data-testid":"input-email-name"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"email-phone",children:"Phone"}),(0,s.jsx)(m.Input,{id:"email-phone",type:"tel",value:sH,onChange:e=>sM(e.target.value),placeholder:"(512) 123-4567","data-testid":"input-email-phone"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"email-address",children:"Email Address"}),(0,s.jsx)(m.Input,{id:"email-address",type:"email",value:sI,onChange:e=>sB(e.target.value),placeholder:"you@example.com","data-testid":"input-email-address"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"email-subject",children:"Subject"}),(0,s.jsx)(m.Input,{id:"email-subject",type:"text",value:sD,onChange:e=>sP(e.target.value),placeholder:"How can we help?","data-testid":"input-email-subject"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"email-message",children:"Message"}),(0,s.jsx)("textarea",{id:"email-message",className:"flex min-h-[120px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:s$,onChange:e=>sF(e.target.value),placeholder:"Tell us more about what you need...","data-testid":"input-email-message"})]})]}),(0,s.jsxs)(p.DialogFooter,{children:[(0,s.jsx)(c.Button,{variant:"outline",onClick:()=>sS(!1),disabled:sA,"data-testid":"button-cancel-email",children:"Cancel"}),(0,s.jsx)(c.Button,{onClick:async()=>{if(!sT||!sI||!s$)return void sX({title:"Missing Information",description:"Please fill in all required fields",variant:"destructive"});sL(!0);try{if((await fetch("/api/contact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:sT,email:sI,phone:sH,subject:sD||"Customer Portal Inquiry",message:s$,source:"customer_portal"})})).ok)sX({title:"Message Sent!",description:"We've received your message and will respond soon."}),sS(!1),sP(""),sF("");else throw Error("Failed to send message")}catch(e){console.error("Error sending email:",e),sX({title:"Error",description:"Failed to send message. Please try again.",variant:"destructive"})}finally{sL(!1)}},disabled:sA||!sT||!sI||!s$,"data-testid":"button-send-email",children:sA?"Sending...":"Send Message"})]})]})}),(0,s.jsx)(p.Dialog,{open:sO,onOpenChange:sU,children:(0,s.jsxs)(p.DialogContent,{className:"sm:max-w-md","data-testid":"dialog-review",children:[(0,s.jsxs)(p.DialogHeader,{children:[(0,s.jsx)(p.DialogTitle,{children:0===sR?"How was your experience?":sR>=4?"Thank you for your feedback!":"We appreciate your feedback"}),(0,s.jsx)(p.DialogDescription,{children:0===sR?"Please rate your recent service":sR>=4?"Share your positive experience with others":"Help us improve our service"})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsx)("div",{className:"flex justify-center gap-2",children:[1,2,3,4,5].map(e=>(0,s.jsx)("button",{onClick:()=>sW(e),className:"focus:outline-none transition-transform hover:scale-110","data-testid":`button-star-${e}`,children:(0,s.jsx)(V.Star,{className:`w-10 h-10 ${e<=sR?"fill-yellow-400 text-yellow-400":"text-gray-300 hover:text-yellow-400"}`})},e))}),sR>0&&(0,s.jsx)(s.Fragment,{children:sR>=4?(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("p",{className:"text-center text-sm text-muted-foreground",children:"Please share your experience on one of these platforms:"}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsxs)(c.Button,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>{window.open("https://g.page/r/CeBZvF4LQ-KNEAE/review","_blank"),sU(!1),sX({title:"Thank you!",description:"Opening Google Reviews..."})},"data-testid":"button-google-review",children:[(0,s.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[(0,s.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,s.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,s.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,s.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Google Reviews"]}),(0,s.jsxs)(c.Button,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>{window.open("https://www.facebook.com/EconomyPlumbingServices/reviews","_blank"),sU(!1),sX({title:"Thank you!",description:"Opening Facebook Reviews..."})},"data-testid":"button-facebook-review",children:[(0,s.jsx)(ea.SiFacebook,{className:"w-5 h-5 text-[#1877F2]"}),"Facebook Reviews"]}),(0,s.jsxs)(c.Button,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>{window.open("https://www.yelp.com/writeareview/biz/economy-plumbing-services-austin","_blank"),sU(!1),sX({title:"Thank you!",description:"Opening Yelp Reviews..."})},"data-testid":"button-yelp-review",children:[(0,s.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{fill:"#FF1A1A",d:"M12.062 17.662c.038-.934-.008-.889.002-2.393.007-.9.527-.991.756-.635.052.081 1.518 2.368 1.541 2.449.156.557-.194.683-.774.619-.651-.072-1.245-.166-1.249-.166-.265-.049-.368-.146-.276-.51zm2.167-4.142c.011-.908.012-.908.021-1.823.011-1.103-.746-1.098-1.069-.501-.073.135-1.164 2.443-1.212 2.553-.175.408.254.578.663.556l1.27-.069c.17-.009.333-.065.327-.716zm-3.192.955c.901-.111.91-.148 1.75-.291.508-.087.546-.567.087-.752-.105-.042-2.634-.912-2.728-.951-.599-.247-.772.292-.548.867.251.646.497 1.222.497 1.227.103.224.256.215.585-.065zm-3.834 5.558c.347-.778.347-.801.651-1.479.365-.815-.397-1.139-.856-.595-.099.125-1.912 2.317-1.939 2.383-.231.576.271.876.687.803.682-.125 1.162-.239 1.166-.244.178-.108.24-.243.291-.868zm.901-2.701c.793-.448.808-.457 1.522-.874.86-.502.429-1.155-.342-1.176-.177-.005-3.057-.029-3.163-.036-.671-.043-.819.503-.438.929.427.478.823.912.827.917.163.175.36.14.698-.09z"})}),"Yelp Reviews"]}),(0,s.jsxs)(c.Button,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>{window.open("https://www.bbb.org/us/tx/austin/profile/plumber/economy-plumbing-services-0825-1000049576/customer-reviews","_blank"),sU(!1),sX({title:"Thank you!",description:"Opening BBB Reviews..."})},"data-testid":"button-bbb-review",children:[(0,s.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{fill:"#003087",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"})}),"BBB Reviews"]})]})]}):(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("p",{className:"text-center text-sm text-muted-foreground",children:"We're sorry to hear about your experience. Please tell us how we can improve:"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Label,{htmlFor:"feedback",children:"Your Feedback"}),(0,s.jsx)("textarea",{id:"feedback",className:"flex min-h-[120px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:sV,onChange:e=>sY(e.target.value),placeholder:"Please share what went wrong and how we can do better...","data-testid":"input-review-feedback"})]}),(0,s.jsx)(c.Button,{className:"w-full",onClick:async()=>{sq(!0);try{if((await fetch("/api/reviews/private-feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:ep,rating:sR,feedback:sV,customerName:sZ?.customer?.name||"Anonymous",customerEmail:sZ?.customer?.email||""})})).ok)sX({title:"Thank you for your feedback",description:"We'll review your comments and work to improve our service."}),sU(!1);else throw Error("Failed to submit feedback")}catch(e){console.error("Error submitting feedback:",e),sX({title:"Error",description:"Failed to submit feedback. Please try again.",variant:"destructive"})}finally{sq(!1)}},disabled:sz||!sV.trim(),"data-testid":"button-submit-feedback",children:sz?"Submitting...":"Submit Feedback"})]})})]}),0===sR&&(0,s.jsx)(p.DialogFooter,{children:(0,s.jsx)(c.Button,{variant:"outline",onClick:()=>sU(!1),"data-testid":"button-cancel-review",children:"Cancel"})})]})}),(0,s.jsx)(p.Dialog,{open:eT&&"authenticated"===eI,onOpenChange:eE,children:(0,s.jsxs)(p.DialogContent,{className:"max-w-2xl","data-testid":"dialog-switch-account",children:[(0,s.jsxs)(p.DialogHeader,{children:[(0,s.jsx)(p.DialogTitle,{children:"Switch Account"}),(0,s.jsx)(p.DialogDescription,{children:"Select which account you'd like to view. You have access to multiple accounts."})]}),(0,s.jsx)("div",{className:"space-y-3 py-4",children:eD.map(e=>(0,s.jsx)(o.Card,{className:"hover-elevate active-elevate-2 cursor-pointer",onClick:()=>tl(e.id),"data-testid":`switch-account-option-${e.id}`,children:(0,s.jsx)(o.CardContent,{className:"p-4",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:["Commercial"===e.type?(0,s.jsx)(T.Users,{className:"w-6 h-6 text-primary flex-shrink-0 mt-0.5"}):(0,s.jsx)(J.Home,{className:"w-6 h-6 text-primary flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("p",{className:"font-semibold",children:e.name}),(0,s.jsx)(h.Badge,{variant:"secondary",className:"text-xs",children:e.type})]}),e.address&&(0,s.jsxs)("p",{className:"text-sm text-muted-foreground flex items-start gap-1",children:[(0,s.jsx)(q.MapPin,{className:"w-3 h-3 flex-shrink-0 mt-0.5"}),e.address]})]})]})})},e.id))}),(0,s.jsx)(p.DialogFooter,{children:(0,s.jsx)(c.Button,{variant:"outline",onClick:()=>eE(!1),"data-testid":"button-cancel-switch",children:"Cancel"})})]})})]})}e.s(["default",()=>er],212180)}]);
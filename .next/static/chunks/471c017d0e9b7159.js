(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,114272,t=>{"use strict";var e=t.i(540143),s=t.i(88587),i=t.i(936553),r=class extends s.Removable{#t;#e;#s;constructor(t){super(),this.mutationId=t.mutationId,this.#e=t.mutationCache,this.#t=[],this.state=t.state||a(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){this.#t.includes(t)||(this.#t.push(t),this.clearGcTimeout(),this.#e.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.#t=this.#t.filter(e=>e!==t),this.scheduleGc(),this.#e.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.#t.length||("pending"===this.state.status?this.scheduleGc():this.#e.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(t){this.#s=(0,i.createRetryer)({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(Error("No mutationFn found")),onFail:(t,e)=>{this.#i({type:"failed",failureCount:t,error:e})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#e.canRun(this)});let e="pending"===this.state.status,s=!this.#s.canStart();try{if(!e){this.#i({type:"pending",variables:t,isPaused:s}),await this.#e.config.onMutate?.(t,this);let e=await this.options.onMutate?.(t);e!==this.state.context&&this.#i({type:"pending",context:e,variables:t,isPaused:s})}let i=await this.#s.start();return await this.#e.config.onSuccess?.(i,t,this.state.context,this),await this.options.onSuccess?.(i,t,this.state.context),await this.#e.config.onSettled?.(i,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(i,null,t,this.state.context),this.#i({type:"success",data:i}),i}catch(e){try{throw await this.#e.config.onError?.(e,t,this.state.context,this),await this.options.onError?.(e,t,this.state.context),await this.#e.config.onSettled?.(void 0,e,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,e,t,this.state.context),e}finally{this.#i({type:"error",error:e})}}finally{this.#e.runNext(this)}}#i(t){this.state=(e=>{switch(t.type){case"failed":return{...e,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...e,isPaused:!0};case"continue":return{...e,isPaused:!1};case"pending":return{...e,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...e,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...e,data:void 0,error:t.error,failureCount:e.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}})(this.state),e.notifyManager.batch(()=>{this.#t.forEach(e=>{e.onMutationUpdate(t)}),this.#e.notify({mutation:this,type:"updated",action:t})})}};function a(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}t.s(["Mutation",()=>r,"getDefaultState",()=>a])},793479,t=>{"use strict";var e=t.i(843476),s=t.i(271645),i=t.i(975157);let r=s.forwardRef(({className:t,type:s,...r},a)=>(0,e.jsx)("input",{type:s,className:(0,i.cn)("flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...r}));r.displayName="Input",t.s(["Input",()=>r])},908406,t=>{"use strict";var e=t.i(271645);let s=0,i=new Map,r=t=>{if(i.has(t))return;let e=setTimeout(()=>{i.delete(t),o({type:"REMOVE_TOAST",toastId:t})},1e6);i.set(t,e)},a=[],n={toasts:[]};function o(t){n=((t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,1)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{let{toastId:s}=e;return s?r(s):t.toasts.forEach(t=>{r(t.id)}),{...t,toasts:t.toasts.map(t=>t.id===s||void 0===s?{...t,open:!1}:t)}}case"REMOVE_TOAST":if(void 0===e.toastId)return{...t,toasts:[]};return{...t,toasts:t.toasts.filter(t=>t.id!==e.toastId)}}})(n,t),a.forEach(t=>{t(n)})}function l({...t}){let e=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),i=()=>o({type:"DISMISS_TOAST",toastId:e});return o({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:t=>{t||i()}}}),{id:e,dismiss:i,update:t=>o({type:"UPDATE_TOAST",toast:{...t,id:e}})}}function u(){let[t,s]=e.useState(n);return e.useEffect(()=>(a.push(s),()=>{let t=a.indexOf(s);t>-1&&a.splice(t,1)}),[t]),{...t,toast:l,dismiss:t=>o({type:"DISMISS_TOAST",toastId:t})}}t.s(["useToast",()=>u])},110204,t=>{"use strict";var e=t.i(843476),s=t.i(271645),i=t.i(248425),r=s.forwardRef((t,s)=>(0,e.jsx)(i.Primitive.label,{...t,ref:s,onMouseDown:e=>{e.target.closest("button, input, select, textarea")||(t.onMouseDown?.(e),!e.defaultPrevented&&e.detail>1&&e.preventDefault())}}));r.displayName="Label";var a=t.i(225913),n=t.i(975157);let o=(0,a.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=s.forwardRef(({className:t,...s},i)=>(0,e.jsx)(r,{ref:i,className:(0,n.cn)(o(),t),...s}));l.displayName=r.displayName,t.s(["Label",()=>l],110204)},954616,t=>{"use strict";var e=t.i(271645),s=t.i(114272),i=t.i(540143),r=t.i(915823),a=t.i(619273),n=class extends r.Subscribable{#r;#a=void 0;#n;#o;constructor(t,e){super(),this.#r=t,this.setOptions(e),this.bindMethods(),this.#l()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){let e=this.options;this.options=this.#r.defaultMutationOptions(t),(0,a.shallowEqualObjects)(this.options,e)||this.#r.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),e?.mutationKey&&this.options.mutationKey&&(0,a.hashKey)(e.mutationKey)!==(0,a.hashKey)(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(t){this.#l(),this.#u(t)}getCurrentResult(){return this.#a}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#l(),this.#u()}mutate(t,e){return this.#o=e,this.#n?.removeObserver(this),this.#n=this.#r.getMutationCache().build(this.#r,this.options),this.#n.addObserver(this),this.#n.execute(t)}#l(){let t=this.#n?.state??(0,s.getDefaultState)();this.#a={...t,isPending:"pending"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset}}#u(t){i.notifyManager.batch(()=>{if(this.#o&&this.hasListeners()){let e=this.#a.variables,s=this.#a.context;t?.type==="success"?(this.#o.onSuccess?.(t.data,e,s),this.#o.onSettled?.(t.data,null,e,s)):t?.type==="error"&&(this.#o.onError?.(t.error,e,s),this.#o.onSettled?.(void 0,t.error,e,s))}this.listeners.forEach(t=>{t(this.#a)})})}},o=t.i(912598),l=t.i(811076);function u(t,s){let r=(0,o.useQueryClient)(s),[a]=e.useState(()=>new n(r,t));e.useEffect(()=>{a.setOptions(t)},[a,t]);let u=e.useSyncExternalStore(e.useCallback(t=>a.subscribe(i.notifyManager.batchCalls(t)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),c=e.useCallback((t,e)=>{a.mutate(t,e).catch(l.noop)},[a]);if(u.error&&(0,l.shouldThrowError)(a.options.throwOnError,[u.error]))throw u.error;return{...u,mutate:c,mutateAsync:u.mutate}}t.s(["useMutation",()=>u],954616)},929592,t=>{"use strict";var e=t.i(843476),s=t.i(271645),i=t.i(225913),r=t.i(975157);let a=(0,i.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),n=s.forwardRef(({className:t,variant:s,...i},n)=>(0,e.jsx)("div",{ref:n,role:"alert",className:(0,r.cn)(a({variant:s}),t),...i}));n.displayName="Alert",s.forwardRef(({className:t,...s},i)=>(0,e.jsx)("h5",{ref:i,className:(0,r.cn)("mb-1 font-medium leading-none tracking-tight",t),...s})).displayName="AlertTitle";let o=s.forwardRef(({className:t,...s},i)=>(0,e.jsx)("div",{ref:i,className:(0,r.cn)("text-sm [&_p]:leading-relaxed",t),...s}));o.displayName="AlertDescription",t.s(["Alert",()=>n,"AlertDescription",()=>o])},531278,t=>{"use strict";let e=(0,t.i(475254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);t.s(["Loader2",()=>e],531278)},730699,t=>{"use strict";let e=(0,t.i(475254).default)("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);t.s(["Gift",()=>e],730699)},484047,t=>{"use strict";var e=t.i(843476),s=t.i(271645),i=t.i(142023),r=t.i(266027),a=t.i(954616),n=t.i(653145),o=t.i(994814),l=t.i(50270),u=t.i(380759),c=t.i(515288),d=t.i(519455),h=t.i(793479),m=t.i(903133),p=t.i(929592),f=t.i(730699),y=t.i(531278);let x=(0,t.i(475254).default)("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"hbicv8"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11c-.11.7-.72 1.22-1.43 1.22H17",key:"1i94pl"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98C9.52 4.9 9 5.52 9 6.23V7",key:"1cofks"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]]);var b=t.i(908406);let v=l.z.object({name:l.z.string().min(2,"Please enter your full name"),email:l.z.string().email("Please enter a valid email").optional().or(l.z.literal("")),phone:l.z.string().min(10,"Please enter a valid phone number").optional().or(l.z.literal(""))}).refine(t=>t.email||t.phone,{message:"Please provide either your email or phone number",path:["email"]});function g(){let{referrerCustomerId:t}=(0,i.useParams)(),[,l]=(0,i.useLocation)(),[g,j]=(0,s.useState)(!1),{toast:C}=(0,b.useToast)();(0,s.useEffect)(()=>{localStorage.getItem(`referral_submitted_${t}`)&&(j(!0),setTimeout(()=>{l("/")},3e3))},[t,l]);let{data:w,isLoading:S}=(0,r.useQuery)({queryKey:["/api/referrals/referrer",t],enabled:!!t&&!g}),M=(0,n.useForm)({resolver:(0,o.zodResolver)(v),defaultValues:{name:"",email:"",phone:""}}),N=(0,a.useMutation)({mutationFn:async e=>{let s=await fetch("/api/referrals/capture-landing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({referrerCustomerId:parseInt(t),refereeName:e.name,refereeEmail:e.email||null,refereePhone:e.phone||null})});if(!s.ok)throw Error((await s.json()).message||"Failed to submit contact info");return s.json()},onSuccess:()=>{localStorage.setItem(`referral_submitted_${t}`,"true"),j(!0),C({title:"Thank you!",description:"You're all set. Redirecting to our homepage..."}),setTimeout(()=>{l("/")},3e3)},onError:t=>{C({title:"Submission Failed",description:t.message,variant:"destructive"})}});return S?(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-b from-primary/10 via-primary/5 to-background",children:(0,e.jsx)(c.Card,{className:"w-full max-w-md",children:(0,e.jsx)(c.CardContent,{className:"flex items-center justify-center py-12",children:(0,e.jsx)(y.Loader2,{className:"w-8 h-8 animate-spin text-primary"})})})}):w?g?(0,e.jsxs)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-b from-primary/10 via-primary/5 to-background p-4",children:[(0,e.jsx)(u.SEOHead,{title:"Welcome! | Economy Plumbing Austin",description:"Thanks for visiting Economy Plumbing through a referral",canonical:"/referred-by"}),(0,e.jsx)(c.Card,{className:"w-full max-w-md",children:(0,e.jsxs)(c.CardHeader,{className:"text-center",children:[(0,e.jsx)("div",{className:"flex justify-center mb-4",children:(0,e.jsx)(x,{className:"w-16 h-16 text-primary"})}),(0,e.jsx)(c.CardTitle,{className:"text-2xl",children:"You're All Set!"}),(0,e.jsx)(c.CardDescription,{children:"Redirecting you to our homepage..."})]})})]}):(0,e.jsxs)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-b from-primary/10 via-primary/5 to-background p-4",children:[(0,e.jsx)(u.SEOHead,{title:`${w.name} Referred You | Economy Plumbing Austin`,description:"A friend referred you to Economy Plumbing! Get $25 off your first service.",canonical:"/referred-by"}),(0,e.jsxs)(c.Card,{className:"w-full max-w-md",children:[(0,e.jsxs)(c.CardHeader,{className:"text-center",children:[(0,e.jsx)("div",{className:"flex justify-center mb-4",children:(0,e.jsx)(f.Gift,{className:"w-16 h-16 text-primary"})}),(0,e.jsxs)(c.CardTitle,{className:"text-2xl","data-testid":"text-referrer-name",children:["Your friend ",(0,e.jsx)("span",{className:"text-primary",children:w.name})," referred you!"]}),(0,e.jsxs)(c.CardDescription,{className:"text-base mt-2",children:["To help us track this referral and ensure ",w.name," gets credit, please provide your contact information before browsing our site."]})]}),(0,e.jsxs)(c.CardContent,{children:[(0,e.jsxs)(p.Alert,{className:"mb-6",children:[(0,e.jsx)(f.Gift,{className:"w-4 h-4"}),(0,e.jsxs)(p.AlertDescription,{children:[(0,e.jsx)("strong",{children:"You'll get $25 off your first service!"}),(0,e.jsx)("br",{}),"Valid on jobs $200 or more. We'll apply the discount automatically."]})]}),(0,e.jsx)(m.Form,{...M,children:(0,e.jsxs)("form",{onSubmit:M.handleSubmit(t=>N.mutate(t)),className:"space-y-4",children:[(0,e.jsx)(m.FormField,{control:M.control,name:"name",render:({field:t})=>(0,e.jsxs)(m.FormItem,{children:[(0,e.jsx)(m.FormLabel,{children:"Your Name"}),(0,e.jsx)(m.FormControl,{children:(0,e.jsx)(h.Input,{placeholder:"John Smith",...t,"data-testid":"input-name"})}),(0,e.jsx)(m.FormMessage,{})]})}),(0,e.jsx)(m.FormField,{control:M.control,name:"email",render:({field:t})=>(0,e.jsxs)(m.FormItem,{children:[(0,e.jsx)(m.FormLabel,{children:"Email Address"}),(0,e.jsx)(m.FormControl,{children:(0,e.jsx)(h.Input,{type:"email",placeholder:"you@example.com",...t,"data-testid":"input-email"})}),(0,e.jsx)(m.FormDescription,{className:"text-xs",children:"We'll only use this to track the referral"}),(0,e.jsx)(m.FormMessage,{})]})}),(0,e.jsx)(m.FormField,{control:M.control,name:"phone",render:({field:t})=>(0,e.jsxs)(m.FormItem,{children:[(0,e.jsx)(m.FormLabel,{children:"Phone Number"}),(0,e.jsx)(m.FormControl,{children:(0,e.jsx)(h.Input,{type:"tel",placeholder:"(512) 555-1234",...t,"data-testid":"input-phone"})}),(0,e.jsx)(m.FormDescription,{className:"text-xs",children:"At least one contact method required"}),(0,e.jsx)(m.FormMessage,{})]})}),(0,e.jsx)(d.Button,{type:"submit",className:"w-full",disabled:N.isPending,"data-testid":"button-submit",children:N.isPending?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(y.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Submitting..."]}):"Continue to Website"})]})}),(0,e.jsxs)("p",{className:"text-xs text-muted-foreground text-center mt-4",children:["By continuing, you allow us to track this referral so ",w.name," can receive their $25 credit."]})]})]})]}):(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-b from-primary/10 via-primary/5 to-background p-4",children:(0,e.jsxs)(c.Card,{className:"w-full max-w-md",children:[(0,e.jsxs)(c.CardHeader,{children:[(0,e.jsx)(c.CardTitle,{children:"Invalid Referral Link"}),(0,e.jsx)(c.CardDescription,{children:"This referral link appears to be invalid or expired"})]}),(0,e.jsx)(c.CardContent,{children:(0,e.jsx)(d.Button,{onClick:()=>l("/"),className:"w-full","data-testid":"button-go-home",children:"Go to Homepage"})})]})})}t.s(["default",()=>g],484047)}]);
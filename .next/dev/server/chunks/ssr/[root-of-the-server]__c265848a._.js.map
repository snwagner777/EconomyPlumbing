{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/email-preferences/page.tsx"],"sourcesContent":["/**\n * Email Preference Center\n * \n * Public page for managing email subscriptions (CAN-SPAM compliance)\n */\n\nimport type { Metadata } from 'next';\n\nexport const metadata: Metadata = {\n  title: 'Email Preferences | Economy Plumbing Services',\n  description: 'Manage your email subscription preferences',\n  robots: 'noindex', // Don't index preference pages\n};\n\ntype Props = {\n  searchParams: Promise<{ token?: string }>;\n};\n\nasync function getPreferences(token: string) {\n  const res = await fetch(\n    `${process.env.NEXT_PUBLIC_API_URL || ''}/api/email-preferences?token=${token}`,\n    { cache: 'no-store' }\n  );\n  \n  if (!res.ok) {\n    return null;\n  }\n  \n  return res.json();\n}\n\nexport default async function EmailPreferencesPage({ searchParams }: Props) {\n  const params = await searchParams;\n  const token = params.token;\n\n  if (!token) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center py-16 px-4\">\n        <div className=\"max-w-md text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">Invalid Link</h1>\n          <p className=\"text-muted-foreground\">\n            This email preference link is invalid or expired. Please use the link from your email.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  const data = await getPreferences(token);\n\n  if (!data) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center py-16 px-4\">\n        <div className=\"max-w-md text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">Not Found</h1>\n          <p className=\"text-muted-foreground\">\n            We couldn't find your email preferences. The link may be expired.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  const prefs = data.preferences;\n\n  return (\n    <div className=\"min-h-screen py-16 px-4\">\n      <div className=\"max-w-2xl mx-auto\">\n        <div className=\"bg-card p-8 rounded-lg shadow-lg\">\n          <h1 className=\"text-3xl font-bold mb-2\">Email Preferences</h1>\n          <p className=\"text-muted-foreground mb-8\">\n            Manage your email subscriptions for {prefs.email}\n          </p>\n\n          <form action=\"/api/email-preferences\" method=\"POST\" className=\"space-y-6\">\n            <input type=\"hidden\" name=\"token\" value={token} />\n\n            <div className=\"space-y-4\">\n              <label className=\"flex items-start gap-3 p-4 border rounded-lg cursor-pointer hover:bg-accent/50\">\n                <input \n                  type=\"checkbox\" \n                  name=\"reviewRequests\" \n                  defaultChecked={prefs.reviewRequests}\n                  className=\"mt-1\"\n                />\n                <div>\n                  <div className=\"font-semibold\">Review Requests</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    Occasional requests to review our service\n                  </div>\n                </div>\n              </label>\n\n              <label className=\"flex items-start gap-3 p-4 border rounded-lg cursor-pointer hover:bg-accent/50\">\n                <input \n                  type=\"checkbox\" \n                  name=\"referralNurture\" \n                  defaultChecked={prefs.referralNurture}\n                  className=\"mt-1\"\n                />\n                <div>\n                  <div className=\"font-semibold\">Referral Program</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    Information about our referral rewards program\n                  </div>\n                </div>\n              </label>\n\n              <label className=\"flex items-start gap-3 p-4 border rounded-lg cursor-pointer hover:bg-accent/50\">\n                <input \n                  type=\"checkbox\" \n                  name=\"quoteFollowup\" \n                  defaultChecked={prefs.quoteFollowup}\n                  className=\"mt-1\"\n                />\n                <div>\n                  <div className=\"font-semibold\">Quote Follow-ups</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    Follow-up on estimates and quotes\n                  </div>\n                </div>\n              </label>\n\n              <label className=\"flex items-start gap-3 p-4 border rounded-lg cursor-pointer hover:bg-accent/50\">\n                <input \n                  type=\"checkbox\" \n                  name=\"marketingEmails\" \n                  defaultChecked={prefs.marketingEmails}\n                  className=\"mt-1\"\n                />\n                <div>\n                  <div className=\"font-semibold\">Marketing & Promotions</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    Special offers, tips, and company updates\n                  </div>\n                </div>\n              </label>\n            </div>\n\n            <div className=\"pt-6 border-t\">\n              <button \n                type=\"submit\"\n                className=\"w-full bg-primary text-primary-foreground px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition\"\n              >\n                Save Preferences\n              </button>\n            </div>\n          </form>\n\n          <div className=\"mt-6 pt-6 border-t text-center\">\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Want to unsubscribe from all marketing emails?\n            </p>\n            <a \n              href={`/api/email-preferences/unsubscribe?token=${token}`}\n              className=\"text-sm text-destructive hover:underline\"\n            >\n              Unsubscribe from All Marketing Emails\n            </a>\n          </div>\n\n          <div className=\"mt-6 text-center text-xs text-muted-foreground\">\n            <p>\n              You will continue to receive transactional emails related to your service appointments.\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}
{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/src/lib/session.ts"],"sourcesContent":["/**\n * Session Management for Next.js App Router\n * \n * Replaces express-session with iron-session for Next.js compatibility\n * Preserves all existing OAuth functionality\n */\n\nimport { getIronSession, type IronSession } from 'iron-session';\nimport { cookies } from 'next/headers';\n\nexport interface SessionData {\n  user?: {\n    id: string;\n    email: string;\n    firstName?: string;\n    lastName?: string;\n    profileImageUrl?: string;\n    claims?: any;\n    access_token?: string;\n    refresh_token?: string;\n    expires_at?: number;\n  };\n  isAdmin?: boolean;\n  oauthState?: string;\n  oauthCodeVerifier?: string;\n  customerPortalAuth?: {\n    customerId: number;\n    email: string;\n    phone: string;\n    verifiedAt: number;\n  };\n}\n\nif (!process.env.SESSION_SECRET) {\n  throw new Error('SESSION_SECRET environment variable is required');\n}\n\nconst sessionOptions = {\n  password: process.env.SESSION_SECRET,\n  cookieName: 'plumbing_session',\n  ttl: 7 * 24 * 60 * 60, // 1 week (in seconds)\n  cookieOptions: {\n    httpOnly: true,\n    secure: true, // Always use secure cookies (Replit uses HTTPS)\n    sameSite: 'lax' as const,\n    maxAge: 7 * 24 * 60 * 60, // 1 week (in seconds)\n    path: '/',\n  },\n};\n\n/**\n * Get the current session from cookies\n */\nexport async function getSession(): Promise<IronSession<SessionData>> {\n  const cookieStore = await cookies();\n  return getIronSession<SessionData>(cookieStore, sessionOptions);\n}\n\n/**\n * Check if user is authenticated\n */\nexport async function isAuthenticated(): Promise<boolean> {\n  const session = await getSession();\n  return !!session.user && !!session.user.expires_at && session.user.expires_at > Math.floor(Date.now() / 1000);\n}\n\n/**\n * Check if user is admin\n */\nexport async function isAdmin(): Promise<boolean> {\n  const session = await getSession();\n  return !!session.isAdmin && await isAuthenticated();\n}\n\n/**\n * Get current user from session\n */\nexport async function getCurrentUser() {\n  const session = await getSession();\n  return session.user;\n}\n\n/**\n * Destroy session (logout)\n */\nexport async function destroySession() {\n  const session = await getSession();\n  session.destroy();\n}\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;;;;;;;;;AAED;AACA;;;AAyBA,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;IAC/B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,iBAAiB;IACrB,UAAU,QAAQ,GAAG,CAAC,cAAc;IACpC,YAAY;IACZ,KAAK,IAAI,KAAK,KAAK;IACnB,eAAe;QACb,UAAU;QACV,QAAQ;QACR,UAAU;QACV,QAAQ,IAAI,KAAK,KAAK;QACtB,MAAM;IACR;AACF;AAKO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,OAAO,IAAA,kKAAc,EAAc,aAAa;AAClD;AAKO,eAAe;IACpB,MAAM,UAAU,MAAM;IACtB,OAAO,CAAC,CAAC,QAAQ,IAAI,IAAI,CAAC,CAAC,QAAQ,IAAI,CAAC,UAAU,IAAI,QAAQ,IAAI,CAAC,UAAU,GAAG,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;AAC1G;AAKO,eAAe;IACpB,MAAM,UAAU,MAAM;IACtB,OAAO,CAAC,CAAC,QAAQ,OAAO,IAAI,MAAM;AACpC;AAKO,eAAe;IACpB,MAAM,UAAU,MAAM;IACtB,OAAO,QAAQ,IAAI;AACrB;AAKO,eAAe;IACpB,MAAM,UAAU,MAAM;IACtB,QAAQ,OAAO;AACjB","debugId":null}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/admin/customers/customers-dashboard.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const CustomersDashboard = registerClientReference(\n    function() { throw new Error(\"Attempted to call CustomersDashboard() from the server but CustomersDashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/admin/customers/customers-dashboard.tsx <module evaluation>\",\n    \"CustomersDashboard\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,qBAAqB,IAAA,wQAAuB,EACrD;IAAa,MAAM,IAAI,MAAM;AAAoP,GACjR,6EACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/admin/customers/customers-dashboard.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const CustomersDashboard = registerClientReference(\n    function() { throw new Error(\"Attempted to call CustomersDashboard() from the server but CustomersDashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/admin/customers/customers-dashboard.tsx\",\n    \"CustomersDashboard\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,qBAAqB,IAAA,wQAAuB,EACrD;IAAa,MAAM,IAAI,MAAM;AAAoP,GACjR,yDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/admin/customers/page.tsx"],"sourcesContent":["/**\n * Customers Admin Page\n * \n * Manage ServiceTitan customer data, XLSX imports, and sync monitoring\n */\n\nimport type { Metadata } from 'next';\nimport { redirect } from 'next/navigation';\nimport { isAdmin } from '@/lib/session';\nimport { CustomersDashboard } from './customers-dashboard';\n\nexport const metadata: Metadata = {\n  title: 'Customers Admin | Economy Plumbing',\n  robots: 'noindex',\n};\n\nexport default async function CustomersAdminPage() {\n  const admin = await isAdmin();\n  \n  if (!admin) {\n    redirect('/admin-login');\n  }\n\n  return <CustomersDashboard />;\n}\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;;;;AAGD;AAAA;AACA;AACA;;;;;AAEO,MAAM,WAAqB;IAChC,OAAO;IACP,QAAQ;AACV;AAEe,eAAe;IAC5B,MAAM,QAAQ,MAAM,IAAA,gIAAO;IAE3B,IAAI,CAAC,OAAO;QACV,IAAA,iMAAQ,EAAC;IACX;IAEA,qBAAO,8OAAC,0KAAkB;;;;;AAC5B","debugId":null}}]
}
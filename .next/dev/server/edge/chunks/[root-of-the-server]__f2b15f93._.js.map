{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["/**\n * Next.js Middleware - Runs before every request\n * \n * Handles:\n * 1. Trailing slash redirects (301)\n * 2. Security headers\n * 3. .replit.app domain redirect to custom domain\n * 4. URL normalization\n */\n\nimport { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\n\nexport function middleware(request: NextRequest) {\n  const { pathname, search } = request.nextUrl;\n  const host = request.headers.get('host') || '';\n\n  // 1. Redirect .replit.app domain to custom domain\n  if (host.includes('.replit.app')) {\n    const customDomain = 'https://www.plumbersthatcare.com';\n    const redirectUrl = `${customDomain}${pathname}${search}`;\n    return NextResponse.redirect(redirectUrl, { status: 301 });\n  }\n\n  // 2. Trailing slash redirect (301 permanent)\n  // Add trailing slash to all paths except:\n  // - API routes (/api/*)\n  // - Static files (with extensions)\n  // - Paths that already have trailing slash\n  const hasTrailingSlash = pathname.endsWith('/');\n  const isApiRoute = pathname.startsWith('/api');\n  const hasExtension = /\\.[a-z]+$/i.test(pathname);\n  \n  if (!hasTrailingSlash && !isApiRoute && !hasExtension && pathname !== '/') {\n    const url = request.nextUrl.clone();\n    url.pathname = `${pathname}/`;\n    return NextResponse.redirect(url, { status: 301 });\n  }\n\n  // 3. Rewrite legacy object storage URLs\n  // /replit-objstore-{bucketId}/public/* â†’ /public-objects/*\n  // Preserves query strings for signed URLs and versioning\n  if (pathname.match(/^\\/replit-objstore-[^/]+\\/public\\//)) {\n    const filePathMatch = pathname.match(/^\\/replit-objstore-[^/]+\\/public\\/(.*)$/);\n    if (filePathMatch) {\n      const filePath = filePathMatch[1];\n      const url = request.nextUrl.clone();\n      url.pathname = `/public-objects/${filePath}`;\n      // Query strings (search) are automatically preserved by clone()\n      // but explicitly ensuring parity for signed URLs: url.search remains unchanged\n      return NextResponse.rewrite(url);\n    }\n  }\n\n  // 4. Create response with security headers\n  const response = NextResponse.next();\n\n  // Security headers (matching Express implementation)\n  \n  // Content Security Policy\n  const cspDirectives = [\n    \"default-src 'self'\",\n    \"script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com https://connect.facebook.net https://www.clarity.ms https://c.clarity.ms https://cdn.jsdelivr.net\",\n    \"style-src 'self' 'unsafe-inline' https://fonts.googleapis.com\",\n    \"font-src 'self' https://fonts.gstatic.com data:\",\n    \"img-src 'self' data: blob: https: http:\",\n    \"connect-src 'self' https://www.google-analytics.com https://analytics.google.com https://www.facebook.com https://www.clarity.ms https://c.clarity.ms https://*.ingest.sentry.io\",\n    \"frame-src 'self' https://js.stripe.com https://hooks.stripe.com https://www.facebook.com https://servicetitan.com\",\n    \"object-src 'none'\",\n    \"base-uri 'self'\",\n    \"form-action 'self'\",\n    \"frame-ancestors 'none'\",\n    \"upgrade-insecure-requests\"\n  ];\n\n  response.headers.set('Content-Security-Policy', cspDirectives.join('; '));\n  \n  // HSTS (HTTP Strict Transport Security)\n  response.headers.set('Strict-Transport-Security', 'max-age=31536000; includeSubDomains; preload');\n  \n  // Prevent MIME type sniffing\n  response.headers.set('X-Content-Type-Options', 'nosniff');\n  \n  // Clickjacking protection\n  response.headers.set('X-Frame-Options', 'DENY');\n  \n  // Referrer policy\n  response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');\n  \n  // Permissions policy\n  const permissionsDirectives = [\n    'geolocation=()',\n    'microphone=()',\n    'camera=()',\n    'payment=(self)',\n    'usb=()',\n    'magnetometer=()',\n    'gyroscope=()',\n    'speaker=(self)'\n  ];\n  response.headers.set('Permissions-Policy', permissionsDirectives.join(', '));\n\n  return response;\n}\n\n// Configure which routes middleware runs on\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except:\n     * 1. /_next (Next.js internals)\n     * 2. /api/webhooks/stripe (needs raw body)\n     * 3. /api/webhooks/resend (needs raw body)\n     * 4. Static files (images, fonts, etc.)\n     */\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp|woff|woff2|ttf|eot|ico)$).*)',\n  ],\n};\n"],"names":[],"mappings":"AAAA;;;;;;;;CAQC;;;;;;AAED;AAAA;;AAGO,SAAS,WAAW,OAAoB;IAC7C,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,QAAQ,OAAO;IAC5C,MAAM,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,WAAW;IAE5C,kDAAkD;IAClD,IAAI,KAAK,QAAQ,CAAC,gBAAgB;QAChC,MAAM,eAAe;QACrB,MAAM,cAAc,GAAG,eAAe,WAAW,QAAQ;QACzD,OAAO,gMAAY,CAAC,QAAQ,CAAC,aAAa;YAAE,QAAQ;QAAI;IAC1D;IAEA,6CAA6C;IAC7C,0CAA0C;IAC1C,wBAAwB;IACxB,mCAAmC;IACnC,2CAA2C;IAC3C,MAAM,mBAAmB,SAAS,QAAQ,CAAC;IAC3C,MAAM,aAAa,SAAS,UAAU,CAAC;IACvC,MAAM,eAAe,aAAa,IAAI,CAAC;IAEvC,IAAI,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,aAAa,KAAK;QACzE,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;QACjC,IAAI,QAAQ,GAAG,GAAG,SAAS,CAAC,CAAC;QAC7B,OAAO,gMAAY,CAAC,QAAQ,CAAC,KAAK;YAAE,QAAQ;QAAI;IAClD;IAEA,wCAAwC;IACxC,2DAA2D;IAC3D,yDAAyD;IACzD,IAAI,SAAS,KAAK,CAAC,uCAAuC;QACxD,MAAM,gBAAgB,SAAS,KAAK,CAAC;QACrC,IAAI,eAAe;YACjB,MAAM,WAAW,aAAa,CAAC,EAAE;YACjC,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;YACjC,IAAI,QAAQ,GAAG,CAAC,gBAAgB,EAAE,UAAU;YAC5C,gEAAgE;YAChE,+EAA+E;YAC/E,OAAO,gMAAY,CAAC,OAAO,CAAC;QAC9B;IACF;IAEA,2CAA2C;IAC3C,MAAM,WAAW,gMAAY,CAAC,IAAI;IAElC,qDAAqD;IAErD,0BAA0B;IAC1B,MAAM,gBAAgB;QACpB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,SAAS,OAAO,CAAC,GAAG,CAAC,2BAA2B,cAAc,IAAI,CAAC;IAEnE,wCAAwC;IACxC,SAAS,OAAO,CAAC,GAAG,CAAC,6BAA6B;IAElD,6BAA6B;IAC7B,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;IAE/C,0BAA0B;IAC1B,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IAExC,kBAAkB;IAClB,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IAExC,qBAAqB;IACrB,MAAM,wBAAwB;QAC5B;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACD,SAAS,OAAO,CAAC,GAAG,CAAC,sBAAsB,sBAAsB,IAAI,CAAC;IAEtE,OAAO;AACT;AAGO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}
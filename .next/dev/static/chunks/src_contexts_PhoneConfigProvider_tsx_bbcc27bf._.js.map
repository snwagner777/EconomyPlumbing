{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/src/contexts/PhoneConfigProvider.tsx"],"sourcesContent":["\"use client\";\n\nimport { createContext, useContext, useState, useEffect, ReactNode } from 'react';\n\ninterface PhoneConfig {\n  display: string;\n  tel: string;\n}\n\ninterface TrackingNumber {\n  id: string;\n  channelKey: string;\n  channelName: string;\n  displayNumber: string;\n  rawNumber: string;\n  telLink: string;\n  detectionRules: string;\n  isActive: boolean;\n  isDefault: boolean;\n  sortOrder: number;\n}\n\ninterface DetectionRules {\n  isDefault?: boolean;\n  patterns?: string[];\n  urlParams?: string[];\n  utmSources?: string[];\n  referrerIncludes?: string[];\n}\n\nconst DEFAULT_PHONE: PhoneConfig = {\n  display: '(512) 368-9159',\n  tel: 'tel:+15123689159'\n};\n\nconst MARBLE_FALLS_PHONE: PhoneConfig = {\n  display: '(830) 460-3565',\n  tel: 'tel:+18304603565'\n};\n\nconst PhoneConfigContext = createContext<PhoneConfig>(DEFAULT_PHONE);\nconst MarbleFallsPhoneContext = createContext<PhoneConfig>(MARBLE_FALLS_PHONE);\n\nconst COOKIE_NAME = 'traffic_source';\nconst COOKIE_DAYS = 90;\n\nfunction getCookie(name: string): string | null {\n  if (typeof document === 'undefined') return null;\n  const value = `; ${document.cookie}`;\n  const parts = value.split(`; ${name}=`);\n  if (parts.length === 2) {\n    return parts.pop()?.split(';').shift() || null;\n  }\n  return null;\n}\n\nfunction setCookie(name: string, value: string, days: number): void {\n  if (typeof document === 'undefined') return;\n  const date = new Date();\n  date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n  const expires = `expires=${date.toUTCString()}`;\n  document.cookie = `${name}=${value};${expires};path=/`;\n}\n\nfunction detectTrafficSource(trackingNumbers: TrackingNumber[]): TrackingNumber | null {\n  if (typeof window === 'undefined') return null;\n  \n  const urlParams = new URLSearchParams(window.location.search);\n  const referrer = document.referrer.toLowerCase();\n  const utmSource = urlParams.get('utm_source')?.toLowerCase();\n\n  for (const number of trackingNumbers) {\n    if (number.isDefault) continue;\n\n    try {\n      const rules: DetectionRules = JSON.parse(number.detectionRules);\n\n      if (rules.urlParams) {\n        for (const param of rules.urlParams) {\n          if (urlParams.has(param)) {\n            return number;\n          }\n        }\n      }\n\n      if (rules.utmSources && utmSource) {\n        if (rules.utmSources.some(source => source.toLowerCase() === utmSource)) {\n          return number;\n        }\n      }\n\n      if (rules.referrerIncludes && referrer) {\n        if (rules.referrerIncludes.some(pattern => referrer.includes(pattern.toLowerCase()))) {\n          return number;\n        }\n      }\n    } catch (error) {\n      console.error(`[PhoneConfig] Error parsing detection rules:`, error);\n    }\n  }\n\n  return null;\n}\n\nfunction getPhoneNumberFromTracking(trackingNumbers: TrackingNumber[]): PhoneConfig {\n  const detected = detectTrafficSource(trackingNumbers);\n  \n  if (detected) {\n    setCookie(COOKIE_NAME, detected.channelKey, COOKIE_DAYS);\n    return {\n      display: detected.displayNumber,\n      tel: detected.telLink\n    };\n  }\n\n  const cookieSource = getCookie(COOKIE_NAME);\n  if (cookieSource) {\n    const matchingNumber = trackingNumbers.find(n => n.channelKey === cookieSource);\n    if (matchingNumber) {\n      return {\n        display: matchingNumber.displayNumber,\n        tel: matchingNumber.telLink\n      };\n    }\n  }\n\n  const defaultNumber = trackingNumbers.find(n => n.isDefault);\n  if (defaultNumber) {\n    return {\n      display: defaultNumber.displayNumber,\n      tel: defaultNumber.telLink\n    };\n  }\n\n  return DEFAULT_PHONE;\n}\n\nexport function PhoneConfigProvider({ children }: { children: ReactNode }) {\n  const [phoneConfig, setPhoneConfig] = useState<PhoneConfig>(DEFAULT_PHONE);\n  const [marbleFallsConfig, setMarbleFallsConfig] = useState<PhoneConfig>(MARBLE_FALLS_PHONE);\n\n  useEffect(() => {\n    async function fetchTrackingNumbers() {\n      try {\n        const response = await fetch('/api/tracking-numbers');\n        if (!response.ok) throw new Error('Failed to fetch tracking numbers');\n        \n        const data = await response.json();\n        const trackingNumbers = data.trackingNumbers || [];\n        \n        const austinNumbers = trackingNumbers.filter((n: TrackingNumber) => \n          !n.channelKey.toLowerCase().includes('marblefalls') &&\n          !n.channelKey.toLowerCase().includes('marble_falls')\n        );\n        \n        const marbleFallsNumbers = trackingNumbers.filter((n: TrackingNumber) =>\n          n.channelKey.toLowerCase().includes('marblefalls') ||\n          n.channelKey.toLowerCase().includes('marble_falls')\n        );\n\n        const austinConfig = getPhoneNumberFromTracking(austinNumbers);\n        const mfConfig = marbleFallsNumbers.length > 0 \n          ? getPhoneNumberFromTracking(marbleFallsNumbers)\n          : MARBLE_FALLS_PHONE;\n\n        setPhoneConfig(austinConfig);\n        setMarbleFallsConfig(mfConfig);\n\n        if (typeof window !== 'undefined') {\n          window.__PHONE_CONFIG__ = austinConfig;\n          window.__MARBLE_FALLS_PHONE_CONFIG__ = mfConfig;\n        }\n      } catch (error) {\n        console.error('[PhoneConfig] Error fetching tracking numbers:', error);\n      }\n    }\n\n    fetchTrackingNumbers();\n  }, []);\n\n  return (\n    <PhoneConfigContext.Provider value={phoneConfig}>\n      <MarbleFallsPhoneContext.Provider value={marbleFallsConfig}>\n        {children}\n      </MarbleFallsPhoneContext.Provider>\n    </PhoneConfigContext.Provider>\n  );\n}\n\nexport function usePhoneConfig() {\n  return useContext(PhoneConfigContext);\n}\n\nexport function useMarbleFallsPhone() {\n  return useContext(MarbleFallsPhoneContext);\n}\n\ndeclare global {\n  interface Window {\n    __PHONE_CONFIG__: PhoneConfig;\n    __MARBLE_FALLS_PHONE_CONFIG__: PhoneConfig;\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}
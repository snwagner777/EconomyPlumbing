module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},270406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},442315,(e,t,r)=>{"use strict";t.exports=e.r(918622)},347540,(e,t,r)=>{"use strict";t.exports=e.r(442315).vendored["react-rsc"].React},254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},688947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},406461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},446786,(e,t,r)=>{t.exports=e.x("os",()=>require("os"))},500874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},427699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},524836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},921517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},504446,(e,t,r)=>{t.exports=e.x("net",()=>require("net"))},755004,(e,t,r)=>{t.exports=e.x("tls",()=>require("tls"))},792509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},246245,e=>{"use strict";var t=Object.defineProperty,r=Object.defineProperties,n=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(e,r,n)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,l=(e,t)=>{for(var r in t||(t={}))i.call(t,r)&&o(e,r,t[r]);if(s)for(var r of s(t))a.call(t,r)&&o(e,r,t[r]);return e},d=(e,t,r)=>new Promise((n,s)=>{var i=e=>{try{o(r.next(e))}catch(e){s(e)}},a=e=>{try{o(r.throw(e))}catch(e){s(e)}},o=e=>e.done?n(e.value):Promise.resolve(e.value).then(i,a);o((r=r.apply(e,t)).next())});function u(e){let t=new URLSearchParams;return void 0!==e.limit&&t.set("limit",e.limit.toString()),"after"in e&&void 0!==e.after&&t.set("after",e.after),"before"in e&&void 0!==e.before&&t.set("before",e.before),t.toString()}var c=class{constructor(e){this.resend=e}create(e){return d(this,arguments,function*(e,t={}){return yield this.resend.post("/api-keys",e,t)})}list(){return d(this,arguments,function*(e={}){let t=u(e),r=t?`/api-keys?${t}`:"/api-keys";return yield this.resend.get(r)})}remove(e){return d(this,null,function*(){return yield this.resend.delete(`/api-keys/${e}`)})}},h=class{constructor(e){this.resend=e}create(e){return d(this,arguments,function*(e,t={}){return yield this.resend.post("/audiences",e,t)})}list(){return d(this,arguments,function*(e={}){let t=u(e),r=t?`/audiences?${t}`:"/audiences";return yield this.resend.get(r)})}get(e){return d(this,null,function*(){return yield this.resend.get(`/audiences/${e}`)})}remove(e){return d(this,null,function*(){return yield this.resend.delete(`/audiences/${e}`)})}};function p(e){var t;return{attachments:null==(t=e.attachments)?void 0:t.map(e=>({content:e.content,filename:e.filename,path:e.path,content_type:e.contentType,content_id:e.contentId})),bcc:e.bcc,cc:e.cc,from:e.from,headers:e.headers,html:e.html,reply_to:e.replyTo,scheduled_at:e.scheduledAt,subject:e.subject,tags:e.tags,text:e.text,to:e.to}}function f(t){return new Promise((r,n)=>{e.A(406693).then(({render:e})=>{r(e(t))}).catch(()=>{n(Error("Failed to render React component. Make sure to install `@react-email/render` or `@react-email/components`."))})})}var m=class{constructor(e){this.resend=e}send(e,t){return d(this,null,function*(){return this.create(e,t)})}create(e,t){return d(this,null,function*(){var s;let i=[];for(let t of e)t.react&&(t.html=yield f(t.react),t.react=void 0),i.push(p(t));return yield this.resend.post("/emails/batch",i,r(l({},t),n({headers:l({"x-batch-validation":null!=(s=null==t?void 0:t.batchValidation)?s:"strict"},null==t?void 0:t.headers)})))})}},v=class{constructor(e){this.resend=e}create(e){return d(this,arguments,function*(e,t={}){return e.react&&(e.html=yield f(e.react)),yield this.resend.post("/broadcasts",{name:e.name,audience_id:e.audienceId,preview_text:e.previewText,from:e.from,html:e.html,reply_to:e.replyTo,subject:e.subject,text:e.text},t)})}send(e,t){return d(this,null,function*(){return yield this.resend.post(`/broadcasts/${e}/send`,{scheduled_at:null==t?void 0:t.scheduledAt})})}list(){return d(this,arguments,function*(e={}){let t=u(e),r=t?`/broadcasts?${t}`:"/broadcasts";return yield this.resend.get(r)})}get(e){return d(this,null,function*(){return yield this.resend.get(`/broadcasts/${e}`)})}remove(e){return d(this,null,function*(){return yield this.resend.delete(`/broadcasts/${e}`)})}update(e,t){return d(this,null,function*(){return t.react&&(t.html=yield f(t.react)),yield this.resend.patch(`/broadcasts/${e}`,{name:t.name,audience_id:t.audienceId,from:t.from,html:t.html,text:t.text,subject:t.subject,reply_to:t.replyTo,preview_text:t.previewText})})}},y=class{constructor(e){this.resend=e}create(e){return d(this,arguments,function*(e,t={}){return yield this.resend.post(`/audiences/${e.audienceId}/contacts`,{unsubscribed:e.unsubscribed,email:e.email,first_name:e.firstName,last_name:e.lastName},t)})}list(e){return d(this,null,function*(){let{audienceId:t}=e,r=u(((e,t)=>{var r={};for(var n in e)i.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&s)for(var n of s(e))0>t.indexOf(n)&&a.call(e,n)&&(r[n]=e[n]);return r})(e,["audienceId"])),n=r?`/audiences/${t}/contacts?${r}`:`/audiences/${t}/contacts`;return yield this.resend.get(n)})}get(e){return d(this,null,function*(){return e.id||e.email?yield this.resend.get(`/audiences/${e.audienceId}/contacts/${(null==e?void 0:e.email)?null==e?void 0:e.email:null==e?void 0:e.id}`):{data:null,error:{message:"Missing `id` or `email` field.",name:"missing_required_field"}}})}update(e){return d(this,null,function*(){return e.id||e.email?yield this.resend.patch(`/audiences/${e.audienceId}/contacts/${(null==e?void 0:e.email)?null==e?void 0:e.email:null==e?void 0:e.id}`,{unsubscribed:e.unsubscribed,first_name:e.firstName,last_name:e.lastName}):{data:null,error:{message:"Missing `id` or `email` field.",name:"missing_required_field"}}})}remove(e){return d(this,null,function*(){return e.id||e.email?yield this.resend.delete(`/audiences/${e.audienceId}/contacts/${(null==e?void 0:e.email)?null==e?void 0:e.email:null==e?void 0:e.id}`):{data:null,error:{message:"Missing `id` or `email` field.",name:"missing_required_field"}}})}},g=class{constructor(e){this.resend=e}create(e){return d(this,arguments,function*(e,t={}){return yield this.resend.post("/domains",{name:e.name,region:e.region,custom_return_path:e.customReturnPath},t)})}list(){return d(this,arguments,function*(e={}){let t=u(e),r=t?`/domains?${t}`:"/domains";return yield this.resend.get(r)})}get(e){return d(this,null,function*(){return yield this.resend.get(`/domains/${e}`)})}update(e){return d(this,null,function*(){return yield this.resend.patch(`/domains/${e.id}`,{click_tracking:e.clickTracking,open_tracking:e.openTracking,tls:e.tls})})}remove(e){return d(this,null,function*(){return yield this.resend.delete(`/domains/${e}`)})}verify(e){return d(this,null,function*(){return yield this.resend.post(`/domains/${e}/verify`)})}},x=class{constructor(e){this.resend=e}send(e){return d(this,arguments,function*(e,t={}){return this.create(e,t)})}create(e){return d(this,arguments,function*(e,t={}){return e.react&&(e.html=yield f(e.react)),yield this.resend.post("/emails",p(e),t)})}get(e){return d(this,null,function*(){return yield this.resend.get(`/emails/${e}`)})}list(){return d(this,arguments,function*(e={}){let t=u(e),r=t?`/emails?${t}`:"/emails";return yield this.resend.get(r)})}update(e){return d(this,null,function*(){return yield this.resend.patch(`/emails/${e.id}`,{scheduled_at:e.scheduledAt})})}cancel(e){return d(this,null,function*(){return yield this.resend.post(`/emails/${e}/cancel`)})}},b="undefined"!=typeof process&&process.env&&process.env.RESEND_BASE_URL||"https://api.resend.com",R="undefined"!=typeof process&&process.env&&process.env.RESEND_USER_AGENT||"resend-node:6.1.2",w=class{constructor(e){if(this.key=e,this.apiKeys=new c(this),this.audiences=new h(this),this.batch=new m(this),this.broadcasts=new v(this),this.contacts=new y(this),this.domains=new g(this),this.emails=new x(this),!e&&("undefined"!=typeof process&&process.env&&(this.key=process.env.RESEND_API_KEY),!this.key))throw Error('Missing API key. Pass it to the constructor `new Resend("re_123")`');this.headers=new Headers({Authorization:`Bearer ${this.key}`,"User-Agent":R,"Content-Type":"application/json"})}fetchRequest(e){return d(this,arguments,function*(e,t={}){try{let s=yield fetch(`${b}${e}`,t);if(!s.ok)try{let e=yield s.text();return{data:null,error:JSON.parse(e)}}catch(t){if(t instanceof SyntaxError)return{data:null,error:{name:"application_error",message:"Internal server error. We are unable to process your request right now, please try again later."}};let e={message:s.statusText,name:"application_error"};if(t instanceof Error){let s,i;return{data:null,error:(s=l({},e),i={message:t.message},r(s,n(i)))}}return{data:null,error:e}}return{data:yield s.json(),error:null}}catch(e){return{data:null,error:{name:"application_error",message:"Unable to fetch data. The request could not be resolved."}}}})}post(e,t){return d(this,arguments,function*(e,t,s={}){let i=new Headers(this.headers);if(s.headers)for(let[e,t]of new Headers(s.headers).entries())i.set(e,t);s.idempotencyKey&&i.set("Idempotency-Key",s.idempotencyKey);let a=r(l({method:"POST",body:JSON.stringify(t)},s),n({headers:i}));return this.fetchRequest(e,a)})}get(e){return d(this,arguments,function*(e,t={}){let s=new Headers(this.headers);if(t.headers)for(let[e,r]of new Headers(t.headers).entries())s.set(e,r);let i=r(l({method:"GET"},t),n({headers:s}));return this.fetchRequest(e,i)})}put(e,t){return d(this,arguments,function*(e,t,s={}){let i=new Headers(this.headers);if(s.headers)for(let[e,t]of new Headers(s.headers).entries())i.set(e,t);let a=r(l({method:"PUT",body:JSON.stringify(t)},s),n({headers:i}));return this.fetchRequest(e,a)})}patch(e,t){return d(this,arguments,function*(e,t,s={}){let i=new Headers(this.headers);if(s.headers)for(let[e,t]of new Headers(s.headers).entries())i.set(e,t);let a=r(l({method:"PATCH",body:JSON.stringify(t)},s),n({headers:i}));return this.fetchRequest(e,a)})}delete(e,t){return d(this,null,function*(){let r={method:"DELETE",body:JSON.stringify(t),headers:this.headers};return this.fetchRequest(e,r)})}};e.s(["Resend",()=>w])},302307,e=>{"use strict";var t=e.i(747909),r=e.i(174017),n=e.i(996250),s=e.i(759756),i=e.i(561916),a=e.i(114444),o=e.i(837092),l=e.i(869741),d=e.i(316795),u=e.i(487718),c=e.i(995169),h=e.i(47587),p=e.i(666012),f=e.i(570101),m=e.i(626937),v=e.i(10372),y=e.i(193695);e.i(52474);var g=e.i(600220),x=e.i(89171),b=e.i(457420),R=e.i(190337),w=e.i(875225),E=e.i(322632),_=e.i(246245);let $=E.z.object({conversationId:E.z.string(),rating:E.z.number().min(1).max(5).optional()});async function C(e){try{let t=await e.json(),r=$.safeParse(t);if(!r.success)return x.NextResponse.json({error:"Invalid input",details:r.error.errors},{status:400});let{conversationId:n,rating:s}=r.data,[i]=await b.db.select().from(R.chatbotConversations).where((0,w.eq)(R.chatbotConversations.id,n));if(!i)return x.NextResponse.json({error:"Conversation not found"},{status:404});let a=await b.db.select().from(R.chatbotMessages).where((0,w.eq)(R.chatbotMessages.conversationId,n)).orderBy(R.chatbotMessages.createdAt);await b.db.update(R.chatbotConversations).set({endedAt:new Date,rating:s||null,emailSent:!0}).where((0,w.eq)(R.chatbotConversations.id,n));let o=process.env.RESEND_API_KEY,l=process.env.ADMIN_EMAIL;if(o&&l&&a.length>0)try{let e=new _.Resend(o),t=a.map(e=>`
          <div style="margin: 10px 0; padding: 10px; background: ${"user"===e.role?"#f0f0f0":"#e3f2fd"}; border-radius: 8px;">
            <strong>${"user"===e.role?"Customer":"AI Assistant"}:</strong><br/>
            ${e.content}
            ${e.feedback?`<br/><small>Feedback: ${e.feedback}</small>`:""}
          </div>
        `).join(""),r=`
          <h2>Chatbot Conversation Log</h2>
          <p><strong>Session ID:</strong> ${i.sessionId}</p>
          <p><strong>Page Context:</strong> ${i.pageContext||"Unknown"}</p>
          <p><strong>Started:</strong> ${new Date(i.startedAt).toLocaleString()}</p>
          <p><strong>Rating:</strong> ${s?`${s}/5 stars`:"Not rated"}</p>
          ${i.handoffRequested?"<p><strong>⚠️ Handoff Requested</strong></p>":""}
          ${i.customerEmail?`<p><strong>Customer Email:</strong> ${i.customerEmail}</p>`:""}
          ${i.customerPhone?`<p><strong>Customer Phone:</strong> ${i.customerPhone}</p>`:""}
          <hr/>
          <h3>Conversation:</h3>
          ${t}
        `;await e.emails.send({from:process.env.RESEND_FROM_EMAIL||"notifications@economyplumbing.com",to:l,subject:`Chatbot Conversation ${i.handoffRequested?"- HANDOFF NEEDED":""}`,html:r})}catch(e){console.error("[Chatbot] Failed to send conversation email:",e)}return x.NextResponse.json({success:!0})}catch(e){return console.error("[Chatbot End Conversation API] Error:",e),x.NextResponse.json({error:"Failed to end conversation"},{status:500})}}e.s(["POST",()=>C],591535);var A=e.i(591535);let q=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/chatbot/end-conversation/route",pathname:"/api/chatbot/end-conversation",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/chatbot/end-conversation/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:P,workUnitAsyncStorage:N,serverHooks:k}=q;function S(){return(0,n.patchFetch)({workAsyncStorage:P,workUnitAsyncStorage:N})}async function T(e,t,n){q.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let x="/api/chatbot/end-conversation/route";x=x.replace(/\/index$/,"")||"/";let b=await q.prepare(e,t,{srcPage:x,multiZoneDraftMode:!1});if(!b)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:R,params:w,nextConfig:E,parsedUrl:_,isDraftMode:$,prerenderManifest:C,routerServerContext:A,isOnDemandRevalidate:P,revalidateOnlyGenerated:N,resolvedPathname:k,clientReferenceManifest:S,serverActionsManifest:T}=b,j=(0,l.normalizeAppPath)(x),O=!!(C.dynamicRoutes[j]||C.routes[k]),I=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,_,!1):t.end("This page could not be found"),null);if(O&&!$){let e=!!C.routes[k],t=C.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await I();throw new y.NoFallbackError}}let H=null;!O||q.isDev||$||(H="/index"===(H=k)?"/":H);let M=!0===q.isDev||!O,D=O&&!M;T&&S&&(0,a.setReferenceManifestsSingleton)({page:x,clientReferenceManifest:S,serverActionsManifest:T,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:T})});let U=e.method||"GET",F=(0,i.getTracer)(),K=F.getActiveScopeSpan(),L={params:w,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>q.onRequestError(e,t,n,A)},sharedContext:{buildId:R}},B=new d.NodeNextRequest(e),z=new d.NodeNextResponse(t),G=u.NextRequestAdapter.fromNodeNextRequest(B,(0,u.signalFromNodeResponse)(t));try{let a=async e=>q.handle(G,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=F.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${U} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${x}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var i,l;let d=async({previousCacheEntry:r})=>{try{if(!o&&P&&N&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await a(s);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let d=L.renderOpts.collectedTags;if(!O)return await (0,p.sendResponse)(B,z,i,L.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(i.headers);d&&(t[v.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,n=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await q.onRequestError(e,t,{routerKind:"App Router",routePath:x,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:P})},A),t}},u=await q.handleResponse({req:e,nextConfig:E,cacheKey:H,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:N,responseGenerator:d,waitUntil:n.waitUntil,isMinimalMode:o});if(!O)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",P?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),$&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,f.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&O||c.delete(v.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,m.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(B,z,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};K?await l(K):await F.withPropagatedContext(e.headers,()=>F.trace(c.BaseServerSpan.handleRequest,{spanName:`${U} ${x}`,kind:i.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},l))}catch(t){if(t instanceof y.NoFallbackError||await q.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:P})}),O)throw t;return await (0,p.sendResponse)(B,z,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>S,"routeModule",()=>q,"serverHooks",()=>k,"workAsyncStorage",()=>P,"workUnitAsyncStorage",()=>N],302307)},406693,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_next_dist_compiled_react-dom_server_node_7bca5bf7.js","server/chunks/[root-of-the-server]__0c41828f._.js"].map(t=>e.l(t))).then(()=>t(701631)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__f721af25._.js.map
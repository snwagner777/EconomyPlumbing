module.exports=[39351,e=>{"use strict";let t,r,o,n,a,i;function s(e,t){if(null==e)return!1;try{return e instanceof t||Object.getPrototypeOf(e)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch{return!1}}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(t="oauth4webapi/v3.8.2");let c="ERR_INVALID_ARG_VALUE",u="ERR_INVALID_ARG_TYPE";function d(e,t,r){let o=TypeError(e,{cause:r});return Object.assign(o,{code:t}),o}let l=Symbol(),p=Symbol(),h=Symbol(),f=Symbol();Symbol();let m=Symbol();Symbol();let _=new TextEncoder,w=new TextDecoder;function y(e){return"string"==typeof e?_.encode(e):w.decode(e)}function b(e){return"string"==typeof e?o(e):r(e)}r=Uint8Array.prototype.toBase64?e=>(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e.toBase64({alphabet:"base64url",omitPadding:!0})):e=>{e instanceof ArrayBuffer&&(e=new Uint8Array(e));let t=[];for(let r=0;r<e.byteLength;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},o=Uint8Array.fromBase64?e=>{try{return Uint8Array.fromBase64(e,{alphabet:"base64url"})}catch(e){throw d("The input to be decoded is not correctly encoded.",c,e)}}:e=>{try{let t=atob(e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}catch(e){throw d("The input to be decoded is not correctly encoded.",c,e)}};class g extends Error{code;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=eT,Error.captureStackTrace?.(this,this.constructor)}}class T extends Error{code;constructor(e,t){super(e,t),this.name=this.constructor.name,t?.code&&(this.code=t?.code),Error.captureStackTrace?.(this,this.constructor)}}function x(e,t,r){return new T(e,{code:t,cause:r})}function v(e){return!(null===e||"object"!=typeof e||Array.isArray(e))}function S(e){s(e,Headers)&&(e=Object.fromEntries(e.entries()));let r=new Headers(e??{});if(t&&!r.has("user-agent")&&r.set("user-agent",t),r.has("authorization"))throw d('"options.headers" must not include the "authorization" header name',c);return r}function E(e,t){if(void 0!==t){if("function"==typeof t&&(t=t(e.href)),!(t instanceof AbortSignal))throw d('"options.signal" must return or be an instance of AbortSignal',u);return t}}function R(e){return e.includes("//")?e.replace("//","/"):e}async function A(e,t,r,o){if(!(e instanceof URL))throw d(`"${t}" must be an instance of URL`,u);z(e,o?.[l]!==!0);let n=r(new URL(e.href)),a=S(o?.headers);return a.set("accept","application/json"),(o?.[f]||fetch)(n.href,{body:void 0,headers:Object.fromEntries(a.entries()),method:"GET",redirect:"manual",signal:E(n,o?.signal)})}async function O(e,t){return A(e,"issuerIdentifier",e=>{switch(t?.algorithm){case void 0:case"oidc":e.pathname=R(`${e.pathname}/.well-known/openid-configuration`);break;case"oauth2":!function(e,t,r=!1){"/"===e.pathname?e.pathname=t:e.pathname=R(`${t}/${r?e.pathname:e.pathname.replace(/(\/)$/,"")}`)}(e,".well-known/oauth-authorization-server");break;default:throw d('"options.algorithm" must be "oidc" (default), or "oauth2"',c)}return e},t)}function P(e,t,r,o,n){try{if("number"!=typeof e||!Number.isFinite(e))throw d(`${r} must be a number`,u,n);if(e>0)return;if(t){if(0!==e)throw d(`${r} must be a non-negative number`,c,n);return}throw d(`${r} must be a positive number`,c,n)}catch(e){if(o)throw x(e.message,o,n);throw e}}function k(e,t,r,o){try{if("string"!=typeof e)throw d(`${t} must be a string`,u,o);if(0===e.length)throw d(`${t} must not be empty`,c,o)}catch(e){if(r)throw x(e.message,r,o);throw e}}async function U(e,t){if(!(e instanceof URL)&&e!==e$)throw d('"expectedIssuerIdentifier" must be an instance of URL',u);if(!s(t,Response))throw d('"response" must be an instance of Response',u);if(200!==t.status)throw x('"response" is not a conform Authorization Server Metadata response (unexpected HTTP status code)',eR,t);eN(t);let r=await eM(t);if(k(r.issuer,'"response" body "issuer" property',eS,{body:r}),e!==e$&&new URL(r.issuer).href!==e.href)throw x('"response" body "issuer" property does not match the expected value',eU,{expected:e.href,body:r,attribute:"issuer"});return r}function I(e){var t=e,r="application/json";if(ee(t)!==r)throw function(e,...t){let r='"response" content-type must be ';if(t.length>2){let e=t.pop();r+=`${t.join(", ")}, or ${e}`}else 2===t.length?r+=`${t[0]} or ${t[1]}`:r+=t[0];return x(r,eE,e)}(t,r)}async function L(e){return k(e,"codeVerifier"),b(await crypto.subtle.digest("SHA-256",y(e)))}function N(e){let t=e?.[p];return"number"==typeof t&&Number.isFinite(t)?t:0}function H(e){let t=e?.[h];return"number"==typeof t&&Number.isFinite(t)&&-1!==Math.sign(t)?t:30}function J(){return Math.floor(Date.now()/1e3)}function W(e){if("object"!=typeof e||null===e)throw d('"as" must be an object',u);k(e.issuer,'"as.issuer"')}function j(e){if("object"!=typeof e||null===e)throw d('"client" must be an object',u);k(e.client_id,'"client.client_id"')}function D(e){return k(e,'"clientSecret"'),(t,r,o,n)=>{o.set("client_id",r.client_id),o.set("client_secret",e)}}let C=URL.parse?(e,t)=>URL.parse(e,t):(e,t)=>{try{return new URL(e,t)}catch{return null}};function z(e,t){if(t&&"https:"!==e.protocol)throw x("only requests to HTTPS are allowed",eA,e);if("https:"!==e.protocol&&"http:"!==e.protocol)throw x("only HTTP and HTTPS requests are allowed",eO,e)}function M(e,t,r,o){let n;if("string"!=typeof e||!(n=C(e)))throw x(`authorization server metadata does not contain a valid ${r?`"as.mtls_endpoint_aliases.${t}"`:`"as.${t}"`}`,void 0===e?eI:eL,{attribute:r?`mtls_endpoint_aliases.${t}`:t});return z(n,o),n}function $(e,t,r,o){return r&&e.mtls_endpoint_aliases&&t in e.mtls_endpoint_aliases?M(e.mtls_endpoint_aliases[t],t,r,o):M(e[t],t,r,o)}class G extends Error{cause;code;error;status;error_description;response;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=eg,this.cause=t.cause,this.error=t.cause.error,this.status=t.response.status,this.error_description=t.cause.error_description,Object.defineProperty(this,"response",{enumerable:!1,value:t.response}),Error.captureStackTrace?.(this,this.constructor)}}class V extends Error{cause;code;error;error_description;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=ex,this.cause=t.cause,this.error=t.cause.get("error"),this.error_description=t.cause.get("error_description")??void 0,Error.captureStackTrace?.(this,this.constructor)}}class q extends Error{cause;code;response;status;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=eb,this.cause=t.cause,this.status=t.response.status,this.response=t.response,Object.defineProperty(this,"response",{enumerable:!1}),Error.captureStackTrace?.(this,this.constructor)}}let B="[a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+",F=RegExp("^[,\\s]*("+B+")\\s(.*)"),K=RegExp("^[,\\s]*("+B+')\\s*=\\s*"((?:[^"\\\\]|\\\\.)*)"[,\\s]*(.*)'),Y=RegExp("^[,\\s]*"+("("+B+")\\s*=\\s*(")+B+")[,\\s]*(.*)"),Z=RegExp("^([a-zA-Z0-9\\-\\._\\~\\+\\/]+[=]{0,2})(?:$|[,\\s])(.*)");async function Q(e){if(e.status>399&&e.status<500){eN(e),I(e);try{let t=await e.clone().json();if(v(t)&&"string"==typeof t.error&&t.error.length)return t}catch{}}}async function X(e,t,r){if(e.status!==t){let t;if(function(e){let t;if(t=function(e){if(!s(e,Response))throw d('"response" must be an instance of Response',u);let t=e.headers.get("www-authenticate");if(null===t)return;let r=[],o=t;for(;o;){let e,t=o.match(F),n=t?.["1"].toLowerCase();if(o=t?.["2"],!n)return;let a={};for(;o;){let r,n;if(t=o.match(K)){if([,r,n,o]=t,n.includes("\\"))try{n=JSON.parse(`"${n}"`)}catch{}a[r.toLowerCase()]=n;continue}if(t=o.match(Y)){[,r,n,o]=t,a[r.toLowerCase()]=n;continue}if(t=o.match(Z)){if(Object.keys(a).length)break;[,e,o]=t;break}return}let i={scheme:n,parameters:a};e&&(i.token68=e),r.push(i)}if(r.length)return r}(e))throw new q("server responded with a challenge in the WWW-Authenticate HTTP Header",{cause:t,response:e})}(e),t=await Q(e))throw await e.body?.cancel(),new G("server responded with an error in the response body",{cause:t,response:e});throw x(`"response" is not a conform ${r} response (unexpected HTTP status code)`,eR,e)}}function ee(e){return e.headers.get("content-type")?.split(";")[0]}async function et(e,t,r,o,n,a,i){return await r(e,t,n,a),a.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),(i?.[f]||fetch)(o.href,{body:n,headers:Object.fromEntries(a.entries()),method:"POST",redirect:"manual",signal:E(o,i?.signal)})}async function er(e,t,r,o,n,a){let i=$(e,"token_endpoint",t.use_mtls_endpoint_aliases,a?.[l]!==!0);n.set("grant_type",o);let s=S(a?.headers);if(s.set("accept","application/json"),a?.DPoP!==void 0){var u=a.DPoP;if(!eu.has(u))throw d('"options.DPoP" is not a valid DPoPHandle',c);await a.DPoP.addProof(i,s,"POST")}let p=await et(e,t,r,i,n,s,a);return a?.DPoP?.cacheNonce(p,i),p}Symbol();let eo=new WeakMap,en=new WeakMap;function ea(e){if(!e.id_token)return;let t=eo.get(e);if(!t)throw d('"ref" was already garbage collected or did not resolve from the proper sources',c);return t}async function ei(e,t,r,o,n,a){if(W(e),j(t),!s(r,Response))throw d('"response" must be an instance of Response',u);await X(r,200,"Token Endpoint"),eN(r);let i=await eM(r);if(k(i.access_token,'"response" body "access_token" property',eS,{body:i}),k(i.token_type,'"response" body "token_type" property',eS,{body:i}),i.token_type=i.token_type.toLowerCase(),void 0!==i.expires_in){let e="number"!=typeof i.expires_in?parseFloat(i.expires_in):i.expires_in;P(e,!0,'"response" body "expires_in" property',eS,{body:i}),i.expires_in=e}if(void 0!==i.refresh_token&&k(i.refresh_token,'"response" body "refresh_token" property',eS,{body:i}),void 0!==i.scope&&"string"!=typeof i.scope)throw x('"response" body "scope" property must be a string',eS,{body:i});if(void 0!==i.id_token){k(i.id_token,'"response" body "id_token" property',eS,{body:i});let a=["aud","exp","iat","iss","sub"];!0===t.require_auth_time&&a.push("auth_time"),void 0!==t.default_max_age&&(P(t.default_max_age,!0,'"client.default_max_age"'),a.push("auth_time")),o?.length&&a.push(...o);let{claims:s,jwt:c}=await eH(i.id_token,ej.bind(void 0,t.id_token_signed_response_alg,e.id_token_signing_alg_values_supported,"RS256"),N(t),H(t),n).then(eh.bind(void 0,a)).then(ec.bind(void 0,e)).then(es.bind(void 0,t.client_id));if(Array.isArray(s.aud)&&1!==s.aud.length){if(void 0===s.azp)throw x('ID Token "aud" (audience) claim includes additional untrusted audiences',ek,{claims:s,claim:"aud"});if(s.azp!==t.client_id)throw x('unexpected ID Token "azp" (authorized party) claim value',ek,{expected:t.client_id,claims:s,claim:"azp"})}void 0!==s.auth_time&&P(s.auth_time,!0,'ID Token "auth_time" (authentication time)',eS,{claims:s}),en.set(r,c),eo.set(i,s)}if(a?.[i.token_type]!==void 0)a[i.token_type](r,i);else if("dpop"!==i.token_type&&"bearer"!==i.token_type)throw new g("unsupported `token_type` value",{cause:{body:i}});return i}function es(e,t){if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e))throw x('unexpected JWT "aud" (audience) claim value',ek,{expected:e,claims:t.claims,claim:"aud"})}else if(t.claims.aud!==e)throw x('unexpected JWT "aud" (audience) claim value',ek,{expected:e,claims:t.claims,claim:"aud"});return t}function ec(e,t){let r=e[eG]?.(t)??e.issuer;if(t.claims.iss!==r)throw x('unexpected JWT "iss" (issuer) claim value',ek,{expected:r,claims:t.claims,claim:"iss"});return t}let eu=new WeakSet,ed=Symbol();async function el(e,t,r,o,n,a,i){if(W(e),j(t),!eu.has(o))throw d('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()',c);k(n,'"redirectUri"');let s=eD(o,"code");if(!s)throw x('no authorization code in "callbackParameters"',eS);let u=new URLSearchParams(i?.additionalParameters);return u.set("redirect_uri",n),u.set("code",s),a!==ed&&(k(a,'"codeVerifier"'),u.set("code_verifier",a)),er(e,t,r,"authorization_code",u,i)}let ep={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation",auth_time:"authentication time"};function eh(e,t){for(let r of e)if(void 0===t.claims[r])throw x(`JWT "${r}" (${ep[r]}) claim missing`,eS,{claims:t.claims});return t}let ef=Symbol(),em=Symbol();async function e_(e,t,r,o){return"string"==typeof o?.expectedNonce||"number"==typeof o?.maxAge||o?.requireIdToken?ew(e,t,r,o.expectedNonce,o.maxAge,o[m],o.recognizedTokenTypes):ey(e,t,r,o?.[m],o?.recognizedTokenTypes)}async function ew(e,t,r,o,n,a,i){let s=[];switch(o){case void 0:o=ef;break;case ef:break;default:k(o,'"expectedNonce" argument'),s.push("nonce")}switch(n??=t.default_max_age){case void 0:n=em;break;case em:break;default:P(n,!0,'"maxAge" argument'),s.push("auth_time")}let c=await ei(e,t,r,s,a,i);k(c.id_token,'"response" body "id_token" property',eS,{body:c});let u=ea(c);if(n!==em){let e=J()+N(t),r=H(t);if(u.auth_time+n<e-r)throw x("too much time has elapsed since the last End-User authentication",eP,{claims:u,now:e,tolerance:r,claim:"auth_time"})}if(o===ef){if(void 0!==u.nonce)throw x('unexpected ID Token "nonce" claim value',ek,{expected:void 0,claims:u,claim:"nonce"})}else if(u.nonce!==o)throw x('unexpected ID Token "nonce" claim value',ek,{expected:o,claims:u,claim:"nonce"});return c}async function ey(e,t,r,o,n){let a=await ei(e,t,r,void 0,o,n),i=ea(a);if(i){if(void 0!==t.default_max_age){P(t.default_max_age,!0,'"client.default_max_age"');let e=J()+N(t),r=H(t);if(i.auth_time+t.default_max_age<e-r)throw x("too much time has elapsed since the last End-User authentication",eP,{claims:i,now:e,tolerance:r,claim:"auth_time"})}if(void 0!==i.nonce)throw x('unexpected ID Token "nonce" claim value',ek,{expected:void 0,claims:i,claim:"nonce"})}return a}let eb="OAUTH_WWW_AUTHENTICATE_CHALLENGE",eg="OAUTH_RESPONSE_BODY_ERROR",eT="OAUTH_UNSUPPORTED_OPERATION",ex="OAUTH_AUTHORIZATION_RESPONSE_ERROR",ev="OAUTH_PARSE_ERROR",eS="OAUTH_INVALID_RESPONSE",eE="OAUTH_RESPONSE_IS_NOT_JSON",eR="OAUTH_RESPONSE_IS_NOT_CONFORM",eA="OAUTH_HTTP_REQUEST_FORBIDDEN",eO="OAUTH_REQUEST_PROTOCOL_FORBIDDEN",eP="OAUTH_JWT_TIMESTAMP_CHECK_FAILED",ek="OAUTH_JWT_CLAIM_COMPARISON_FAILED",eU="OAUTH_JSON_ATTRIBUTE_COMPARISON_FAILED",eI="OAUTH_MISSING_SERVER_METADATA",eL="OAUTH_INVALID_SERVER_METADATA";function eN(e){if(e.bodyUsed)throw d('"response" body has been used already',c)}async function eH(e,t,r,o,n){let a,i,{0:s,1:c,length:u}=e.split(".");if(5===u)if(void 0!==n)e=await n(e),{0:s,1:c,length:u}=e.split(".");else throw new g("JWE decryption is not configured",{cause:e});if(3!==u)throw x("Invalid JWT",eS,e);try{a=JSON.parse(y(b(s)))}catch(e){throw x("failed to parse JWT Header body as base64url encoded JSON",ev,e)}if(!v(a))throw x("JWT Header must be a top level object",eS,e);if(t(a),void 0!==a.crit)throw new g('no JWT "crit" header parameter extensions are supported',{cause:{header:a}});try{i=JSON.parse(y(b(c)))}catch(e){throw x("failed to parse JWT Payload body as base64url encoded JSON",ev,e)}if(!v(i))throw x("JWT Payload must be a top level object",eS,e);let d=J()+r;if(void 0!==i.exp){if("number"!=typeof i.exp)throw x('unexpected JWT "exp" (expiration time) claim type',eS,{claims:i});if(i.exp<=d-o)throw x('unexpected JWT "exp" (expiration time) claim value, expiration is past current timestamp',eP,{claims:i,now:d,tolerance:o,claim:"exp"})}if(void 0!==i.iat&&"number"!=typeof i.iat)throw x('unexpected JWT "iat" (issued at) claim type',eS,{claims:i});if(void 0!==i.iss&&"string"!=typeof i.iss)throw x('unexpected JWT "iss" (issuer) claim type',eS,{claims:i});if(void 0!==i.nbf){if("number"!=typeof i.nbf)throw x('unexpected JWT "nbf" (not before) claim type',eS,{claims:i});if(i.nbf>d+o)throw x('unexpected JWT "nbf" (not before) claim value',eP,{claims:i,now:d,tolerance:o,claim:"nbf"})}if(void 0!==i.aud&&"string"!=typeof i.aud&&!Array.isArray(i.aud))throw x('unexpected JWT "aud" (audience) claim type',eS,{claims:i});return{header:a,claims:i,jwt:e}}async function eJ(e){if(e.bodyUsed)throw d("form_post Request instances must contain a readable body",c,{cause:e});return e.text()}async function eW(e){if("POST"!==e.method)throw d("form_post responses are expected to use the POST method",c,{cause:e});if("application/x-www-form-urlencoded"!==ee(e))throw d("form_post responses are expected to use the application/x-www-form-urlencoded content-type",c,{cause:e});return eJ(e)}function ej(e,t,r,o){if(void 0!==e){if("string"==typeof e?o.alg!==e:!e.includes(o.alg))throw x('unexpected JWT "alg" header parameter',eS,{header:o,expected:e,reason:"client configuration"});return}if(Array.isArray(t)){if(!t.includes(o.alg))throw x('unexpected JWT "alg" header parameter',eS,{header:o,expected:t,reason:"authorization server metadata"});return}if(void 0!==r){if("string"==typeof r?o.alg!==r:"function"==typeof r?!r(o.alg):!r.includes(o.alg))throw x('unexpected JWT "alg" header parameter',eS,{header:o,expected:r,reason:"default value"});return}throw x('missing client or server configuration to verify used JWT "alg" header parameter',void 0,{client:e,issuer:t,fallback:r})}function eD(e,t){let{0:r,length:o}=e.getAll(t);if(o>1)throw x(`"${t}" parameter must be provided only once`,eS);return r}let eC=Symbol(),ez=Symbol();async function eM(e,t=I){let r;try{r=await e.json()}catch(r){throw t(e),x('failed to parse "response" body as JSON',ev,r)}if(!v(r))throw x('"response" body must be a top level object',eS,{body:r});return r}let e$=Symbol(),eG=Symbol();new TextEncoder,new TextDecoder;class eV extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class eq extends eV{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(n={"user-agent":"openid-client/v6.8.1"});let eB="ERR_INVALID_ARG_VALUE",eF="ERR_INVALID_ARG_TYPE";function eK(e,t,r){let o=TypeError(e,{cause:r});return Object.assign(o,{code:t}),o}function eY(e){return L(e)}function eZ(){return b(crypto.getRandomValues(new Uint8Array(32)))}class eQ extends Error{code;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=t?.code,Error.captureStackTrace?.(this,this.constructor)}}function eX(e,t,r){return new eQ(e,{cause:t,code:r})}function e0(e){if(e instanceof TypeError||e instanceof eQ||e instanceof G||e instanceof V||e instanceof q)throw e;if(e instanceof T)switch(e.code){case eA:throw eX("only requests to HTTPS are allowed",e,e.code);case eO:throw eX("only requests to HTTP or HTTPS are allowed",e,e.code);case eR:throw eX("unexpected HTTP response status code",e.cause,e.code);case eE:throw eX("unexpected response content-type",e.cause,e.code);case ev:throw eX("parsing error occured",e,e.code);case eS:throw eX("invalid response encountered",e,e.code);case ek:throw eX("unexpected JWT claim value encountered",e,e.code);case eU:throw eX("unexpected JSON attribute value encountered",e,e.code);case eP:throw eX("JWT timestamp claim value failed validation",e,e.code);default:throw eX(e.message,e,e.code)}if(e instanceof g)throw eX("unsupported operation",e,e.code);if(e instanceof DOMException)switch(e.name){case"OperationError":throw eX("runtime operation error",e,eT);case"NotSupportedError":throw eX("runtime unsupported operation",e,eT);case"TimeoutError":throw eX("operation timed out",e,"OAUTH_TIMEOUT");case"AbortError":throw eX("operation aborted",e,"OAUTH_ABORT")}throw new eQ("something went wrong",{cause:e})}async function e1(e,t,r,o,n){let i=new e6(await e3(e,n),t,r,o),s=a.get(i);if(n?.[f]&&(s.fetch=n[f]),n?.timeout&&(s.timeout=n.timeout),n?.execute)for(let e of n.execute)e(i);return i}async function e3(e,t){if(!(e instanceof URL))throw eK('"server" must be an instance of URL',eF);let r=!e.href.includes("/.well-known/"),o=t?.timeout??30,a=AbortSignal.timeout(1e3*o),i=await (r?O(e,{algorithm:t?.algorithm,[f]:t?.[f],[l]:t?.execute?.includes(e8),signal:a,headers:new Headers(n)}):(t?.[f]||fetch)((z(e,!t?.execute?.includes(e8)),e.href),{headers:Object.fromEntries(new Headers({accept:"application/json",...n}).entries()),body:void 0,method:"GET",redirect:"manual",signal:a})).then(e=>U(e$,e)).catch(e0);return r&&new URL(i.issuer).href!==e.href&&(!("https://login.microsoftonline.com"!==e.origin||t?.algorithm&&"oidc"!==t.algorithm)&&(i[e2]=!0,1)||!(!e.hostname.endsWith(".b2clogin.com")||t?.algorithm&&"oidc"!==t.algorithm)||0||(()=>{throw new eQ("discovered metadata issuer does not match the expected issuer",{code:eU,cause:{expected:e.href,body:i,attribute:"issuer"}})})()),i}new TextDecoder;let e2=Symbol();class e6{constructor(e,t,r,o){let n;if("string"!=typeof t||!t.length)throw eK('"clientId" must be a non-empty string',eF);if("string"==typeof r&&(r={client_secret:r}),r?.client_id!==void 0&&t!==r.client_id)throw eK('"clientId" and "metadata.client_id" must be the same',eB);const s={...structuredClone(r),client_id:t};s[p]=r?.[p]??0,s[h]=r?.[h]??30,n=o||("string"==typeof s.client_secret&&s.client_secret.length?function(e){return void 0!==e?D(e):(i||=new WeakMap,(e,t,r,o)=>{let n;return(n=i.get(t))||(function(e,t){if("string"!=typeof e)throw eK(`${t} must be a string`,eF);if(0===e.length)throw eK(`${t} must not be empty`,eB)}(t.client_secret,'"metadata.client_secret"'),n=D(t.client_secret),i.set(t,n)),n(e,t,r,o)})}(s.client_secret):(e,t,r,o)=>{r.set("client_id",t.client_id)});let c=Object.freeze(s);const u=structuredClone(e);e2 in e&&(u[eG]=({claims:{tid:t}})=>e.issuer.replace("{tenantid}",t));let d=Object.freeze(u);(a||=new WeakMap).set(this,{__proto__:null,as:d,c,auth:n,tlsOnly:!0,jwksCache:{}})}serverMetadata(){let e=structuredClone(a.get(this).as);return Object.defineProperties(e,{supportsPKCE:{__proto__:null,value:(t="S256")=>e.code_challenge_methods_supported?.includes(t)===!0}}),e}clientMetadata(){return structuredClone(a.get(this).c)}get timeout(){return a.get(this).timeout}set timeout(e){a.get(this).timeout=e}get[f](){return a.get(this).fetch}set[f](e){a.get(this).fetch=e}}function e8(e){a.get(e).tlsOnly=!1}async function e4(e,t,r,o,i){var s,c,p,h,_;let w,y,b;if(e7(e),i?.flag!==te&&!(t instanceof URL)&&!function(e,t){try{return Object.getPrototypeOf(e)[Symbol.toStringTag]===t}catch{return!1}}(t,"Request"))throw eK('"currentUrl" must be an instance of URL, or Request',eF);let{as:T,c:v,auth:S,fetch:E,tlsOnly:R,jarm:A,hybrid:O,nonRepudiation:P,timeout:U,decrypt:I,implicit:L}=a.get(e);if(i?.flag===te)w=i.authResponse,y=i.redirectUri;else{if(!(t instanceof URL)){let e=t;switch(t=new URL(t.url),e.method){case"GET":break;case"POST":let r=new URLSearchParams(await eW(e));if(O)t.hash=r.toString();else for(let[e,o]of r.entries())t.searchParams.append(e,o);break;default:throw eK("unexpected Request HTTP method",eB)}}switch((s=new URL(s=t)).search="",s.hash="",y=s.href,!0){case!!A:w=await A(t,r?.expectedState);break;case!!O:w=await O(t,r?.expectedNonce,r?.expectedState,r?.maxAge);break;case!!L:throw TypeError("authorizationCodeGrant() cannot be used by response_type=id_token clients");default:try{w=function(e,t,r,o){var n;if(W(e),j(t),r instanceof URL&&(r=r.searchParams),!(r instanceof URLSearchParams))throw d('"parameters" must be an instance of URLSearchParams, or URL',u);if(eD(r,"response"))throw x('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()',eS,{parameters:r});let a=eD(r,"iss"),i=eD(r,"state");if(!a&&e.authorization_response_iss_parameter_supported)throw x('response parameter "iss" (issuer) missing',eS,{parameters:r});if(a&&a!==e.issuer)throw x('unexpected "iss" (issuer) response parameter value',eS,{expected:e.issuer,parameters:r});switch(o){case void 0:case ez:if(void 0!==i)throw x('unexpected "state" response parameter encountered',eS,{expected:void 0,parameters:r});break;case eC:break;default:if(k(o,'"expectedState" argument'),i!==o)throw x(void 0===i?'response parameter "state" missing':'unexpected "state" response parameter value',eS,{expected:o,parameters:r})}if(eD(r,"error"))throw new V("authorization response from the server is an error",{cause:r});let s=eD(r,"id_token"),c=eD(r,"token");if(void 0!==s||void 0!==c)throw new g("implicit and hybrid flows are not supported");return n=new URLSearchParams(r),eu.add(n),n}(T,v,t.searchParams,r?.expectedState)}catch(e){e0(e)}}}let N=await el(T,v,S,w,y,r?.pkceCodeVerifier||ed,{additionalParameters:o,[f]:E,[l]:!R,DPoP:i?.DPoP,headers:new Headers(n),signal:(p=U)?AbortSignal.timeout(1e3*p):void 0}).catch(e0);("string"==typeof r?.expectedNonce||"number"==typeof r?.maxAge)&&(r.idTokenExpected=!0);let H=e_(T,v,N,{expectedNonce:r?.expectedNonce,maxAge:r?.maxAge,requireIdToken:r?.idTokenExpected,[m]:I});try{b=await H}catch(t){if(h=t,_=i,_?.DPoP&&_.flag!==te&&function(e){if(e instanceof q){let{0:t,length:r}=e.cause;return 1===r&&"dpop"===t.scheme&&"use_dpop_nonce"===t.parameters.error}return e instanceof G&&"use_dpop_nonce"===e.error}(h))return e4(e,void 0,r,o,{...i,flag:te,authResponse:w,redirectUri:y});e0(t)}return b.id_token&&await P?.(N),Object.defineProperties(c=b,function(e){let t;if(void 0!==e.expires_in){let r=new Date;r.setSeconds(r.getSeconds()+e.expires_in),t=r.getTime()}return{expiresIn:{__proto__:null,value(){if(t){let e=Date.now();return t>e?Math.floor((t-e)/1e3):0}}},claims:{__proto__:null,value(){try{return ea(this)}catch{return}}}}}(c)),b}function e5(e,t){e7(e);let{as:r,c:o,tlsOnly:n,hybrid:i,jarm:s,implicit:c}=a.get(e),u=$(r,"authorization_endpoint",!1,n);if((t=new URLSearchParams(t)).has("client_id")||t.set("client_id",o.client_id),!t.has("request_uri")&&!t.has("request")){if(t.has("response_type")||t.set("response_type",i?"code id_token":c?"id_token":"code"),c&&!t.has("nonce"))throw eK("response_type=id_token clients must provide a nonce parameter in their authorization request parameters",eB);s&&t.set("response_mode","jwt")}for(let[e,r]of t.entries())u.searchParams.append(e,r);return u}function e9(e,t){e7(e);let{as:r,c:o,tlsOnly:n}=a.get(e),i=$(r,"end_session_endpoint",!1,n);for(let[e,r]of((t=new URLSearchParams(t)).has("client_id")||t.set("client_id",o.client_id),t.entries()))i.searchParams.append(e,r);return i}function e7(e){if(!(e instanceof e6))throw eK('"config" must be an instance of Configuration',eF);if(Object.getPrototypeOf(e)!==e6.prototype)throw eK("subclassing Configuration is not allowed",eB)}Object.freeze(e6.prototype);let te=Symbol();e.s(["authorizationCodeGrant",()=>e4,"buildAuthorizationUrl",()=>e5,"buildEndSessionUrl",()=>e9,"calculatePKCECodeChallenge",()=>eY,"discovery",()=>e1,"randomPKCECodeVerifier",()=>eZ],39351)}];

//# sourceMappingURL=node_modules_openid-client_build_index_3f61b489.js.map
{"version":3,"sources":["turbopack:///[project]/app/customer-portal/dashboard/page.tsx"],"sourcesContent":["/**\n * Customer Portal - Dashboard\n * \n * Main dashboard after login showing account overview\n */\n\nimport type { Metadata } from 'next';\nimport { redirect } from 'next/navigation';\nimport { getSession } from '@/lib/session';\n\nexport const metadata: Metadata = {\n  title: 'Dashboard | Customer Portal',\n};\n\nasync function getCustomerData() {\n  const session = await getSession();\n  \n  if (!session.customerPortalAuth) {\n    return null;\n  }\n\n  // Fetch customer data (cookies forwarded automatically for same-origin requests)\n  const [accountRes, jobsRes, membershipsRes] = await Promise.all([\n    fetch(`${process.env.NEXT_PUBLIC_API_URL || ''}/api/customer-portal/account`, {\n      cache: 'no-store',\n    }),\n    fetch(`${process.env.NEXT_PUBLIC_API_URL || ''}/api/customer-portal/jobs`, {\n      cache: 'no-store',\n    }),\n    fetch(`${process.env.NEXT_PUBLIC_API_URL || ''}/api/customer-portal/memberships`, {\n      cache: 'no-store',\n    }),\n  ]);\n\n  const account = await accountRes.json().catch(() => null);\n  const jobs = await jobsRes.json().catch(() => ({ jobs: [] }));\n  const memberships = await membershipsRes.json().catch(() => ({ memberships: [] }));\n\n  return { account, jobs, memberships };\n}\n\nexport default async function CustomerDashboardPage() {\n  const session = await getSession();\n  \n  if (!session.customerPortalAuth) {\n    redirect('/customer-portal');\n  }\n\n  const data = await getCustomerData();\n\n  if (!data) {\n    redirect('/customer-portal');\n  }\n\n  const { account, jobs, memberships } = data;\n  const customer = account?.customer;\n\n  return (\n    <div className=\"min-h-screen py-16\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"max-w-6xl mx-auto\">\n          {/* Header */}\n          <div className=\"flex justify-between items-start mb-8\">\n            <div>\n              <h1 className=\"text-3xl font-bold mb-2\">Welcome, {customer?.name}</h1>\n              <p className=\"text-muted-foreground\">Customer ID: #{customer?.id}</p>\n            </div>\n            <a \n              href=\"/api/auth/logout\" \n              className=\"text-sm text-muted-foreground hover:text-foreground\"\n            >\n              Logout\n            </a>\n          </div>\n\n          {/* Account Overview */}\n          <div className=\"grid md:grid-cols-3 gap-6 mb-8\">\n            <div className=\"bg-card p-6 rounded-lg\">\n              <h3 className=\"text-sm text-muted-foreground mb-2\">Account Balance</h3>\n              <p className=\"text-2xl font-bold\">\n                ${(customer?.balance || 0).toFixed(2)}\n              </p>\n            </div>\n            <div className=\"bg-card p-6 rounded-lg\">\n              <h3 className=\"text-sm text-muted-foreground mb-2\">Total Jobs</h3>\n              <p className=\"text-2xl font-bold\">{customer?.jobCount || 0}</p>\n            </div>\n            <div className=\"bg-card p-6 rounded-lg\">\n              <h3 className=\"text-sm text-muted-foreground mb-2\">Lifetime Value</h3>\n              <p className=\"text-2xl font-bold\">\n                ${(customer?.lifetimeValue || 0).toFixed(2)}\n              </p>\n            </div>\n          </div>\n\n          {/* Membership Status */}\n          {memberships.hasActiveMembership && (\n            <div className=\"bg-primary/10 border border-primary p-6 rounded-lg mb-8\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h3 className=\"font-semibold text-lg mb-1\">VIP Member</h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Your membership is active\n                  </p>\n                </div>\n                <span className=\"bg-primary text-primary-foreground px-4 py-2 rounded-full text-sm font-semibold\">\n                  Active\n                </span>\n              </div>\n            </div>\n          )}\n\n          {/* Recent Jobs */}\n          <div className=\"bg-card rounded-lg p-6\">\n            <h2 className=\"text-xl font-semibold mb-6\">Recent Service History</h2>\n            {jobs.jobs && jobs.jobs.length > 0 ? (\n              <div className=\"space-y-4\">\n                {jobs.jobs.slice(0, 5).map((job: any) => (\n                  <div key={job.id} className=\"border-b pb-4 last:border-0\">\n                    <div className=\"flex justify-between items-start mb-2\">\n                      <div>\n                        <p className=\"font-semibold\">{job.description || 'Service Call'}</p>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {new Date(job.completedDate).toLocaleDateString()}\n                        </p>\n                      </div>\n                      <span className=\"text-sm font-semibold\">\n                        ${(job.totalAmount || 0).toFixed(2)}\n                      </span>\n                    </div>\n                    {job.serviceType && (\n                      <p className=\"text-sm text-muted-foreground\">{job.serviceType}</p>\n                    )}\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-muted-foreground text-center py-8\">\n                No service history yet\n              </p>\n            )}\n          </div>\n\n          {/* Contact Info */}\n          <div className=\"mt-8 bg-muted/30 p-6 rounded-lg\">\n            <h3 className=\"font-semibold mb-4\">Need Service?</h3>\n            <p className=\"text-muted-foreground mb-4\">\n              Contact us for scheduling, questions, or emergency service\n            </p>\n            <div className=\"flex flex-wrap gap-4\">\n              <a \n                href=\"tel:555-555-5555\"\n                className=\"bg-primary text-primary-foreground px-6 py-2 rounded-lg hover:opacity-90 transition\"\n              >\n                Call: (555) 555-5555\n              </a>\n              <a \n                href=\"/contact\"\n                className=\"bg-accent text-accent-foreground px-6 py-2 rounded-lg hover:opacity-90 transition\"\n              >\n                Contact Form\n              </a>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}
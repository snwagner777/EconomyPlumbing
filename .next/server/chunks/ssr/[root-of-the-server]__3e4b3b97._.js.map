{"version":3,"sources":["turbopack:///[project]/app/email-preferences/page.tsx"],"sourcesContent":["/**\n * Email Preference Center\n * \n * Public page for managing email subscriptions (CAN-SPAM compliance)\n */\n\nimport type { Metadata } from 'next';\n\nexport const metadata: Metadata = {\n  title: 'Email Preferences | Economy Plumbing Services',\n  description: 'Manage your email subscription preferences',\n  robots: 'noindex', // Don't index preference pages\n};\n\ntype Props = {\n  searchParams: Promise<{ token?: string }>;\n};\n\nasync function getPreferences(token: string) {\n  const res = await fetch(\n    `${process.env.NEXT_PUBLIC_API_URL || ''}/api/email-preferences?token=${token}`,\n    { cache: 'no-store' }\n  );\n  \n  if (!res.ok) {\n    return null;\n  }\n  \n  return res.json();\n}\n\nexport default async function EmailPreferencesPage({ searchParams }: Props) {\n  const params = await searchParams;\n  const token = params.token;\n\n  if (!token) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center py-16 px-4\">\n        <div className=\"max-w-md text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">Invalid Link</h1>\n          <p className=\"text-muted-foreground\">\n            This email preference link is invalid or expired. Please use the link from your email.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  const data = await getPreferences(token);\n\n  if (!data) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center py-16 px-4\">\n        <div className=\"max-w-md text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">Not Found</h1>\n          <p className=\"text-muted-foreground\">\n            We couldn't find your email preferences. The link may be expired.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  const prefs = data.preferences;\n\n  return (\n    <div className=\"min-h-screen py-16 px-4\">\n      <div className=\"max-w-2xl mx-auto\">\n        <div className=\"bg-card p-8 rounded-lg shadow-lg\">\n          <h1 className=\"text-3xl font-bold mb-2\">Email Preferences</h1>\n          <p className=\"text-muted-foreground mb-8\">\n            Manage your email subscriptions for {prefs.email}\n          </p>\n\n          <form action=\"/api/email-preferences\" method=\"POST\" className=\"space-y-6\">\n            <input type=\"hidden\" name=\"token\" value={token} />\n\n            <div className=\"space-y-4\">\n              <label className=\"flex items-start gap-3 p-4 border rounded-lg cursor-pointer hover:bg-accent/50\">\n                <input \n                  type=\"checkbox\" \n                  name=\"reviewRequests\" \n                  defaultChecked={prefs.reviewRequests}\n                  className=\"mt-1\"\n                />\n                <div>\n                  <div className=\"font-semibold\">Review Requests</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    Occasional requests to review our service\n                  </div>\n                </div>\n              </label>\n\n              <label className=\"flex items-start gap-3 p-4 border rounded-lg cursor-pointer hover:bg-accent/50\">\n                <input \n                  type=\"checkbox\" \n                  name=\"referralNurture\" \n                  defaultChecked={prefs.referralNurture}\n                  className=\"mt-1\"\n                />\n                <div>\n                  <div className=\"font-semibold\">Referral Program</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    Information about our referral rewards program\n                  </div>\n                </div>\n              </label>\n\n              <label className=\"flex items-start gap-3 p-4 border rounded-lg cursor-pointer hover:bg-accent/50\">\n                <input \n                  type=\"checkbox\" \n                  name=\"quoteFollowup\" \n                  defaultChecked={prefs.quoteFollowup}\n                  className=\"mt-1\"\n                />\n                <div>\n                  <div className=\"font-semibold\">Quote Follow-ups</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    Follow-up on estimates and quotes\n                  </div>\n                </div>\n              </label>\n\n              <label className=\"flex items-start gap-3 p-4 border rounded-lg cursor-pointer hover:bg-accent/50\">\n                <input \n                  type=\"checkbox\" \n                  name=\"marketingEmails\" \n                  defaultChecked={prefs.marketingEmails}\n                  className=\"mt-1\"\n                />\n                <div>\n                  <div className=\"font-semibold\">Marketing & Promotions</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    Special offers, tips, and company updates\n                  </div>\n                </div>\n              </label>\n            </div>\n\n            <div className=\"pt-6 border-t\">\n              <button \n                type=\"submit\"\n                className=\"w-full bg-primary text-primary-foreground px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition\"\n              >\n                Save Preferences\n              </button>\n            </div>\n          </form>\n\n          <div className=\"mt-6 pt-6 border-t text-center\">\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Want to unsubscribe from all marketing emails?\n            </p>\n            <a \n              href={`/api/email-preferences/unsubscribe?token=${token}`}\n              className=\"text-sm text-destructive hover:underline\"\n            >\n              Unsubscribe from All Marketing Emails\n            </a>\n          </div>\n\n          <div className=\"mt-6 text-center text-xs text-muted-foreground\">\n            <p>\n              You will continue to receive transactional emails related to your service appointments.\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}
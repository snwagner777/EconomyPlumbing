module.exports=[816201,a=>{"use strict";let b=(0,a.i(170106).default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],816201)},3688,a=>{"use strict";var b=a.i(572131),c=a.i(872752);function d(a){let[d,e]=b.useState(void 0);return(0,c.useLayoutEffect)(()=>{if(a){e({width:a.offsetWidth,height:a.offsetHeight});let b=new ResizeObserver(b=>{let c,d;if(!Array.isArray(b)||!b.length)return;let f=b[0];if("borderBoxSize"in f){let a=f.borderBoxSize,b=Array.isArray(a)?a[0]:a;c=b.inlineSize,d=b.blockSize}else c=a.offsetWidth,d=a.offsetHeight;e({width:c,height:d})});return b.observe(a,{box:"border-box"}),()=>b.unobserve(a)}e(void 0)},[a]),d}a.s(["useSize",()=>d])},77994,a=>{"use strict";var b=a.i(572131);function c(a){let c=b.useRef({value:a,previous:a});return b.useMemo(()=>(c.current.value!==a&&(c.current.previous=c.current.value,c.current.value=a),c.current.previous),[a])}a.s(["usePrevious",()=>c])},866718,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(368114);let e=c.forwardRef(({className:a,type:c,...e},f)=>(0,b.jsx)("input",{type:c,className:(0,d.cn)("flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:f,...e}));e.displayName="Input",a.s(["Input",()=>e])},870430,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(30553),e=c.forwardRef((a,c)=>(0,b.jsx)(d.Primitive.label,{...a,ref:c,onMouseDown:b=>{b.target.closest("button, input, select, textarea")||(a.onMouseDown?.(b),!b.defaultPrevented&&b.detail>1&&b.preventDefault())}}));e.displayName="Label";var f=a.i(400187),g=a.i(368114);let h=(0,f.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),i=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(e,{ref:d,className:(0,g.cn)(h(),a),...c}));i.displayName=e.displayName,a.s(["Label",()=>i],870430)},370025,a=>{"use strict";var b=a.i(572131),c=a.i(612794),d=a.i(118544),e=a.i(533791),f=a.i(442871),g=class extends e.Subscribable{#a;#b=void 0;#c;#d;constructor(a,b){super(),this.#a=a,this.setOptions(b),this.bindMethods(),this.#e()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(a){let b=this.options;this.options=this.#a.defaultMutationOptions(a),(0,f.shallowEqualObjects)(this.options,b)||this.#a.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#c,observer:this}),b?.mutationKey&&this.options.mutationKey&&(0,f.hashKey)(b.mutationKey)!==(0,f.hashKey)(this.options.mutationKey)?this.reset():this.#c?.state.status==="pending"&&this.#c.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#c?.removeObserver(this)}onMutationUpdate(a){this.#e(),this.#f(a)}getCurrentResult(){return this.#b}reset(){this.#c?.removeObserver(this),this.#c=void 0,this.#e(),this.#f()}mutate(a,b){return this.#d=b,this.#c?.removeObserver(this),this.#c=this.#a.getMutationCache().build(this.#a,this.options),this.#c.addObserver(this),this.#c.execute(a)}#e(){let a=this.#c?.state??(0,c.getDefaultState)();this.#b={...a,isPending:"pending"===a.status,isSuccess:"success"===a.status,isError:"error"===a.status,isIdle:"idle"===a.status,mutate:this.mutate,reset:this.reset}}#f(a){d.notifyManager.batch(()=>{if(this.#d&&this.hasListeners()){let b=this.#b.variables,c=this.#b.context;a?.type==="success"?(this.#d.onSuccess?.(a.data,b,c),this.#d.onSettled?.(a.data,null,b,c)):a?.type==="error"&&(this.#d.onError?.(a.error,b,c),this.#d.onSettled?.(void 0,a.error,b,c))}this.listeners.forEach(a=>{a(this.#b)})})}},h=a.i(937927),i=a.i(916592);function j(a,c){let e=(0,h.useQueryClient)(c),[f]=b.useState(()=>new g(e,a));b.useEffect(()=>{f.setOptions(a)},[f,a]);let j=b.useSyncExternalStore(b.useCallback(a=>f.subscribe(d.notifyManager.batchCalls(a)),[f]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),k=b.useCallback((a,b)=>{f.mutate(a,b).catch(i.noop)},[f]);if(j.error&&(0,i.shouldThrowError)(f.options.throwOnError,[j.error]))throw j.error;return{...j,mutate:k,mutateAsync:j.mutate}}a.s(["useMutation",()=>j],370025)},992258,a=>{"use strict";let b=(0,a.i(170106).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);a.s(["Mail",()=>b],992258)},292e3,a=>{"use strict";let b=(0,a.i(170106).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);a.s(["AlertCircle",()=>b],292e3)},563658,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(507554),e=a.i(470121),f=a.i(750104),g=a.i(225152),h=a.i(77994),i=a.i(3688),j=a.i(30553),k="Switch",[l,m]=(0,f.createContextScope)(k),[n,o]=l(k),p=c.forwardRef((a,f)=>{let{__scopeSwitch:h,name:i,checked:k,defaultChecked:l,required:m,disabled:o,value:p="on",onCheckedChange:q,form:r,...u}=a,[v,w]=c.useState(null),x=(0,e.useComposedRefs)(f,a=>w(a)),y=c.useRef(!1),z=!v||r||!!v.closest("form"),[A=!1,B]=(0,g.useControllableState)({prop:k,defaultProp:l,onChange:q});return(0,b.jsxs)(n,{scope:h,checked:A,disabled:o,children:[(0,b.jsx)(j.Primitive.button,{type:"button",role:"switch","aria-checked":A,"aria-required":m,"data-state":t(A),"data-disabled":o?"":void 0,disabled:o,value:p,...u,ref:x,onClick:(0,d.composeEventHandlers)(a.onClick,a=>{B(a=>!a),z&&(y.current=a.isPropagationStopped(),y.current||a.stopPropagation())})}),z&&(0,b.jsx)(s,{control:v,bubbles:!y.current,name:i,value:p,checked:A,required:m,disabled:o,form:r,style:{transform:"translateX(-100%)"}})]})});p.displayName=k;var q="SwitchThumb",r=c.forwardRef((a,c)=>{let{__scopeSwitch:d,...e}=a,f=o(q,d);return(0,b.jsx)(j.Primitive.span,{"data-state":t(f.checked),"data-disabled":f.disabled?"":void 0,...e,ref:c})});r.displayName=q;var s=a=>{let{control:d,checked:e,bubbles:f=!0,...g}=a,j=c.useRef(null),k=(0,h.usePrevious)(e),l=(0,i.useSize)(d);return c.useEffect(()=>{let a=j.current,b=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(k!==e&&b){let c=new Event("click",{bubbles:f});b.call(a,e),a.dispatchEvent(c)}},[k,e,f]),(0,b.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:e,...g,tabIndex:-1,ref:j,style:{...a.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function t(a){return a?"checked":"unchecked"}var u=a.i(368114);let v=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(p,{className:(0,u.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...c,ref:d,children:(0,b.jsx)(r,{className:(0,u.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));v.displayName=p.displayName,a.s(["Switch",()=>v],563658)},113198,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(370025),f=a.i(591119),g=a.i(699570),h=a.i(866718),i=a.i(870430),j=a.i(563658),k=a.i(478793),l=a.i(992258),m=a.i(816201),n=a.i(292e3),o=a.i(668929);function p(){let{toast:a}=(0,k.useToast)(),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(!1),{data:t,isLoading:u}=(0,d.useQuery)({queryKey:[`/api/email-preferences/${encodeURIComponent(p)}`],enabled:r&&!!p}),v=(0,e.useMutation)({mutationFn:async a=>{let b=await (0,o.apiRequest)("PUT","/api/email-preferences",{email:p,...a});return await b.json()},onSuccess:()=>{a({title:"Preferences Updated",description:"Your email preferences have been saved successfully."}),o.queryClient.invalidateQueries({queryKey:[`/api/email-preferences/${encodeURIComponent(p)}`]})},onError:b=>{a({title:"Update Failed",description:b.message||"Failed to update preferences. Please try again.",variant:"destructive"})}}),w=(0,e.useMutation)({mutationFn:async()=>{let a=await (0,o.apiRequest)("POST","/api/unsubscribe-all",{email:p});return await a.json()},onSuccess:()=>{a({title:"Unsubscribed Successfully",description:"You have been unsubscribed from all email communications."}),o.queryClient.invalidateQueries({queryKey:[`/api/email-preferences/${encodeURIComponent(p)}`]})},onError:b=>{a({title:"Unsubscribe Failed",description:b.message||"Failed to unsubscribe. Please try again.",variant:"destructive"})}}),x=(a,b)=>{v.mutate({[a]:b})};return(0,b.jsx)("div",{className:"min-h-screen bg-background py-12 px-4",children:(0,b.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,b.jsxs)("div",{className:"text-center mb-8",children:[(0,b.jsx)(l.Mail,{className:"w-16 h-16 mx-auto mb-4 text-primary"}),(0,b.jsx)("h1",{className:"text-4xl font-bold mb-2",children:"Email Preferences"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Manage your email subscription preferences"})]}),r?(0,b.jsx)("div",{className:"space-y-6",children:u?(0,b.jsx)(f.Card,{"data-testid":"card-loading",children:(0,b.jsx)(f.CardContent,{className:"py-8",children:(0,b.jsx)("div",{className:"text-center text-muted-foreground",children:"Loading preferences..."})})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(f.Card,{"data-testid":"card-preferences",children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsxs)(f.CardTitle,{children:["Email Preferences for ",p]}),(0,b.jsx)(f.CardDescription,{children:"Choose which emails you'd like to receive"})]}),(0,b.jsxs)(f.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"space-y-1 flex-1",children:[(0,b.jsx)(i.Label,{htmlFor:"marketing",className:"text-base font-medium",children:"Marketing Emails"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Promotions, special offers, and seasonal deals"})]}),(0,b.jsx)(j.Switch,{id:"marketing",checked:!t?.unsubscribedMarketing,onCheckedChange:a=>x("unsubscribedMarketing",!a),disabled:v.isPending||t?.unsubscribedAll,"data-testid":"switch-marketing"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"space-y-1 flex-1",children:[(0,b.jsx)(i.Label,{htmlFor:"reviews",className:"text-base font-medium",children:"Review Requests"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Invitations to share your service experience"})]}),(0,b.jsx)(j.Switch,{id:"reviews",checked:!t?.unsubscribedReviews,onCheckedChange:a=>x("unsubscribedReviews",!a),disabled:v.isPending||t?.unsubscribedAll,"data-testid":"switch-reviews"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"space-y-1 flex-1",children:[(0,b.jsx)(i.Label,{htmlFor:"serviceReminders",className:"text-base font-medium",children:"Service Reminders"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Annual maintenance and service recommendations"})]}),(0,b.jsx)(j.Switch,{id:"serviceReminders",checked:!t?.unsubscribedServiceReminders,onCheckedChange:a=>x("unsubscribedServiceReminders",!a),disabled:v.isPending||t?.unsubscribedAll,"data-testid":"switch-service-reminders"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"space-y-1 flex-1",children:[(0,b.jsx)(i.Label,{htmlFor:"referrals",className:"text-base font-medium",children:"Referral Program"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Earn rewards by referring friends and family"})]}),(0,b.jsx)(j.Switch,{id:"referrals",checked:!t?.unsubscribedReferrals,onCheckedChange:a=>x("unsubscribedReferrals",!a),disabled:v.isPending||t?.unsubscribedAll,"data-testid":"switch-referrals"})]}),t?.unsubscribedAll&&(0,b.jsxs)("div",{className:"flex items-center gap-2 p-4 bg-muted rounded-md","data-testid":"alert-unsubscribed-all",children:[(0,b.jsx)(n.AlertCircle,{className:"w-5 h-5 text-muted-foreground"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"You are currently unsubscribed from all emails. Individual preferences are disabled."})]}),!t?.unsubscribedAll&&(0,b.jsxs)("div",{className:"flex items-center gap-2 p-4 bg-primary/5 rounded-md","data-testid":"status-subscribed",children:[(0,b.jsx)(m.CheckCircle,{className:"w-5 h-5 text-primary"}),(0,b.jsx)("p",{className:"text-sm",children:"You're subscribed to the email types enabled above."})]})]})]}),(0,b.jsxs)(f.Card,{"data-testid":"card-unsubscribe-all",children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{className:"text-destructive",children:"Unsubscribe from All Emails"}),(0,b.jsx)(f.CardDescription,{children:"If you no longer wish to receive any emails from us, you can unsubscribe completely"})]}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)(g.Button,{variant:"destructive",onClick:()=>{window.confirm("Are you sure you want to unsubscribe from all emails? You will no longer receive any communications from us.")&&w.mutate()},disabled:w.isPending||t?.unsubscribedAll,className:"w-full","data-testid":"button-unsubscribe-all",children:t?.unsubscribedAll?"Already Unsubscribed":"Unsubscribe from All"})})]}),(0,b.jsx)("div",{className:"text-center",children:(0,b.jsx)(g.Button,{variant:"ghost",onClick:()=>{s(!1),q("")},"data-testid":"button-change-email",children:"Change Email Address"})})]})}):(0,b.jsxs)(f.Card,{"data-testid":"card-email-input",children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:"Enter Your Email"}),(0,b.jsx)(f.CardDescription,{children:"Enter the email address where you receive our communications"})]}),(0,b.jsx)(f.CardContent,{children:(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),p&&s(!0)},className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"email",children:"Email Address"}),(0,b.jsx)(h.Input,{id:"email",type:"email",placeholder:"your.email@example.com",value:p,onChange:a=>q(a.target.value),required:!0,"data-testid":"input-email"})]}),(0,b.jsx)(g.Button,{type:"submit",className:"w-full","data-testid":"button-continue",children:"Continue"})]})})]}),(0,b.jsx)("div",{className:"mt-12 text-center text-sm text-muted-foreground",children:(0,b.jsxs)("p",{children:["If you need assistance, please contact us at"," ",(0,b.jsx)("a",{href:"mailto:support@economyplumbing.com",className:"text-primary hover:underline",children:"support@economyplumbing.com"})]})})]})})}a.s(["default",()=>p])}];

//# sourceMappingURL=_8fb5e44e._.js.map
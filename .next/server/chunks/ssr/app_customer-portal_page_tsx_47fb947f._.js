module.exports=[755166,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(668929),f=a.i(478793),g=a.i(929423),h=a.i(920238),i=a.i(356283),j=a.i(591119),k=a.i(699570),l=a.i(866718),m=a.i(870430),n=a.i(786304),o=a.i(333140),p=a.i(814574),q=a.i(580701),r=a.i(30553),s=c.forwardRef((a,c)=>{let{ratio:d=1,style:e,...f}=a;return(0,b.jsx)("div",{style:{position:"relative",width:"100%",paddingBottom:`${100/d}%`},"data-radix-aspect-ratio-wrapper":"",children:(0,b.jsx)(r.Primitive.div,{...f,ref:c,style:{...e,position:"absolute",top:0,right:0,bottom:0,left:0}})})});s.displayName="AspectRatio";var t=a.i(389707);a.i(680115);var u=a.i(583930),v=a.i(695245),w=a.i(159501),x=a.i(88780),y=a.i(370025),z=a.i(441921),A=a.i(596221),B=a.i(692759);let C=x.z.object({friendName:x.z.string().min(2,"Friend's name is required"),friendPhone:x.z.string().min(10,"Valid phone number is required"),friendEmail:x.z.string().email("Valid email is required").optional().or(x.z.literal(""))});function D({open:a,onOpenChange:d,customerName:g,customerPhone:h,customerId:i,referralCode:j}){let{toast:m}=(0,f.useToast)(),[n,o]=(0,c.useState)(!0),[q,r]=(0,c.useState)(!0),s=(0,v.useForm)({resolver:(0,w.zodResolver)(C),defaultValues:{friendName:"",friendPhone:"",friendEmail:""}}),t=(0,y.useMutation)({mutationFn:async a=>(0,e.apiRequest)("POST","/api/referrals/send",{referrerName:g,referrerPhone:h,referrerCustomerId:parseInt(i),referralCode:j,refereeName:a.friendName,refereePhone:a.friendPhone,refereeEmail:a.friendEmail||void 0,sendEmail:n&&!!a.friendEmail,sendSMS:q}),onSuccess:()=>{m({title:"Referral sent!",description:"Your friend will receive an SMS and email about your referral."}),s.reset(),d(!1)},onError:a=>{m({title:"Failed to send referral",description:a.message||"Please try again",variant:"destructive"})}});return(0,b.jsx)(p.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(p.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsxs)(p.DialogHeader,{children:[(0,b.jsx)(p.DialogTitle,{children:"Send a Referral"}),(0,b.jsx)(p.DialogDescription,{children:"Invite your friend to Economy Plumbing and you'll both benefit! They get $25 off and you earn credits."})]}),(0,b.jsx)(z.Form,{...s,children:(0,b.jsxs)("form",{onSubmit:s.handleSubmit(a=>{t.mutate(a)}),className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2 p-3 bg-muted rounded-lg",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Your Information"}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground space-y-1",children:[(0,b.jsx)("p",{children:g}),(0,b.jsx)("p",{children:h})]})]}),(0,b.jsx)(z.FormField,{control:s.control,name:"friendName",render:({field:a})=>(0,b.jsxs)(z.FormItem,{children:[(0,b.jsx)(z.FormLabel,{children:"Friend's Name"}),(0,b.jsx)(z.FormControl,{children:(0,b.jsx)(l.Input,{placeholder:"John Smith",...a,"data-testid":"input-friend-name"})}),(0,b.jsx)(z.FormMessage,{})]})}),(0,b.jsx)(z.FormField,{control:s.control,name:"friendPhone",render:({field:a})=>(0,b.jsxs)(z.FormItem,{children:[(0,b.jsx)(z.FormLabel,{children:"Friend's Phone Number"}),(0,b.jsx)(z.FormControl,{children:(0,b.jsx)(l.Input,{type:"tel",placeholder:"(512) 555-1234",...a,"data-testid":"input-friend-phone"})}),(0,b.jsx)(z.FormDescription,{children:"They'll receive an SMS with your referral link"}),(0,b.jsx)(z.FormMessage,{})]})}),(0,b.jsx)(z.FormField,{control:s.control,name:"friendEmail",render:({field:a})=>(0,b.jsxs)(z.FormItem,{children:[(0,b.jsx)(z.FormLabel,{children:"Friend's Email (Optional)"}),(0,b.jsx)(z.FormControl,{children:(0,b.jsx)(l.Input,{type:"email",placeholder:"friend@example.com",...a,"data-testid":"input-friend-email"})}),(0,b.jsx)(z.FormDescription,{children:"They'll also receive an email with your referral link"}),(0,b.jsx)(z.FormMessage,{})]})}),(0,b.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,b.jsx)(k.Button,{type:"submit",className:"flex-1",disabled:t.isPending,"data-testid":"button-send-referral",children:t.isPending?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(A.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(B.Send,{className:"w-4 h-4 mr-2"}),"Send Referral"]})}),(0,b.jsx)(k.Button,{type:"button",variant:"outline",onClick:()=>d(!1),"data-testid":"button-cancel",children:"Cancel"})]})]})})]})})}var E=a.i(546842),F=a.i(660246),G=a.i(941675),H=a.i(104720),I=a.i(790166),J=a.i(641710),K=a.i(816201),L=a.i(292e3),M=a.i(963519),N=a.i(992258),O=a.i(578138),P=a.i(976472),Q=a.i(786520),R=a.i(821374),S=a.i(603314),T=a.i(879808),U=a.i(124987),V=a.i(681010),W=a.i(563588),X=a.i(53569),Y=a.i(705151),Z=a.i(533441),$=a.i(724669),_=a.i(170106);let aa=(0,_.default)("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);var ab=a.i(267900);let ac=(0,_.default)("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);var ad=a.i(717387);function ae(){let a,r,v,w,x,y,z,A,B,C,_,ae,af,ag,ah,ai,aj,ak,[al,am]=(0,c.useState)(""),[an,ao]=(0,c.useState)("email"),[ap,aq]=(0,c.useState)(null),[ar,as]=(0,c.useState)(null),[at,au]=(0,c.useState)(null),[av,aw]=(0,c.useState)(!1),[ax,ay]=(0,c.useState)(!1),[az,aA]=(0,c.useState)(!1),[aB,aC]=(0,c.useState)([]),[aD,aE]=(0,c.useState)([]),[aF,aG]=(0,c.useState)(!1),[aH,aI]=(0,c.useState)("lookup"),[aJ,aK]=(0,c.useState)(""),[aL,aM]=(0,c.useState)(""),[aN,aO]=(0,c.useState)(!1),[aP,aQ]=(0,c.useState)(""),[aR,aS]=(0,c.useState)(""),[aT,aU]=(0,c.useState)(""),[aV,aW]=(0,c.useState)(!1),[aX,aY]=(0,c.useState)(!1),[aZ,a$]=(0,c.useState)(!1),[a_,a0]=(0,c.useState)(null),[a1,a2]=(0,c.useState)(""),[a3,a4]=(0,c.useState)(""),[a5,a6]=(0,c.useState)(!1),[a7,a8]=(0,c.useState)(!1),[a9,ba]=(0,c.useState)(""),[bb,bc]=(0,c.useState)(""),[bd,be]=(0,c.useState)(!1),[bf,bg]=(0,c.useState)(!1),[bh,bi]=(0,c.useState)(null),[bj,bk]=(0,c.useState)(!1),[bl,bm]=(0,c.useState)(!1),[bn,bo]=(0,c.useState)(""),[bp,bq]=(0,c.useState)(""),[br,bs]=(0,c.useState)(""),[bt,bu]=(0,c.useState)(""),[bv,bw]=(0,c.useState)(!1),[bx,by]=(0,c.useState)(null),[bz,bA]=(0,c.useState)(!1),[bB,bC]=(0,c.useState)(""),[bD,bE]=(0,c.useState)(""),[bF,bG]=(0,c.useState)(""),[bH,bI]=(0,c.useState)(""),[bJ,bK]=(0,c.useState)(""),[bL,bM]=(0,c.useState)(!1),[bN,bO]=(0,c.useState)(!1),[bP,bQ]=(0,c.useState)(0),[bR,bS]=(0,c.useState)(""),[bT,bU]=(0,c.useState)(!1),[bV,bW]=(0,c.useState)(!1),[bX,bY]=(0,c.useState)(null),bZ=(0,u.usePhoneConfig)(),{toast:b$}=(0,f.useToast)(),{data:b_,isLoading:b0,error:b1}=(0,d.useQuery)({queryKey:["/api/servicetitan/customer",ap],enabled:!!ap}),{data:b2}=(0,d.useQuery)({queryKey:["/api/referrals/customer",ap],enabled:!!ap}),{data:b3}=(0,d.useQuery)({queryKey:["/api/referrals/code",ap],enabled:!!ap}),{data:b4}=(0,d.useQuery)({queryKey:["/api/servicetitan/arrival-windows"]}),{data:b5}=(0,d.useQuery)({queryKey:["/api/portal/customer-stats",ap],enabled:!!ap}),{data:b6}=(0,d.useQuery)({queryKey:["/api/portal/customer-locations",ap],enabled:!!ap}),{data:b7}=(0,d.useQuery)({queryKey:["/api/portal/customer",ap,"emails"],enabled:!!ap}),b8=b4?.windows||[],b9=b6?.locations||[],ca=b_?.appointments.filter(a=>{let b=new Date(a.start)>new Date,c=!["Done","Completed","Cancelled"].includes(a.status);return b&&c})||[],cb=b_?.appointments.filter(a=>{let b=new Date(a.start)<=new Date,c=["Done","Completed","Cancelled"].includes(a.status);return b||c})||[];(0,c.useEffect)(()=>{let a=new URLSearchParams(window.location.search).get("token");a?cd(a):cc()},[]);let cc=async()=>{try{let a=await fetch("/api/portal/session");if(a.ok){let b=await a.json();b.customerId&&(console.log("[Portal] Found active session, auto-logging in..."),aq(b.customerId.toString()),aE(b.availableCustomerIds||[b.customerId]),aI("authenticated"))}}catch(a){console.log("[Portal] No active session found")}},cd=async a=>{aO(!0);try{let b=await fetch("/api/portal/auth/verify-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contactValue:"",code:a})});if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Invalid or expired magic link")}let c=await b.json();if(c.customers&&c.customers.length>1)aC(c.customers),aE(c.customers.map(a=>a.id)),aI("select-account"),au("Please select which account you'd like to access");else if(c.customers&&1===c.customers.length){let a=c.customers[0].id.toString();aq(a),aE([c.customers[0].id]),aI("authenticated"),au("Welcome to your customer portal!")}else if(c.customerId){let a=c.customerId.toString();aq(a),aE([c.customerId]),aI("authenticated"),au("Welcome to your customer portal!")}else throw Error("No customer data returned");as(null),window.history.replaceState({},document.title,window.location.pathname)}catch(a){console.error("Magic link verification failed:",a),as(a.message||"The magic link is invalid or has expired. Please try again."),au(null)}finally{aO(!1)}},ce=async()=>{if(al.trim()){as(null),au(null),aw(!0);try{let a=await fetch("/api/portal/auth/send-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contactValue:al,verificationType:"phone"===an?"sms":"email"})});if(!a.ok){let b=await a.json().catch(()=>({}));throw Error(b.error||"Customer not found")}let b=await a.json();aI("verify-code"),aM(b.message),au(b.message)}catch(a){console.error("Customer lookup failed:",a),as(a.message||"We couldn't find an account with that information. Please verify and try again.")}finally{aw(!1)}}},cf=async()=>{if(aJ.trim()){as(null),au(null),aO(!0);try{let a=await fetch("/api/portal/auth/verify-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contactValue:al,code:aJ})});if(!a.ok){let b=await a.json().catch(()=>({}));throw Error(b.error||"Invalid verification code")}let b=await a.json();if(b.customers&&b.customers.length>1)aC(b.customers),aE(b.customers.map(a=>a.id)),aI("select-account"),au("Please select which account you'd like to access");else if(b.customers&&1===b.customers.length){let a=b.customers[0].id.toString();aq(a),aE([b.customers[0].id]),aI("authenticated"),au("Welcome to your customer portal!")}else if(b.customerId){let a=b.customerId.toString();aq(a),aE([b.customerId]),aI("authenticated"),au("Welcome to your customer portal!")}else throw Error("No customer data returned")}catch(a){console.error("Verification failed:",a),as(a.message||"Invalid verification code. Please try again.")}finally{aO(!1)}}},cg=async a=>{try{if("select-account"===aH)aq(a.toString()),aI("authenticated"),aG(!1);else{if(!(await fetch("/api/portal/switch-account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:a})})).ok)throw Error("Failed to switch account");aq(a.toString()),aG(!1),e.queryClient.invalidateQueries({queryKey:["/api/servicetitan/customer"]})}}catch(a){console.error("Account switch error:",a),as("Failed to switch account. Please try again.")}},ch=async()=>{if(aD.length>1)try{let a=aD.map(async a=>{let b=await fetch(`/api/servicetitan/customer/${a}`),c=await b.json();return{id:c.customer.id,name:c.customer.name,type:"Residential",address:c.customer.address?[c.customer.address.street,c.customer.address.city,c.customer.address.state].filter(Boolean).join(", "):void 0}}),b=await Promise.all(a);aC(b),aG(!0)}catch(a){console.error("Failed to load account details:",a),as("Failed to load account details")}},ci=()=>{aI("lookup"),aK(""),as(null),aM(""),aQ(""),aS(""),aU("")},cj=async()=>{if(aP.trim()){as(null),au(null),aW(!0);try{let a=await fetch("/api/portal/auth/lookup-by-phone",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:aP})});if(!a.ok){let b=await a.json().catch(()=>({}));throw Error(b.error||"Account not found")}let b=await a.json();aS(b.maskedEmail),aU(b.lookupToken),aI("phone-email-found"),au(`We found your account! We'll send a login link to ${b.maskedEmail}`)}catch(a){console.error("Phone lookup failed:",a),as(a.message||"We couldn't find an account with that phone number.")}finally{aW(!1)}}},ck=async()=>{as(null),au(null),aY(!0);try{let a=await fetch("/api/portal/auth/send-phone-magic-link",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lookupToken:aT})});if(!a.ok){let b=await a.json().catch(()=>({}));throw Error(b.error||"Failed to send login link")}let b=await a.json();au(b.message||`Magic link sent to ${aR}! Check your email.`),b$({title:"Check your email!",description:`We've sent a login link to ${aR}`})}catch(a){console.error("Send magic link failed:",a),as(a.message||"Failed to send login link. Please try again.")}finally{aY(!1)}},cl=async()=>{if(a_&&a1&&a3&&ap){a6(!0);try{let[a,b]=a3.split("-");if(!b8.find(a=>`${a.start}-${a.end}`===a3))throw Error("Invalid time window selected");let c=new Date(`${a1}T${a}:00`),d=new Date(`${a1}T${b}:00`),e=await fetch("/api/portal/reschedule-appointment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appointmentId:a_.id,newStart:c.toISOString(),newEnd:d.toISOString(),customerId:ap})}),f=await e.json();if(!e.ok)throw Error(f.error||"Failed to reschedule appointment");window.location.reload(),a$(!1)}catch(a){console.error("Reschedule error:",a)}finally{a6(!1)}}},cm=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a),cn=a=>new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),co=async()=>{if(b3?.url)try{await navigator.clipboard.writeText(b3.url),ay(!0),setTimeout(()=>ay(!1),2e3)}catch(a){console.error("Copy failed:",a)}},cp=async(a,b,c,d)=>{try{if(!(await fetch("/api/portal/request-pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:a,number:b,id:c,customerId:d.customerId,customerName:d.customerName,customerEmail:d.customerEmail})})).ok)throw Error("Failed to send request");b$({title:"PDF Request Received",description:`We'll email the ${a} PDF to ${d.customerEmail} by the next business day.`})}catch(a){console.error("PDF request failed:",a),b$({title:"Request Failed",description:"Unable to send the PDF request. Please try again or contact support.",variant:"destructive"})}},cq=async()=>{if(ap){be(!0);try{if(!(await fetch("/api/portal/update-contacts",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:parseInt(ap),email:a9,phone:bb})})).ok)throw Error("Failed to update contacts");a8(!1),window.location.reload()}catch(a){console.error("Update contacts error:",a)}finally{be(!1)}}},cr=async()=>{try{if(!(await fetch("/api/portal/logout",{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw Error("Failed to logout");aq(null),aE([]),aI("lookup"),ao("phone"),am(""),aK(""),b$({title:"Signed out",description:"You have been successfully signed out."})}catch(a){console.error("Logout error:",a),b$({title:"Error",description:"Failed to sign out. Please try again.",variant:"destructive"})}},cs=async()=>{if(ap&&bh){bk(!0);try{let a=await fetch("/api/portal/delete-contact",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:parseInt(ap),contactId:bh.id})});if(!a.ok){let b=await a.json().catch(()=>({error:"Failed to delete contact"}));throw Error(b.error||"Failed to delete contact")}b$({title:"Contact deleted",description:`${bh.type} successfully removed from your account.`}),bg(!1),bi(null),e.queryClient.invalidateQueries({queryKey:["/api/servicetitan/customer",ap]})}catch(a){console.error("Delete contact error:",a),b$({title:"Error deleting contact",description:a.message||"Failed to delete contact. Please try again.",variant:"destructive"})}finally{bk(!1)}}},ct=async()=>{if(ap&&bx&&bn&&bp&&br&&bt){bw(!0);try{if(!(await fetch("/api/portal/update-address",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:parseInt(ap),locationId:bx,street:bn,city:bp,state:br,zip:bt})})).ok)throw Error("Failed to update address");bm(!1),window.location.reload()}catch(a){console.error("Update address error:",a)}finally{bw(!1)}}},cu=a=>new Date(a).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),cv=a=>{let c=a.toLowerCase();return c.includes("scheduled")||c.includes("pending")?(0,b.jsxs)(n.Badge,{variant:"secondary","data-testid":`badge-status-${a}`,children:[(0,b.jsx)(J.Clock,{className:"w-3 h-3 mr-1"}),a]}):c.includes("completed")||c.includes("paid")?(0,b.jsxs)(n.Badge,{"data-testid":`badge-status-${a}`,children:[(0,b.jsx)(K.CheckCircle,{className:"w-3 h-3 mr-1"}),a]}):c.includes("cancelled")||c.includes("overdue")?(0,b.jsxs)(n.Badge,{variant:"destructive","data-testid":`badge-status-${a}`,children:[(0,b.jsx)(L.AlertCircle,{className:"w-3 h-3 mr-1"}),a]}):(0,b.jsx)(n.Badge,{variant:"outline","data-testid":`badge-status-${a}`,children:a})},cw=a=>a.expirationStatus?"expired"===a.expirationStatus?(0,b.jsxs)(n.Badge,{variant:"destructive",className:"text-xs",children:[(0,b.jsx)(L.AlertCircle,{className:"w-3 h-3 mr-1"}),"Expired"]}):"expiring_soon"===a.expirationStatus?(0,b.jsxs)(n.Badge,{variant:"secondary",className:"text-xs bg-yellow-500/10 text-yellow-600 dark:text-yellow-400",children:[(0,b.jsx)(J.Clock,{className:"w-3 h-3 mr-1"}),"Expires in ",a.daysUntilExpiration," days"]}):a.daysUntilExpiration<30?(0,b.jsxs)(n.Badge,{variant:"outline",className:"text-xs",children:["Valid for ",a.daysUntilExpiration," days"]}):null:null;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.SEOHead,{title:"Customer Portal - Economy Plumbing Services",description:"Access your service history, appointments, and invoices. View your Economy Plumbing Services account information and upcoming appointments."}),(0,b.jsx)(h.default,{isPortalAuthenticated:"authenticated"===aH,onPortalLogout:cr}),(0,b.jsx)("main",{className:"min-h-screen py-12 px-4",children:(0,b.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,b.jsxs)("div",{className:"text-center mb-12",children:[(0,b.jsx)("h1",{className:"text-4xl md:text-5xl font-bold mb-4",children:"authenticated"===aH&&b_?(a=new Date().getHours(),r=new Date().getDay(),v=new Date().getMonth(),w=b5?.serviceCount||0,x=b_.customer.name?.split(" ")[0]||"there",y=[],a<12?(y.push(`Good morning, ${x}!`),y.push(`Rise and shine, ${x}!`),y.push(`Morning, ${x}! Ready to tackle the day?`)):a<17?(y.push(`Good afternoon, ${x}!`),y.push(`Hey ${x}, hope your day is going well!`),y.push(`Afternoon, ${x}!`)):(y.push(`Good evening, ${x}!`),y.push(`Evening, ${x}!`),y.push(`Hey ${x}, winding down for the day?`)),1===r?(y.push(`Happy Monday, ${x}!`),y.push(`Monday motivation, ${x}!`)):5===r?(y.push(`TGIF, ${x}!`),y.push(`Happy Friday, ${x}!`)):(0===r||6===r)&&(y.push(`Happy weekend, ${x}!`),y.push(`Enjoying your weekend, ${x}?`)),w>20?(y.push(`Welcome back, ${x}! You're practically family!`),y.push(`Hey ${x}, our VIP customer!`),y.push(`${x}, always great to see you!`)):w>10?(y.push(`Welcome back, ${x}! Thanks for your loyalty!`),y.push(`Great to see you again, ${x}!`)):w>5?(y.push(`Welcome back, ${x}!`),y.push(`Good to see you, ${x}!`)):0===w?(y.push(`Welcome, ${x}! Excited to serve you!`),y.push(`Hello ${x}! Let's get started!`)):(y.push(`Welcome back, ${x}!`),y.push(`Hello again, ${x}!`)),11===v?(y.push(`Happy holidays, ${x}!`),y.push(`Season's greetings, ${x}!`)):0===v?y.push(`Happy New Year, ${x}!`):6===v||7===v?(y.push(`Enjoying the summer, ${x}?`),y.push(`Stay cool, ${x}!`)):2===v||3===v?y.push(`Happy spring, ${x}!`):(9===v||10===v)&&y.push(`Happy fall, ${x}!`),y.push(`Hey ${x}! How can we help today?`),y.push(`${x}, great to have you here!`),y.push(`Welcome, ${x}!`),y.push(`Hello ${x}! What brings you here today?`),y.push(`${x}, we're here to help!`),z=Math.floor(Math.random()*y.length),y[z]):"Customer Portal"}),(0,b.jsx)("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"authenticated"===aH?"Your service history, appointments, and account details":"Access your service history, appointments, and invoices"})]}),ap?(0,b.jsx)("div",{className:"space-y-6",children:b0?(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center space-y-4 p-8 max-w-md",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-primary border-t-transparent mx-auto"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h3",{className:"text-xl font-semibold",children:"Loading Your Account"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"We're fetching your service history, appointments, and account details..."})]})]})}),(0,b.jsxs)("div",{className:"space-y-6 opacity-30 pointer-events-none",children:[(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(o.Skeleton,{className:"h-8 w-8 rounded-full"}),(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Skeleton,{className:"h-6 w-32 mb-2"}),(0,b.jsx)(o.Skeleton,{className:"h-4 w-24"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(o.Skeleton,{className:"h-10 w-32"}),(0,b.jsx)(o.Skeleton,{className:"h-10 w-28"}),(0,b.jsx)(o.Skeleton,{className:"h-10 w-24"})]})]}),(0,b.jsx)(j.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(o.Skeleton,{className:"h-4 w-32"}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,b.jsx)(o.Skeleton,{className:"h-20"}),(0,b.jsx)(o.Skeleton,{className:"h-20"})]}),(0,b.jsx)(o.Skeleton,{className:"h-4 w-32 mt-6"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(o.Skeleton,{className:"h-20"}),(0,b.jsx)(o.Skeleton,{className:"h-20"})]})]})})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsx)(o.Skeleton,{className:"h-6 w-48"}),(0,b.jsx)(o.Skeleton,{className:"h-4 w-32 mt-2"})]}),(0,b.jsx)(j.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(o.Skeleton,{className:"h-32"}),(0,b.jsx)(o.Skeleton,{className:"h-32"})]})})]}),(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsx)(o.Skeleton,{className:"h-6 w-40"}),(0,b.jsx)(o.Skeleton,{className:"h-4 w-28 mt-2"})]}),(0,b.jsx)(j.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(o.Skeleton,{className:"h-32"}),(0,b.jsx)(o.Skeleton,{className:"h-32"})]})})]})]}),(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsx)(o.Skeleton,{className:"h-6 w-36"}),(0,b.jsx)(o.Skeleton,{className:"h-4 w-48 mt-2"})]}),(0,b.jsx)(j.CardContent,{children:(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,b.jsx)(o.Skeleton,{className:"h-40"}),(0,b.jsx)(o.Skeleton,{className:"h-40"})]})})]})]})]}):b1?(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center mb-6",children:[(0,b.jsx)(L.AlertCircle,{className:"w-12 h-12 mx-auto mb-4 text-destructive"}),(0,b.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Error Loading Data"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-4",children:"We couldn't load your account information. Please try again."}),(0,b.jsx)(k.Button,{onClick:()=>aq(null),"data-testid":"button-try-again",children:"Try Again"})]})})}):b_?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{className:"flex flex-row items-center justify-between gap-4 flex-wrap",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(E.User,{className:"w-8 h-8 text-primary"}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.CardTitle,{children:b_.customer.name}),(0,b.jsx)(j.CardDescription,{children:"Customer Account"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,b.jsxs)(k.Button,{onClick:t.openScheduler,"data-testid":"button-schedule-appointment",children:[(0,b.jsx)(G.Calendar,{className:"w-4 h-4 mr-2"}),"Schedule Appointment"]}),(0,b.jsx)(k.Button,{asChild:!0,variant:"outline","data-testid":"button-call",children:(0,b.jsxs)("a",{href:`tel:${bZ.tel}`,children:[(0,b.jsx)(M.Phone,{className:"w-4 h-4 mr-2"}),"Call ",bZ.display]})}),(0,b.jsx)(k.Button,{asChild:!0,variant:"outline","data-testid":"button-text",children:(0,b.jsxs)("a",{href:`sms:${bZ.tel}`,children:[(0,b.jsx)(W.MessageSquare,{className:"w-4 h-4 mr-2"}),"Text Us"]})}),(0,b.jsxs)(k.Button,{variant:"outline","data-testid":"button-email-us",onClick:()=>{bG(b_?.customer?.name||""),bI(b_?.customer?.email||""),bK(b_?.customer?.phoneNumber||""),bC(""),bE(""),bA(!0)},children:[(0,b.jsx)(N.Mail,{className:"w-4 h-4 mr-2"}),"Email Us"]}),aD.length>1&&(0,b.jsxs)(k.Button,{variant:"outline",onClick:ch,"data-testid":"button-switch-account",children:[(0,b.jsx)(F.Users,{className:"w-4 h-4 mr-2"}),"Switch Account"]})]})]}),(0,b.jsx)(j.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold",children:"Contact Information"}),(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>{b_&&(ba(b_.customer.email||""),bc(b_.customer.phoneNumber||""),a8(!0))},"data-testid":"button-edit-contacts",children:"Edit"})]}),b_.customer.contacts&&b_.customer.contacts.length>0?(0,b.jsx)("div",{className:"space-y-3",children:b_.customer.contacts.map((a,c)=>{let d="Email"===a.type,e="Phone"===a.type||"MobilePhone"===a.type;return d||e?(0,b.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-lg",children:[d?(0,b.jsx)(N.Mail,{className:"w-4 h-4 text-primary flex-shrink-0 mt-0.5"}):(0,b.jsx)(M.Phone,{className:"w-4 h-4 text-primary flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-0.5",children:"MobilePhone"===a.type?"Mobile":a.type}),(0,b.jsx)("p",{className:"font-medium break-all","data-testid":`contact-${a.type.toLowerCase()}-${c}`,children:a.value}),a.memo&&"email"!==a.memo&&"Phone"!==a.memo&&"mobile"!==a.memo&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5",children:a.memo})]}),(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>{bi({id:a.id,type:a.type,value:a.value}),bg(!0)},"data-testid":`button-delete-contact-${a.id}`,className:"flex-shrink-0 text-destructive hover:text-destructive",children:"Delete"})]},a.id):null})}):(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Phone"}),(0,b.jsx)("p",{className:"font-medium","data-testid":"text-customer-phone",children:b_.customer.phoneNumber||"Not provided"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Email"}),(0,b.jsx)("p",{className:"font-medium","data-testid":"text-customer-email",children:b_.customer.email||"Not provided"})]})]})]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsx)(s,{ratio:1,children:(A=b_.memberships&&b_.memberships.length>0?b_.memberships[0]:null,B=A?.membershipType?.toLowerCase()||"",C={bgClass:"bg-background",borderClass:"border-primary/20",iconClass:"text-primary",icon:Q.Crown,name:"VIP"},B.includes("platinum")?C={bgClass:"bg-gradient-to-br from-purple-50 to-slate-50 dark:from-purple-950/20 dark:to-slate-950/20",borderClass:"border-purple-300/50 dark:border-purple-700/50",iconClass:"text-purple-600 dark:text-purple-400",icon:Q.Crown,name:"Platinum"}:B.includes("silver")?C={bgClass:"bg-gradient-to-br from-slate-50 to-gray-50 dark:from-slate-900/20 dark:to-gray-900/20",borderClass:"border-slate-300/50 dark:border-slate-600/50",iconClass:"text-slate-600 dark:text-slate-400",icon:S.Shield,name:"Silver"}:B.includes("rental")?C={bgClass:"bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20",borderClass:"border-blue-300/50 dark:border-blue-700/50",iconClass:"text-blue-600 dark:text-blue-400",icon:ab.Building2,name:"Rental"}:B.includes("commercial")&&(C={bgClass:"bg-gradient-to-br from-slate-900 to-slate-800 dark:from-slate-950 dark:to-slate-900",borderClass:"border-amber-400/50 dark:border-amber-500/50",iconClass:"text-amber-500 dark:text-amber-400",icon:ac,name:"Commercial"}),_=C.icon,ae=A?.isExpired||!1,af=A&&!ae,(0,b.jsx)(j.Card,{className:`hover-elevate w-full h-full overflow-hidden cursor-pointer border-2 ${C.borderClass} ${C.bgClass}`,"data-testid":"card-vip-status",onClick:()=>{let a=document.getElementById("vip-membership-section");a?.scrollIntoView({behavior:"smooth",block:"start"})},children:(0,b.jsxs)(j.CardContent,{className:"p-4 flex flex-col items-center justify-center text-center w-full h-full relative",children:[(0,b.jsx)(_,{className:`w-8 h-8 mb-2 ${C.iconClass}`}),af?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"text-base font-bold mb-1",children:[C.name," Member"]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-1 truncate w-full px-2",children:A.membershipType}),A.expirationDate&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mb-1",children:["Until ",new Date(A.expirationDate).toLocaleDateString("en-US",{month:"short",year:"numeric"})]}),(0,b.jsx)(n.Badge,{variant:"default",className:"text-xs mt-1",children:"Active"})]}):ae&&A?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"text-base font-bold mb-1",children:"Membership Expired"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-1 truncate w-full px-2",children:A.membershipType}),A.expirationDate&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mb-1",children:["Expired ",new Date(A.expirationDate).toLocaleDateString("en-US",{month:"short",year:"numeric"})]}),(0,b.jsx)(k.Button,{size:"sm",variant:"default",className:"text-xs mt-1",onClick:a=>{a.stopPropagation(),window.open("/vip-membership","_blank")},children:"Renew Now"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"text-base font-bold mb-1",children:"Not a Member"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:"Join our VIP Program"}),(0,b.jsx)(k.Button,{size:"sm",variant:"default",className:"text-xs",onClick:a=>{a.stopPropagation(),window.open("/vip-membership","_blank")},children:"Start Membership"})]}),(0,b.jsx)("p",{className:"text-xs text-primary mt-2 absolute bottom-2",children:"View Details ‚Üí"})]})}))}),b5&&(0,b.jsx)(s,{ratio:1,children:(()=>{if(0===b5.serviceCount||null===b5.topPercentile)return(0,b.jsx)(j.Card,{className:"hover-elevate w-full h-full overflow-hidden cursor-pointer","data-testid":"card-service-history",onClick:()=>{let a=document.getElementById("job-history-section");a?.scrollIntoView({behavior:"smooth",block:"start"})},children:(0,b.jsxs)(j.CardContent,{className:"p-4 flex flex-col items-center justify-center text-center w-full h-full relative",children:[(0,b.jsx)(V.Home,{className:"w-8 h-8 text-primary mb-2"}),(0,b.jsx)("div",{className:"text-base font-bold mb-1",children:"Welcome!"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:"New to Economy Plumbing"}),(0,b.jsx)(n.Badge,{variant:"secondary",className:"text-xs mb-1",children:"üéâ First Time Customer"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1 px-2 line-clamp-3",children:"We're excited to serve you! Schedule your first service or call us at (512) 259-7222 for any plumbing needs."}),(0,b.jsx)("p",{className:"text-xs text-primary mt-2 absolute bottom-2",children:"Get Started ‚Üí"})]})});let a=Math.min(99,100-b5.topPercentile),c="",d=P.Heart,e="default",f="‚≠ê";b5.topPercentile<=5?(c=`You're in our elite ${b5.topPercentile}%! You've had more services than ${a}% of our customers. Thank you for being such a loyal customer!`,d=R.Star,f="üåü",e="default"):b5.topPercentile<=25?(c=`You've had more services than ${a}% of our customers. We really appreciate your business!`,d=P.Heart,f="‚≠ê",e="default"):b5.topPercentile<=50?(c=`Thank you for choosing us! You've had more services than ${a}% of our customers.`,d=P.Heart,f="‚úì",e="secondary"):(c="We're here when you need us! Remember, we offer maintenance plans, emergency services, and more. Give us a call anytime at (512) 259-7222!",d=M.Phone,f="üìû",e="outline");let g=d;return(0,b.jsx)(j.Card,{className:"hover-elevate w-full h-full overflow-hidden cursor-pointer","data-testid":"card-service-history",onClick:()=>{let a=document.getElementById("job-history-section");a?.scrollIntoView({behavior:"smooth",block:"start"})},children:(0,b.jsxs)(j.CardContent,{className:"p-4 flex flex-col items-center justify-center text-center w-full h-full relative",children:[(0,b.jsx)(g,{className:"w-8 h-8 text-primary mb-2"}),(0,b.jsx)("div",{className:"text-base font-bold mb-1",children:b5.topPercentile<=5?"Elite Customer!":b5.topPercentile<=25?"Valued Customer!":b5.topPercentile<=50?"Thank You!":"We Miss You!"}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mb-2",children:[b5.serviceCount," service",1===b5.serviceCount?"":"s"," with us"]}),b5.topPercentile<=50&&(0,b.jsxs)(n.Badge,{variant:e,className:"text-xs mb-1",children:[f," Better than ",a,"%"]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1 px-2 line-clamp-3",children:c}),(0,b.jsx)("p",{className:"text-xs text-primary mt-2 absolute bottom-2",children:"View History ‚Üí"})]})})})()}),(0,b.jsx)(s,{ratio:1,children:(0,b.jsx)(j.Card,{className:"hover-elevate w-full h-full overflow-hidden cursor-pointer","data-testid":"card-referrals",onClick:()=>{let a=document.getElementById("referral-section");a?.scrollIntoView({behavior:"smooth",block:"start"})},children:(0,b.jsxs)(j.CardContent,{className:"p-4 flex flex-col items-center justify-center text-center w-full h-full relative",children:[(0,b.jsx)(X.Share2,{className:"w-8 h-8 text-primary mb-2"}),(ag=(b2?.referrals.filter(a=>"credited"===a.status)||[]).reduce((a,b)=>a+(b.creditAmount||0),0),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-primary mb-1","data-testid":"text-account-credit",children:cm(ag/100)}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"Account Credit"}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[b2?.referrals.length||0," referral",b2?.referrals.length===1?"":"s"]})]})),(0,b.jsx)("p",{className:"text-xs text-primary mt-2 absolute bottom-2",children:"View Details ‚Üí"})]})})}),(0,b.jsx)(s,{ratio:1,children:(0,b.jsx)(j.Card,{className:"hover-elevate w-full h-full overflow-hidden cursor-pointer","data-testid":"card-upcoming-appointments",onClick:()=>{let a=document.getElementById("appointments-section");a?.scrollIntoView({behavior:"smooth",block:"start"})},children:(0,b.jsxs)(j.CardContent,{className:"p-4 flex flex-col items-center justify-center text-center w-full h-full relative",children:[(0,b.jsx)(G.Calendar,{className:"w-8 h-8 text-primary mb-2"}),ca.length>0?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"text-base font-bold mb-1","data-testid":"text-next-appointment-date",children:new Date(ca[0].start).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:cu(ca[0].start)}),ca[0].businessUnitName&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground truncate w-full px-1",children:ca[0].businessUnitName}),ca.length>1&&(0,b.jsxs)(n.Badge,{variant:"secondary",className:"text-xs mt-1",children:["+",ca.length-1," more"]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"text-base font-bold mb-1",children:"None Scheduled"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"No upcoming appointments"})]}),(0,b.jsx)("p",{className:"text-xs text-primary mt-2 absolute bottom-2",children:"View All ‚Üí"})]})})})]}),(ai=.15*(ah=b_.invoices.filter(a=>a.status.toLowerCase().includes("paid")||a.status.toLowerCase().includes("complete")).reduce((a,b)=>a+b.total,0)),aj=b_.memberships&&b_.memberships.length>0,ah<100?null:(0,b.jsxs)(j.Card,{className:`border-2 ${aj?"border-primary/30 bg-gradient-to-br from-primary/10 via-primary/5 to-background":"border-amber-500/30 bg-gradient-to-br from-amber-500/10 via-amber-500/5 to-background"}`,children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${aj?"bg-primary/20":"bg-amber-500/20"}`,children:(0,b.jsx)($.TrendingUp,{className:`w-6 h-6 ${aj?"text-primary":"text-amber-600 dark:text-amber-500"}`})}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.CardTitle,{className:"text-2xl",children:aj?(0,b.jsxs)("span",{className:"text-primary",children:["You've Saved ",cm(ai)]}):(0,b.jsxs)("span",{className:"text-amber-600 dark:text-amber-500",children:["Save ",cm(ai)]})}),(0,b.jsx)(j.CardDescription,{className:"mt-1",children:aj?"with your VIP membership":"by becoming a VIP member"})]})]}),!aj&&(0,b.jsx)(n.Badge,{variant:"outline",className:"text-amber-600 border-amber-500/50 dark:text-amber-500",children:"Opportunity"})]})}),(0,b.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-background/50 rounded-lg border",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Services"}),(0,b.jsx)("p",{className:"text-2xl font-bold","data-testid":"text-total-paid",children:cm(ah)})]}),(0,b.jsx)(I.DollarSign,{className:"w-8 h-8 text-muted-foreground/30"})]}),aj?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:["As a VIP member, you've enjoyed ",(0,b.jsx)("strong",{className:"text-primary",children:"member-only discounts"})," on every service call, plus priority scheduling, no trip charges, and waived diagnostic fees."]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg border border-primary/20",children:[(0,b.jsx)(K.CheckCircle,{className:"w-5 h-5 text-primary flex-shrink-0"}),(0,b.jsx)("p",{className:"text-sm font-medium",children:"Your membership is saving you money on every visit!"})]})]}):(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:["Based on your service history, you could save approximately ",(0,b.jsx)("strong",{className:"text-amber-600 dark:text-amber-500",children:cm(ai)})," per year as a VIP member, plus enjoy priority scheduling, no trip charges, and waived diagnostic fees."]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground italic",children:"*Estimated savings based on typical 15% member discount applied to your historical spending"}),(0,b.jsx)(k.Button,{asChild:!0,className:"w-full bg-amber-600 hover:bg-amber-700 text-white dark:bg-amber-500 dark:hover:bg-amber-600",size:"lg","data-testid":"button-join-vip-savings",children:(0,b.jsxs)("a",{href:"/membership-benefits",children:[(0,b.jsx)(Q.Crown,{className:"w-4 h-4 mr-2"}),"Start Saving with VIP Membership"]})})]})]})]})),(0,b.jsx)("div",{id:"vip-membership-section",children:b_.memberships&&b_.memberships.length>0?(0,b.jsxs)(j.Card,{className:"border-primary/20 bg-gradient-to-br from-primary/5 to-background",children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(Q.Crown,{className:"w-6 h-6 text-primary"}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.CardTitle,{children:"VIP Member"}),(0,b.jsx)(j.CardDescription,{className:"mt-1",children:b_.memberships[0].membershipType})]})]}),(0,b.jsx)(n.Badge,{variant:"default",className:"text-xs bg-primary",children:b_.memberships[0].status})]})}),(0,b.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid gap-3",children:[b_.memberships[0].startDate&&(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Member Since"}),(0,b.jsx)("span",{className:"font-medium",children:new Date(b_.memberships[0].startDate).toLocaleDateString("en-US",{month:"short",year:"numeric"})})]}),b_.memberships[0].expirationDate&&(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Expires"}),(0,b.jsx)("span",{className:"font-medium",children:new Date(b_.memberships[0].expirationDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),b_.memberships[0].renewalDate&&(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Next Renewal"}),(0,b.jsx)("span",{className:"font-medium",children:new Date(b_.memberships[0].renewalDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]}),(0,b.jsxs)("div",{className:"pt-3 border-t",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Your Benefits"}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(I.DollarSign,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,b.jsx)("span",{children:"Savings on EVERY service call"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(R.Star,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,b.jsx)("span",{children:"Priority same-day service"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(S.Shield,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,b.jsx)("span",{children:"No trip charges"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(T.Wrench,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,b.jsx)("span",{children:"Annual plumbing inspection included"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(J.Clock,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,b.jsx)("span",{children:"After-hours service at regular rates"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(K.CheckCircle,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,b.jsx)("span",{children:"Waived diagnostic fees"})]})]})]})]})]}):(0,b.jsxs)(j.Card,{className:"border-primary/20 bg-gradient-to-br from-primary/5 to-background",children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(Q.Crown,{className:"w-6 h-6 text-primary"}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.CardTitle,{children:"VIP Membership"}),(0,b.jsx)(j.CardDescription,{className:"mt-1",children:"Not a VIP member yet"})]})]}),(0,b.jsx)(n.Badge,{variant:"outline",className:"text-xs",children:"Available"})]})}),(0,b.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Join our VIP Membership program and save on every service call, plus enjoy priority same-day service, no trip charges, and more!"}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(I.DollarSign,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Savings on EVERY service call"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(R.Star,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Priority same-day service"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(S.Shield,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"No trip charges"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(T.Wrench,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Annual plumbing inspection"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(J.Clock,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"After-hours service at regular rates"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(K.CheckCircle,{className:"w-4 h-4 text-primary flex-shrink-0"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Waived diagnostic fees"})]})]}),(0,b.jsx)("div",{className:"pt-2 border-t",children:(0,b.jsx)(k.Button,{asChild:!0,className:"w-full","data-testid":"button-vip-membership",children:(0,b.jsxs)("a",{href:"/vip-membership",children:[(0,b.jsx)(Q.Crown,{className:"w-4 h-4 mr-2"}),"Learn About VIP Membership"]})})})]})]})}),b9.length>0&&(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(U.MapPin,{className:"w-6 h-6 text-primary"}),(0,b.jsxs)(j.CardTitle,{children:["Service Locations (",b9.length,")"]})]}),(0,b.jsx)(j.CardDescription,{children:1===b9.length?"Your service address":"All your service addresses"})]}),(0,b.jsxs)(j.CardContent,{className:"space-y-3",children:[b9.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-muted/30 rounded-lg border","data-testid":`location-card-${a.id}`,children:[(0,b.jsx)(V.Home,{className:"w-5 h-5 text-primary flex-shrink-0 mt-1"}),(0,b.jsxs)("div",{className:"flex-1",children:[a.name&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:a.name}),(0,b.jsx)("p",{className:"font-medium","data-testid":`text-location-street-${a.id}`,children:a.address.street}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.address.city,", ",a.address.state," ",a.address.zip]}),0===c&&b9.length>1&&(0,b.jsx)(n.Badge,{variant:"secondary",className:"mt-2 text-xs",children:"Primary"})]})]},a.id)),(0,b.jsx)("p",{className:"text-xs text-muted-foreground text-center pt-2",children:"Service addresses are managed by our team for security"})]})]}),0===(ak=b_.estimates||[]).length?null:(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(H.FileText,{className:"w-6 h-6 text-primary"}),(0,b.jsx)(j.CardTitle,{children:"Open Estimates"})]}),(0,b.jsx)(j.CardDescription,{children:"Your pending estimates and quotes (valid for 30 days)"})]}),(0,b.jsx)(j.CardContent,{children:(0,b.jsx)("div",{className:"overflow-x-auto pb-2",children:(0,b.jsx)("div",{className:"flex gap-4 min-w-max",children:ak.map(a=>(0,b.jsx)(j.Card,{className:"w-80 flex-shrink-0 hover-elevate active-elevate-2 cursor-pointer",onClick:()=>{bY(a),bW(!0)},"data-testid":`estimate-card-${a.id}`,children:(0,b.jsxs)(j.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-3",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("h4",{className:"font-semibold",children:["Estimate #",a.estimateNumber]}),a.summary&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-1",children:a.summary})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1 items-end",children:[cv(a.status),cw(a)]})]}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Total:"}),(0,b.jsx)("span",{className:"font-semibold text-primary",children:cm(a.total)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Created:"}),(0,b.jsx)("span",{children:cn(a.createdOn)})]}),a.expiresOn&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Expires:"}),(0,b.jsx)("span",{children:cn(a.expiresOn)})]})]})]})},a.id))})})})]}),(0,b.jsx)("div",{id:"appointments-section",children:(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(G.Calendar,{className:"w-6 h-6 text-primary"}),(0,b.jsx)(j.CardTitle,{children:"Upcoming Appointments"})]}),(0,b.jsx)(j.CardDescription,{children:"Your scheduled service appointments"})]}),(0,b.jsx)(j.CardContent,{children:0===ca.length?(0,b.jsx)("p",{className:"text-center py-8 text-muted-foreground","data-testid":"text-no-appointments",children:"No upcoming appointments"}):(0,b.jsx)("div",{className:"space-y-4",children:ca.map(a=>(0,b.jsxs)("div",{className:"flex items-start gap-4 p-4 border rounded-lg","data-testid":`appointment-${a.id}`,children:[(0,b.jsx)(G.Calendar,{className:"w-5 h-5 text-primary mt-1"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold",children:a.jobType}),a.summary&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.summary})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[cv(a.status),(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:()=>(a=>{if(a0(a),a2(new Date(a.start).toISOString().split("T")[0]),a.arrivalWindowStart&&a.arrivalWindowEnd&&b8.length>0){let b=new Date(a.arrivalWindowStart),c=new Date(a.arrivalWindowEnd),d=`${b.getUTCHours().toString().padStart(2,"0")}:${b.getUTCMinutes().toString().padStart(2,"0")}`,e=`${c.getUTCHours().toString().padStart(2,"0")}:${c.getUTCMinutes().toString().padStart(2,"0")}`,f=b8.find(a=>a.start===d&&a.end===e);f?a4(`${f.start}-${f.end}`):b8.length>0&&a4(`${b8[0].start}-${b8[0].end}`)}else b8.length>0&&a4(`${b8[0].start}-${b8[0].end}`);a$(!0)})(a),"data-testid":`button-reschedule-${a.id}`,children:[(0,b.jsx)(aa,{className:"w-4 h-4 mr-1"}),"Reschedule"]})]})]}),(0,b.jsxs)("div",{className:"text-sm space-y-1",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Date:"})," ",cn(a.start)]}),a.arrivalWindowStart&&a.arrivalWindowEnd&&(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Arrival Window:"})," ",cu(a.arrivalWindowStart)," - ",cu(a.arrivalWindowEnd)]}),a.jobNumber&&(0,b.jsxs)("p",{className:"text-muted-foreground",children:["Job #",a.jobNumber]})]})]})]},a.id))})})]})}),(0,b.jsx)("div",{id:"job-history-section",children:(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(H.FileText,{className:"w-6 h-6 text-primary"}),(0,b.jsx)(j.CardTitle,{children:"Invoices"})]}),(0,b.jsx)(j.CardDescription,{children:"Your service invoices and payment history"})]}),(0,b.jsx)(j.CardContent,{children:0===b_.invoices.length?(0,b.jsx)("p",{className:"text-center py-8 text-muted-foreground","data-testid":"text-no-invoices",children:"No invoices found"}):(0,b.jsx)("div",{className:"space-y-4",children:b_.invoices.map(a=>(0,b.jsxs)("div",{className:"flex items-start gap-4 p-4 border rounded-lg","data-testid":`invoice-${a.id}`,children:[(0,b.jsx)(I.DollarSign,{className:"w-5 h-5 text-primary mt-1"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"font-semibold",children:["Invoice #",a.invoiceNumber]}),a.summary&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.summary})]}),cv(a.status)]}),(0,b.jsxs)("div",{className:"text-sm space-y-1",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:(0,b.jsx)("strong",{children:"Total:"})}),(0,b.jsx)("span",{className:"font-semibold",children:cm(a.total)})]}),a.balance>0&&(0,b.jsxs)("div",{className:"flex justify-between text-destructive",children:[(0,b.jsx)("span",{children:(0,b.jsx)("strong",{children:"Balance Due:"})}),(0,b.jsx)("span",{className:"font-semibold",children:cm(a.balance)})]}),(0,b.jsxs)("p",{className:"text-muted-foreground",children:["Created: ",cn(a.createdOn)]}),a.dueDate&&(0,b.jsxs)("p",{className:"text-muted-foreground",children:["Due: ",cn(a.dueDate)]}),a.jobNumber&&(0,b.jsxs)("p",{className:"text-muted-foreground",children:["Job #",a.jobNumber]})]}),(0,b.jsx)("div",{className:"mt-3 pt-3 border-t",children:(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:()=>cp("invoice",a.invoiceNumber,a.id,{customerId:b_.customer.id,customerName:b_.customer.name,customerEmail:b_.customer.email}),"data-testid":`button-request-invoice-pdf-${a.id}`,children:[(0,b.jsx)(H.FileText,{className:"w-4 h-4 mr-2"}),"Request PDF Copy"]})})]})]},a.id))})})]})}),(0,b.jsx)("div",{id:"referral-section",children:b3&&(0,b.jsxs)(j.Card,{className:"border-primary/20 bg-gradient-to-br from-primary/10 via-primary/5 to-background",children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center",children:(0,b.jsx)(O.Gift,{className:"w-6 h-6 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.CardTitle,{children:"Referral Rewards Program"}),(0,b.jsx)(j.CardDescription,{className:"mt-1",children:b2?.referrals.length===0?"Start earning rewards today! Share your link below.":`You've referred ${b2?.referrals.length} ${b2?.referrals.length===1?"friend":"friends"} - thank you for spreading the word!`})]})]}),(0,b.jsx)(n.Badge,{variant:"default",className:"bg-primary",children:"Active"})]})}),(0,b.jsxs)(j.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"p-4 bg-primary/10 rounded-lg border border-primary/20 text-center",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Your Referral Code"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-primary tracking-wide","data-testid":"text-referral-code",children:b3.code})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"referral-link",children:"Your Unique Referral Link"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(l.Input,{id:"referral-link",value:b3.url,readOnly:!0,className:"font-mono text-sm","data-testid":"input-referral-link"}),(0,b.jsx)(k.Button,{onClick:co,variant:ax?"default":"outline",size:"icon",className:ax?"bg-green-600 hover:bg-green-700":"","data-testid":"button-copy-link",children:ax?(0,b.jsx)(Z.Check,{className:"w-4 h-4"}):(0,b.jsx)(Y.Copy,{className:"w-4 h-4"})})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"p-4 bg-background rounded-lg border text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Total Referrals"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-primary","data-testid":"text-total-referrals-stat",children:b2?.referrals.length||0})]}),(0,b.jsxs)("div",{className:"p-4 bg-background rounded-lg border text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Conversions"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-primary","data-testid":"text-conversions",children:b3.conversions})]}),(0,b.jsxs)("div",{className:"p-4 bg-background rounded-lg border text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Clicks"}),(0,b.jsx)("p",{className:"text-2xl font-bold","data-testid":"text-clicks",children:b3.clicks})]})]}),b2&&b2.referrals.length>0?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("h4",{className:"font-semibold",children:"Your Referrals"}),b2.referrals.slice(0,5).map(a=>{let c=a.referrerCustomerId===parseInt(ap);return(0,b.jsxs)("div",{className:"p-3 bg-background rounded-lg border",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-1",children:[(0,b.jsx)("p",{className:"font-medium text-sm",children:c?a.refereeName:a.referrerName}),(0,b.jsx)(n.Badge,{className:{pending:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100",contacted:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100",job_completed:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100",credited:"bg-primary/10 text-primary"}[a.status]||"bg-gray-100 text-gray-800","data-testid":`badge-referral-status-${a.id}`,children:a.status.replace("_"," ").replace(/\b\w/g,a=>a.toUpperCase())})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Submitted: ",new Date(a.submittedAt).toLocaleDateString()]}),"credited"===a.status&&a.creditAmount&&(0,b.jsxs)("p",{className:"text-xs text-primary font-medium mt-1",children:["Credit: $",(a.creditAmount/100).toFixed(2)]})]},a.id)}),b2.referrals.length>5&&(0,b.jsxs)("p",{className:"text-xs text-center text-muted-foreground",children:["Showing 5 most recent (",b2.referrals.length," total)"]})]}):b2&&(0,b.jsxs)("div",{className:"p-6 bg-gradient-to-r from-primary/5 via-primary/10 to-primary/5 rounded-lg border border-primary/20 text-center space-y-4",children:[(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsx)(O.Gift,{className:"w-12 h-12 text-primary animate-pulse"})}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h4",{className:"font-semibold text-lg",children:"Be the First to Start Earning!"}),(0,b.jsx)("p",{className:"text-muted-foreground max-w-md mx-auto",children:"You haven't made any referrals yet, but there's great potential waiting! Share your unique link with friends and family to start earning $25 rewards."}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"It's simple: they save $25, you earn $25. Everyone wins!"})]}),(0,b.jsxs)("div",{className:"flex flex-wrap justify-center gap-3 pt-2",children:[(0,b.jsxs)(k.Button,{onClick:()=>{let a=`Save $25 on your first plumbing service with Economy Plumbing! Use my referral link: ${b3.url}`,b=`https://twitter.com/intent/tweet?text=${encodeURIComponent(a)}`;window.open(b,"_blank","width=600,height=400")},variant:"outline",size:"sm",className:"gap-2","data-testid":"button-share-twitter",children:[(0,b.jsx)(X.Share2,{className:"w-4 h-4"}),"Share on X"]}),(0,b.jsxs)(k.Button,{onClick:()=>{let a=`Check out Economy Plumbing Services! Save $25 on your first service using my referral link: ${b3.url}`,b=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(b3.url)}&quote=${encodeURIComponent(a)}`;window.open(b,"_blank","width=600,height=400")},variant:"outline",size:"sm",className:"gap-2","data-testid":"button-share-facebook",children:[(0,b.jsx)(X.Share2,{className:"w-4 h-4"}),"Share on Facebook"]}),(0,b.jsxs)(k.Button,{onClick:()=>{let a=`Hi! I wanted to share this with you - Economy Plumbing Services has been amazing for us. You can save $25 on your first service using my referral link: ${b3.url}`,b=`mailto:?subject=Save $25 on Plumbing Services&body=${encodeURIComponent(a)}`;window.location.href=b},variant:"outline",size:"sm",className:"gap-2","data-testid":"button-share-email",children:[(0,b.jsx)(N.Mail,{className:"w-4 h-4"}),"Share via Email"]})]})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-background rounded-lg border",children:[(0,b.jsx)(O.Gift,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"You Get $25"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"When your referral completes a service of $200+"})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-background rounded-lg border",children:[(0,b.jsx)(P.Heart,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"They Get $25"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Your friend saves on their first service call"})]})]})]}),(0,b.jsxs)(k.Button,{onClick:()=>aA(!0),className:"w-full",size:"lg","data-testid":"button-share-referral",children:[(0,b.jsx)(X.Share2,{className:"w-4 h-4 mr-2"}),"Share Referral Link"]})]})]})}),cb.length>0&&(0,b.jsxs)(j.Card,{className:"border-primary/20 bg-gradient-to-br from-primary/5 to-background",children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(R.Star,{className:"w-6 h-6 text-primary fill-primary"}),(0,b.jsx)(j.CardTitle,{children:"Love Our Service?"})]}),(0,b.jsx)(j.CardDescription,{children:"Share your experience and help others find great plumbing service"})]}),(0,b.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-background rounded-lg border",children:[(0,b.jsx)(K.CheckCircle,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"Your Review Matters"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Help your neighbors find reliable plumbing service. Your honest feedback helps us improve and helps others make informed decisions."})]})]}),(0,b.jsxs)(k.Button,{className:"w-full",size:"lg","data-testid":"button-leave-review",onClick:()=>{bQ(0),bS(""),bO(!0)},children:[(0,b.jsx)(R.Star,{className:"w-4 h-4 mr-2"}),"Leave a Review"]}),(0,b.jsx)("p",{className:"text-xs text-center text-muted-foreground",children:"Choose from Google, Facebook, BBB, or Yelp - takes just 2 minutes!"})]})]})]}):null}):"lookup"===aH?(0,b.jsxs)(j.Card,{className:"max-w-md mx-auto",children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsx)(j.CardTitle,{children:"Find Your Account"}),(0,b.jsx)(j.CardDescription,{children:"Enter your email address to access your account"})]}),(0,b.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"lookup-input",children:"Email Address"}),(0,b.jsx)(l.Input,{id:"lookup-input",type:"email",placeholder:"your@email.com",value:al,onChange:a=>am(a.target.value),onKeyDown:a=>"Enter"===a.key&&ce(),"data-testid":"input-lookup"})]}),(0,b.jsx)(k.Button,{onClick:ce,className:"w-full",disabled:!al.trim()||av,"data-testid":"button-lookup-submit",children:av?"Searching...":"Access My Account"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,b.jsx)("span",{className:"w-full border-t"})}),(0,b.jsx)("div",{className:"relative flex justify-center text-xs uppercase",children:(0,b.jsx)("span",{className:"bg-background px-2 text-muted-foreground",children:"Or"})})]}),(0,b.jsxs)(k.Button,{variant:"outline",onClick:()=>aI("phone-lookup"),className:"w-full","data-testid":"button-phone-login",children:[(0,b.jsx)(M.Phone,{className:"w-4 h-4 mr-2"}),"Login with Phone Number"]}),at&&(0,b.jsx)("div",{className:"bg-green-500/10 border border-green-500/20 rounded-lg p-4 text-sm",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(K.CheckCircle,{className:"w-5 h-5 text-green-600 dark:text-green-500 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"text-green-700 dark:text-green-400",children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"Success"}),(0,b.jsx)("p",{children:at})]})]})}),ar&&(0,b.jsx)("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4 text-sm",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(L.AlertCircle,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"text-destructive",children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"Error"}),(0,b.jsx)("p",{children:ar})]})]})})]})]}):"phone-lookup"===aH?(0,b.jsxs)(j.Card,{className:"max-w-md mx-auto",children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsx)(j.CardTitle,{children:"Login with Phone Number"}),(0,b.jsx)(j.CardDescription,{children:"Enter your phone number and we'll send a login link to your email"})]}),(0,b.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"phone-lookup-input",children:"Phone Number"}),(0,b.jsx)(l.Input,{id:"phone-lookup-input",type:"tel",placeholder:"(512) 555-1234",value:aP,onChange:a=>aQ(a.target.value),onKeyDown:a=>"Enter"===a.key&&cj(),"data-testid":"input-phone-lookup"})]}),(0,b.jsx)(k.Button,{onClick:cj,className:"w-full",disabled:!aP.trim()||aV,"data-testid":"button-phone-lookup-submit",children:aV?"Looking up...":"Find My Account"}),(0,b.jsx)(k.Button,{variant:"ghost",onClick:ci,className:"w-full","data-testid":"button-back-to-email",children:"Back to Email Login"}),at&&(0,b.jsx)("div",{className:"bg-green-500/10 border border-green-500/20 rounded-lg p-4 text-sm",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(K.CheckCircle,{className:"w-5 h-5 text-green-600 dark:text-green-500 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"text-green-700 dark:text-green-400",children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"Success"}),(0,b.jsx)("p",{children:at})]})]})}),ar&&(0,b.jsx)("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4 text-sm",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(L.AlertCircle,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"text-destructive",children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"Error"}),(0,b.jsx)("p",{children:ar})]})]})})]})]}):"phone-email-found"===aH?(0,b.jsxs)(j.Card,{className:"max-w-md mx-auto",children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsx)(j.CardTitle,{children:"Account Found!"}),(0,b.jsx)(j.CardDescription,{children:"We'll send a login link to your email address"})]}),(0,b.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,b.jsx)("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(N.Mail,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"Email Address"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:aR}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"For security, we've hidden part of your email address"})]})]})}),(0,b.jsx)(k.Button,{onClick:ck,className:"w-full",disabled:aX,"data-testid":"button-send-phone-magic-link",children:aX?"Sending...":"Send Login Link"}),(0,b.jsx)(k.Button,{variant:"ghost",onClick:ci,className:"w-full","data-testid":"button-back-from-phone",children:"Use Different Method"}),at&&(0,b.jsx)("div",{className:"bg-green-500/10 border border-green-500/20 rounded-lg p-4 text-sm",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(K.CheckCircle,{className:"w-5 h-5 text-green-600 dark:text-green-500 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"text-green-700 dark:text-green-400",children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"Success"}),(0,b.jsx)("p",{children:at})]})]})}),ar&&(0,b.jsx)("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4 text-sm",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(L.AlertCircle,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"text-destructive",children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"Error"}),(0,b.jsx)("p",{children:ar})]})]})})]})]}):"verify-code"===aH?(0,b.jsxs)(j.Card,{className:"max-w-md mx-auto",children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsx)(j.CardTitle,{children:"Enter Verification Code"}),(0,b.jsx)(j.CardDescription,{children:aL})]}),(0,b.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"verification-code",children:"phone"===an?"6-Digit Code":"Check your email for the access link"}),"phone"===an&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Input,{id:"verification-code",type:"text",placeholder:"123456",value:aJ,onChange:a=>aK(a.target.value.replace(/\D/g,"").slice(0,6)),onKeyDown:a=>"Enter"===a.key&&cf(),maxLength:6,"data-testid":"input-verification-code"}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Enter the 6-digit code sent to ",al]})]}),"email"===an&&(0,b.jsx)("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(N.Mail,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"Check your email"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["We sent a secure access link to ",al,". Click the link in the email to access your portal."]})]})]})})]}),"phone"===an&&(0,b.jsx)(k.Button,{onClick:cf,className:"w-full",disabled:6!==aJ.length||aN,"data-testid":"button-verify-code",children:aN?"Verifying...":"Verify Code"}),(0,b.jsx)(k.Button,{variant:"outline",onClick:ci,className:"w-full","data-testid":"button-back-to-lookup",children:"Try Another Method"}),at&&(0,b.jsx)("div",{className:"bg-green-500/10 border border-green-500/20 rounded-lg p-4 text-sm",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(K.CheckCircle,{className:"w-5 h-5 text-green-600 dark:text-green-500 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"text-green-700 dark:text-green-400",children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"Success"}),(0,b.jsx)("p",{children:at})]})]})}),ar&&(0,b.jsx)("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4 text-sm",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(L.AlertCircle,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"text-destructive",children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"Error"}),(0,b.jsx)("p",{children:ar})]})]})})]})]}):"select-account"===aH?(0,b.jsxs)(j.Card,{className:"max-w-2xl mx-auto",children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsx)(j.CardTitle,{children:"Select Your Account"}),(0,b.jsx)(j.CardDescription,{children:"We found multiple accounts associated with your contact information. Please select which account you'd like to access."})]}),(0,b.jsxs)(j.CardContent,{className:"space-y-3",children:[aB.map(a=>(0,b.jsx)(j.Card,{className:"hover-elevate active-elevate-2 cursor-pointer",onClick:()=>cg(a.id),"data-testid":`account-option-${a.id}`,children:(0,b.jsx)(j.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:["Commercial"===a.type?(0,b.jsx)(F.Users,{className:"w-6 h-6 text-primary flex-shrink-0 mt-0.5"}):(0,b.jsx)(V.Home,{className:"w-6 h-6 text-primary flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("p",{className:"font-semibold",children:a.name}),(0,b.jsx)(n.Badge,{variant:"secondary",className:"text-xs",children:a.type})]}),a.address&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground flex items-start gap-1",children:[(0,b.jsx)(U.MapPin,{className:"w-3 h-3 flex-shrink-0 mt-0.5"}),a.address]})]})]})})},a.id)),(0,b.jsx)(k.Button,{variant:"outline",onClick:ci,className:"w-full mt-4","data-testid":"button-back-to-lookup-from-select",children:"Back"})]})]}):null]})}),(0,b.jsx)(i.default,{}),b_&&b3&&(0,b.jsx)(D,{open:az,onOpenChange:aA,customerName:b_.customer.name,customerPhone:b_.customer.phoneNumber,customerId:ap,referralCode:b3.code}),(0,b.jsx)(p.Dialog,{open:bV,onOpenChange:bW,children:(0,b.jsxs)(p.DialogContent,{className:"max-w-2xl max-h-[80vh]","data-testid":"dialog-estimate-detail",children:[(0,b.jsxs)(p.DialogHeader,{children:[(0,b.jsx)(p.DialogTitle,{children:"Estimate Details"}),(0,b.jsx)(p.DialogDescription,{children:"Complete breakdown of your estimate"})]}),bX&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"p-4 bg-muted/30 rounded-lg border",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4 mb-3",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("h3",{className:"font-semibold text-lg",children:["Estimate #",bX.estimateNumber]}),bX.summary&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:bX.summary})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1 items-end",children:[cv(bX.status),cw(bX)]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Total:"}),(0,b.jsx)("p",{className:"font-semibold text-lg text-primary",children:cm(bX.total)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Created:"}),(0,b.jsx)("p",{className:"font-medium",children:cn(bX.createdOn)})]}),bX.expiresOn&&(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Expires:"}),(0,b.jsx)("p",{className:"font-medium",children:cn(bX.expiresOn)})]})}),bX.jobNumber&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Job #:"}),(0,b.jsx)("p",{className:"font-medium",children:bX.jobNumber})]})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("h4",{className:"font-semibold",children:"Items"}),(0,b.jsx)("div",{className:"max-h-96 overflow-y-auto space-y-3 pr-2",children:bX.items&&bX.items.length>0?bX.items.map((a,c)=>(0,b.jsx)("div",{className:"p-3 bg-background rounded-lg border","data-testid":`estimate-item-${c}`,children:(0,b.jsxs)("div",{className:"flex gap-3",children:[a.pricebookDetails?.imageUrl&&(0,b.jsx)("img",{src:a.pricebookDetails.imageUrl,alt:a.pricebookDetails.name||a.description,className:"w-16 h-16 object-cover rounded"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium",children:a.pricebookDetails?.name||a.sku?.name||"Service Item"}),a.description&&(0,b.jsx)("div",{className:"text-sm text-muted-foreground mt-1",dangerouslySetInnerHTML:{__html:a.description}}),(0,b.jsxs)("div",{className:"mt-3 space-y-1",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Quantity:"}),(0,b.jsx)("span",{children:a.quantity||a.qty||1})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Unit Price:"}),(0,b.jsx)("span",{children:cm(a.unitRate||0)})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center pt-1 border-t",children:[(0,b.jsx)("span",{className:"font-medium",children:"Line Total:"}),(0,b.jsx)("span",{className:"font-semibold text-primary",children:cm(a.total||0)})]})]})]})]})},c)):(0,b.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"No items found"})})]}),(0,b.jsxs)("div",{className:"flex gap-3 pt-4 border-t",children:[(0,b.jsx)(k.Button,{variant:"outline",className:"flex-1",onClick:()=>bW(!1),"data-testid":"button-close-estimate-detail",children:"Close"}),(0,b.jsxs)(k.Button,{className:"flex-1",onClick:()=>{cp("estimate",bX.estimateNumber,bX.id,{customerId:b_.customer.id,customerName:b_.customer.name,customerEmail:b_.customer.email}),bW(!1)},"data-testid":"button-request-estimate-pdf-modal",children:[(0,b.jsx)(H.FileText,{className:"w-4 h-4 mr-2"}),"Request PDF Copy"]})]})]})]})}),(0,b.jsx)(p.Dialog,{open:aZ,onOpenChange:a$,children:(0,b.jsxs)(p.DialogContent,{"data-testid":"dialog-reschedule",children:[(0,b.jsxs)(p.DialogHeader,{children:[(0,b.jsx)(p.DialogTitle,{children:"Reschedule Appointment"}),(0,b.jsx)(p.DialogDescription,{children:"Choose a new date and time window for your appointment. We'll update your schedule right away."})]}),a_&&(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"p-4 bg-muted/30 rounded-lg border",children:[(0,b.jsx)("p",{className:"text-sm font-medium mb-2",children:"Current Appointment:"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a_.jobType}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[cn(a_.start)," at ",cu(a_.start)]})]}),(0,b.jsxs)("div",{className:"grid gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"new-date",children:"New Date"}),(0,b.jsx)(l.Input,{id:"new-date",type:"date",value:a1,onChange:a=>a2(a.target.value),min:new Date().toISOString().split("T")[0],"data-testid":"input-new-date"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"new-window",children:"Time Window"}),(0,b.jsxs)(q.Select,{value:a3,onValueChange:a4,children:[(0,b.jsx)(q.SelectTrigger,{id:"new-window","data-testid":"select-time-window",children:(0,b.jsx)(q.SelectValue,{placeholder:"Select a time window"})}),(0,b.jsx)(q.SelectContent,{children:b8.map(a=>(0,b.jsx)(q.SelectItem,{value:`${a.start}-${a.end}`,"data-testid":`option-${a.start}-${a.end}`,children:a.label},`${a.start}-${a.end}`))})]})]})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Note: This will update your appointment in our system. You can also call us at ",bZ.display," for assistance."]})]}),(0,b.jsxs)(p.DialogFooter,{children:[(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>a$(!1),disabled:a5,"data-testid":"button-cancel-reschedule",children:"Cancel"}),(0,b.jsx)(k.Button,{onClick:cl,disabled:a5||!a1||!a3,"data-testid":"button-confirm-reschedule",children:a5?"Rescheduling...":"Confirm Reschedule"})]})]})}),(0,b.jsx)(p.Dialog,{open:a7,onOpenChange:a8,children:(0,b.jsxs)(p.DialogContent,{"data-testid":"dialog-edit-contacts",children:[(0,b.jsxs)(p.DialogHeader,{children:[(0,b.jsx)(p.DialogTitle,{children:"Update Contact Information"}),(0,b.jsx)(p.DialogDescription,{children:"Update your phone number and email address. This will be reflected in our system."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"edit-phone",children:"Phone Number"}),(0,b.jsx)(l.Input,{id:"edit-phone",type:"tel",value:bb,onChange:a=>bc(a.target.value),placeholder:"(512) 123-4567","data-testid":"input-edit-phone"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"edit-email",children:"Email Address"}),(0,b.jsx)(l.Input,{id:"edit-email",type:"email",value:a9,onChange:a=>ba(a.target.value),placeholder:"you@example.com","data-testid":"input-edit-email"})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Note: Changes will update your contact information across all our systems."})]}),(0,b.jsxs)(p.DialogFooter,{children:[(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>a8(!1),disabled:bd,"data-testid":"button-cancel-edit-contacts",children:"Cancel"}),(0,b.jsx)(k.Button,{onClick:cq,disabled:bd||!bb&&!a9,"data-testid":"button-save-contacts",children:bd?"Updating...":"Save Changes"})]})]})}),(0,b.jsx)(p.Dialog,{open:bf,onOpenChange:bg,children:(0,b.jsxs)(p.DialogContent,{"data-testid":"dialog-delete-contact",children:[(0,b.jsxs)(p.DialogHeader,{children:[(0,b.jsx)(p.DialogTitle,{children:"Delete Contact?"}),(0,b.jsx)(p.DialogDescription,{children:"Are you sure you want to delete this contact information? This action cannot be undone."})]}),bh&&(0,b.jsx)("div",{className:"py-4",children:(0,b.jsxs)("div",{className:"bg-muted/50 p-4 rounded-lg",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"MobilePhone"===bh.type?"Mobile":bh.type}),(0,b.jsx)("p",{className:"font-medium",children:bh.value})]})}),(0,b.jsxs)(p.DialogFooter,{children:[(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>{bg(!1),bi(null)},disabled:bj,"data-testid":"button-cancel-delete-contact",children:"Cancel"}),(0,b.jsx)(k.Button,{variant:"destructive",onClick:cs,disabled:bj,"data-testid":"button-confirm-delete-contact",children:bj?"Deleting...":"Delete Contact"})]})]})}),(0,b.jsx)(p.Dialog,{open:bl,onOpenChange:bm,children:(0,b.jsxs)(p.DialogContent,{"data-testid":"dialog-edit-address",children:[(0,b.jsxs)(p.DialogHeader,{children:[(0,b.jsx)(p.DialogTitle,{children:"Update Service Address"}),(0,b.jsx)(p.DialogDescription,{children:"Update your service address where we provide plumbing services."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"edit-street",children:"Street Address"}),(0,b.jsx)(l.Input,{id:"edit-street",type:"text",value:bn,onChange:a=>bo(a.target.value),placeholder:"123 Main Street","data-testid":"input-edit-street"})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"edit-city",children:"City"}),(0,b.jsx)(l.Input,{id:"edit-city",type:"text",value:bp,onChange:a=>bq(a.target.value),placeholder:"Austin","data-testid":"input-edit-city"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"edit-state",children:"State"}),(0,b.jsx)(l.Input,{id:"edit-state",type:"text",value:br,onChange:a=>bs(a.target.value),placeholder:"TX",maxLength:2,"data-testid":"input-edit-state"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"edit-zip",children:"ZIP Code"}),(0,b.jsx)(l.Input,{id:"edit-zip",type:"text",value:bt,onChange:a=>bu(a.target.value),placeholder:"78701",maxLength:5,"data-testid":"input-edit-zip"})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Note: This updates your primary service address in our system."})]}),(0,b.jsxs)(p.DialogFooter,{children:[(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>bm(!1),disabled:bv,"data-testid":"button-cancel-edit-address",children:"Cancel"}),(0,b.jsx)(k.Button,{onClick:ct,disabled:bv||!bn||!bp||!br||!bt,"data-testid":"button-save-address",children:bv?"Updating...":"Save Changes"})]})]})}),(0,b.jsx)(p.Dialog,{open:bz,onOpenChange:bA,children:(0,b.jsxs)(p.DialogContent,{"data-testid":"dialog-email-us",children:[(0,b.jsxs)(p.DialogHeader,{children:[(0,b.jsx)(p.DialogTitle,{children:"Email Us"}),(0,b.jsx)(p.DialogDescription,{children:"Send us a message and we'll get back to you as soon as possible."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"email-name",children:"Name"}),(0,b.jsx)(l.Input,{id:"email-name",type:"text",value:bF,onChange:a=>bG(a.target.value),placeholder:"Your Name","data-testid":"input-email-name"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"email-phone",children:"Phone"}),(0,b.jsx)(l.Input,{id:"email-phone",type:"tel",value:bJ,onChange:a=>bK(a.target.value),placeholder:"(512) 123-4567","data-testid":"input-email-phone"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"email-address",children:"Email Address"}),(0,b.jsx)(l.Input,{id:"email-address",type:"email",value:bH,onChange:a=>bI(a.target.value),placeholder:"you@example.com","data-testid":"input-email-address"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"email-subject",children:"Subject"}),(0,b.jsx)(l.Input,{id:"email-subject",type:"text",value:bB,onChange:a=>bC(a.target.value),placeholder:"How can we help?","data-testid":"input-email-subject"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"email-message",children:"Message"}),(0,b.jsx)("textarea",{id:"email-message",className:"flex min-h-[120px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:bD,onChange:a=>bE(a.target.value),placeholder:"Tell us more about what you need...","data-testid":"input-email-message"})]})]}),(0,b.jsxs)(p.DialogFooter,{children:[(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>bA(!1),disabled:bL,"data-testid":"button-cancel-email",children:"Cancel"}),(0,b.jsx)(k.Button,{onClick:async()=>{if(!bF||!bH||!bD)return void b$({title:"Missing Information",description:"Please fill in all required fields",variant:"destructive"});bM(!0);try{if((await fetch("/api/contact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:bF,email:bH,phone:bJ,subject:bB||"Customer Portal Inquiry",message:bD,source:"customer_portal"})})).ok)b$({title:"Message Sent!",description:"We've received your message and will respond soon."}),bA(!1),bC(""),bE("");else throw Error("Failed to send message")}catch(a){console.error("Error sending email:",a),b$({title:"Error",description:"Failed to send message. Please try again.",variant:"destructive"})}finally{bM(!1)}},disabled:bL||!bF||!bH||!bD,"data-testid":"button-send-email",children:bL?"Sending...":"Send Message"})]})]})}),(0,b.jsx)(p.Dialog,{open:bN,onOpenChange:bO,children:(0,b.jsxs)(p.DialogContent,{className:"sm:max-w-md","data-testid":"dialog-review",children:[(0,b.jsxs)(p.DialogHeader,{children:[(0,b.jsx)(p.DialogTitle,{children:0===bP?"How was your experience?":bP>=4?"Thank you for your feedback!":"We appreciate your feedback"}),(0,b.jsx)(p.DialogDescription,{children:0===bP?"Please rate your recent service":bP>=4?"Share your positive experience with others":"Help us improve our service"})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsx)("div",{className:"flex justify-center gap-2",children:[1,2,3,4,5].map(a=>(0,b.jsx)("button",{onClick:()=>bQ(a),className:"focus:outline-none transition-transform hover:scale-110","data-testid":`button-star-${a}`,children:(0,b.jsx)(R.Star,{className:`w-10 h-10 ${a<=bP?"fill-yellow-400 text-yellow-400":"text-gray-300 hover:text-yellow-400"}`})},a))}),bP>0&&(0,b.jsx)(b.Fragment,{children:bP>=4?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("p",{className:"text-center text-sm text-muted-foreground",children:"Please share your experience on one of these platforms:"}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsxs)(k.Button,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>{window.open("https://g.page/r/CeBZvF4LQ-KNEAE/review","_blank"),bO(!1),b$({title:"Thank you!",description:"Opening Google Reviews..."})},"data-testid":"button-google-review",children:[(0,b.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[(0,b.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,b.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,b.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,b.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Google Reviews"]}),(0,b.jsxs)(k.Button,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>{window.open("https://www.facebook.com/EconomyPlumbingServices/reviews","_blank"),bO(!1),b$({title:"Thank you!",description:"Opening Facebook Reviews..."})},"data-testid":"button-facebook-review",children:[(0,b.jsx)(ad.SiFacebook,{className:"w-5 h-5 text-[#1877F2]"}),"Facebook Reviews"]}),(0,b.jsxs)(k.Button,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>{window.open("https://www.yelp.com/writeareview/biz/economy-plumbing-services-austin","_blank"),bO(!1),b$({title:"Thank you!",description:"Opening Yelp Reviews..."})},"data-testid":"button-yelp-review",children:[(0,b.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{fill:"#FF1A1A",d:"M12.062 17.662c.038-.934-.008-.889.002-2.393.007-.9.527-.991.756-.635.052.081 1.518 2.368 1.541 2.449.156.557-.194.683-.774.619-.651-.072-1.245-.166-1.249-.166-.265-.049-.368-.146-.276-.51zm2.167-4.142c.011-.908.012-.908.021-1.823.011-1.103-.746-1.098-1.069-.501-.073.135-1.164 2.443-1.212 2.553-.175.408.254.578.663.556l1.27-.069c.17-.009.333-.065.327-.716zm-3.192.955c.901-.111.91-.148 1.75-.291.508-.087.546-.567.087-.752-.105-.042-2.634-.912-2.728-.951-.599-.247-.772.292-.548.867.251.646.497 1.222.497 1.227.103.224.256.215.585-.065zm-3.834 5.558c.347-.778.347-.801.651-1.479.365-.815-.397-1.139-.856-.595-.099.125-1.912 2.317-1.939 2.383-.231.576.271.876.687.803.682-.125 1.162-.239 1.166-.244.178-.108.24-.243.291-.868zm.901-2.701c.793-.448.808-.457 1.522-.874.86-.502.429-1.155-.342-1.176-.177-.005-3.057-.029-3.163-.036-.671-.043-.819.503-.438.929.427.478.823.912.827.917.163.175.36.14.698-.09z"})}),"Yelp Reviews"]}),(0,b.jsxs)(k.Button,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>{window.open("https://www.bbb.org/us/tx/austin/profile/plumber/economy-plumbing-services-0825-1000049576/customer-reviews","_blank"),bO(!1),b$({title:"Thank you!",description:"Opening BBB Reviews..."})},"data-testid":"button-bbb-review",children:[(0,b.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{fill:"#003087",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"})}),"BBB Reviews"]})]})]}):(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("p",{className:"text-center text-sm text-muted-foreground",children:"We're sorry to hear about your experience. Please tell us how we can improve:"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"feedback",children:"Your Feedback"}),(0,b.jsx)("textarea",{id:"feedback",className:"flex min-h-[120px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:bR,onChange:a=>bS(a.target.value),placeholder:"Please share what went wrong and how we can do better...","data-testid":"input-review-feedback"})]}),(0,b.jsx)(k.Button,{className:"w-full",onClick:async()=>{bU(!0);try{if((await fetch("/api/reviews/private-feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:ap,rating:bP,feedback:bR,customerName:b_?.customer?.name||"Anonymous",customerEmail:b_?.customer?.email||""})})).ok)b$({title:"Thank you for your feedback",description:"We'll review your comments and work to improve our service."}),bO(!1);else throw Error("Failed to submit feedback")}catch(a){console.error("Error submitting feedback:",a),b$({title:"Error",description:"Failed to submit feedback. Please try again.",variant:"destructive"})}finally{bU(!1)}},disabled:bT||!bR.trim(),"data-testid":"button-submit-feedback",children:bT?"Submitting...":"Submit Feedback"})]})})]}),0===bP&&(0,b.jsx)(p.DialogFooter,{children:(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>bO(!1),"data-testid":"button-cancel-review",children:"Cancel"})})]})}),(0,b.jsx)(p.Dialog,{open:aF&&"authenticated"===aH,onOpenChange:aG,children:(0,b.jsxs)(p.DialogContent,{className:"max-w-2xl","data-testid":"dialog-switch-account",children:[(0,b.jsxs)(p.DialogHeader,{children:[(0,b.jsx)(p.DialogTitle,{children:"Switch Account"}),(0,b.jsx)(p.DialogDescription,{children:"Select which account you'd like to view. You have access to multiple accounts."})]}),(0,b.jsx)("div",{className:"space-y-3 py-4",children:aB.map(a=>(0,b.jsx)(j.Card,{className:"hover-elevate active-elevate-2 cursor-pointer",onClick:()=>cg(a.id),"data-testid":`switch-account-option-${a.id}`,children:(0,b.jsx)(j.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:["Commercial"===a.type?(0,b.jsx)(F.Users,{className:"w-6 h-6 text-primary flex-shrink-0 mt-0.5"}):(0,b.jsx)(V.Home,{className:"w-6 h-6 text-primary flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("p",{className:"font-semibold",children:a.name}),(0,b.jsx)(n.Badge,{variant:"secondary",className:"text-xs",children:a.type})]}),a.address&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground flex items-start gap-1",children:[(0,b.jsx)(U.MapPin,{className:"w-3 h-3 flex-shrink-0 mt-0.5"}),a.address]})]})]})})},a.id))}),(0,b.jsx)(p.DialogFooter,{children:(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>aG(!1),"data-testid":"button-cancel-switch",children:"Cancel"})})]})})]})}a.s(["default",()=>ae],755166)}];

//# sourceMappingURL=app_customer-portal_page_tsx_47fb947f._.js.map
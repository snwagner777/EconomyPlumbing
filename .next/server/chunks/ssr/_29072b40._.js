module.exports=[87532,a=>{"use strict";let b=(0,a.i(70106).default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);a.s(["Search",()=>b],87532)},69520,a=>{"use strict";let b=(0,a.i(70106).default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);a.s(["RefreshCw",()=>b],69520)},76580,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(33217),e=a.i(91119),f=a.i(99570),g=a.i(66718),h=a.i(38246);let i=(0,a.i(70106).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var j=a.i(87532),k=a.i(69520);function l(){let[a,l]=(0,c.useState)(""),{data:m,isLoading:n}=(0,d.useQuery)({queryKey:["/api/admin/customers"]}),o=m?.customers||[],p=o.filter(b=>b.name?.toLowerCase().includes(a.toLowerCase())||b.email?.toLowerCase().includes(a.toLowerCase())||b.phone?.includes(a));return(0,b.jsx)("div",{className:"min-h-screen py-16",children:(0,b.jsx)("div",{className:"container mx-auto px-4",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h.default,{href:"/admin",className:"text-sm text-muted-foreground hover:text-foreground mb-2 inline-block","data-testid":"link-back-admin",children:"← Back to Dashboard"}),(0,b.jsx)("h1",{className:"text-4xl font-bold mb-2",children:"Customer Management"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"ServiceTitan customer data via XLSX imports and sync monitoring"})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)(f.Button,{variant:"outline","data-testid":"button-refresh-customers",children:[(0,b.jsx)(k.RefreshCw,{className:"w-4 h-4 mr-2"}),"Refresh"]}),(0,b.jsxs)(f.Button,{"data-testid":"button-import-customers",children:[(0,b.jsx)(i,{className:"w-4 h-4 mr-2"}),"Import XLSX"]})]})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-4 gap-6 mb-8",children:[(0,b.jsxs)(e.Card,{className:"p-6","data-testid":"stat-total-customers",children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:"Total Customers"}),(0,b.jsx)("div",{className:"text-3xl font-bold","data-testid":"text-total-customers-count",children:o.length})]}),(0,b.jsxs)(e.Card,{className:"p-6","data-testid":"stat-active-campaigns",children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:"Active Campaigns"}),(0,b.jsx)("div",{className:"text-3xl font-bold","data-testid":"text-active-campaigns-count",children:o.filter(a=>a.hasActiveReviewRequest||a.hasReferralCampaign).length})]}),(0,b.jsxs)(e.Card,{className:"p-6","data-testid":"stat-referral-credits",children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:"Referral Credits"}),(0,b.jsx)("div",{className:"text-3xl font-bold","data-testid":"text-referral-credits-count",children:o.filter(a=>a.referralCredit>0).length})]}),(0,b.jsxs)(e.Card,{className:"p-6","data-testid":"stat-last-sync",children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:"Last Sync"}),(0,b.jsx)("div",{className:"text-sm font-medium","data-testid":"text-last-sync-date",children:m?.lastSync?new Date(m.lastSync).toLocaleDateString():"Never"})]})]}),(0,b.jsx)(e.Card,{className:"p-6 mb-8 bg-blue-500/5 border-blue-500/20",children:(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)(i,{className:"w-6 h-6 text-blue-500 mt-1"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"XLSX-Based Customer Management"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Customer data managed via ServiceTitan XLSX exports (replacing API-based sync). Automated Mailgun webhook imports with data safety measures and search/login security fixes."}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium mb-1",children:"Import Methods:"}),(0,b.jsxs)("ul",{className:"text-muted-foreground space-y-1",children:[(0,b.jsx)("li",{children:"• Email XLSX to Mailgun (automated import)"}),(0,b.jsx)("li",{children:"• Manual upload via admin panel"}),(0,b.jsx)("li",{children:"• Automatic duplicate detection"}),(0,b.jsx)("li",{children:"• Customer upsert (create/update)"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium mb-1",children:"Data Safety:"}),(0,b.jsxs)("ul",{className:"text-muted-foreground space-y-1",children:[(0,b.jsx)("li",{children:"• Search query security (SQL injection prevention)"}),(0,b.jsx)("li",{children:"• Login rate limiting"}),(0,b.jsx)("li",{children:"• Phone/email normalization"}),(0,b.jsx)("li",{children:"• Transaction-safe imports"})]})]})]})]})]})}),(0,b.jsx)(e.Card,{className:"p-6 mb-6",children:(0,b.jsx)("div",{className:"flex gap-4",children:(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)(j.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(g.Input,{type:"text",placeholder:"Search by name, email, or phone...",value:a,onChange:a=>l(a.target.value),className:"pl-10","data-testid":"input-search-customers"})]})})}),(0,b.jsxs)(e.Card,{className:"p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-bold mb-6",children:"Customers"}),n?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading customers..."}):0===p.length?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("p",{className:"text-muted-foreground mb-4",children:a?"No customers found matching your search":"No customers yet"}),!a&&(0,b.jsx)(f.Button,{"data-testid":"button-import-first-customers",children:"Import Customer Data"})]}):(0,b.jsxs)("div",{className:"space-y-2",children:[p.slice(0,50).map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-accent/50 transition","data-testid":`customer-item-${a.id}`,children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("h3",{className:"font-semibold",children:a.name}),a.referralCredit>0&&(0,b.jsxs)("span",{className:"text-xs bg-green-500/10 text-green-600 px-2 py-0.5 rounded",children:["$",a.referralCredit," credit"]}),a.hasActiveReviewRequest&&(0,b.jsx)("span",{className:"text-xs bg-blue-500/10 text-blue-600 px-2 py-0.5 rounded",children:"Review campaign"})]}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground space-x-3",children:[a.email&&(0,b.jsx)("span",{children:a.email}),a.phone&&(0,b.jsx)("span",{children:a.phone})]})]}),(0,b.jsx)(f.Button,{variant:"outline",size:"sm","data-testid":`button-view-${a.id}`,children:"View"})]},a.id)),p.length>50&&(0,b.jsxs)("p",{className:"text-center text-sm text-muted-foreground pt-4",children:["Showing 50 of ",p.length," customers"]})]})]})]})})})}a.s(["CustomersDashboard",()=>l],76580)}];

//# sourceMappingURL=_29072b40._.js.map
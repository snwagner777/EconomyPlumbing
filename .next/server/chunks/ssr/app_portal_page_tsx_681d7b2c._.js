module.exports=[934666,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(699570),e=a.i(591119),f=a.i(866718),g=a.i(870430),h=a.i(875083),i=a.i(786304),j=a.i(814574),k=a.i(992258),l=a.i(963519),m=a.i(816201),n=a.i(941675),o=a.i(104720),p=a.i(578138),q=a.i(603314),r=a.i(220005),s=a.i(596221),t=a.i(478793);function u(){let{toast:a}=(0,t.useToast)(),[u,v]=(0,c.useState)("lookup"),[w,x]=(0,c.useState)("email"),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)(""),[S,T]=(0,c.useState)(""),[U,V]=(0,c.useState)(!1);(0,c.useEffect)(()=>{W()},[]),(0,c.useEffect)(()=>{"authenticated"===u&&E&&Z()},[u,E]);let W=async()=>{try{let a=await fetch("/api/portal/session");if(a.ok){let b=await a.json();b.customerId&&(F(b.customerId.toString()),v("authenticated"))}}catch(a){console.log("[Portal] No active session found")}},X=async()=>{D(!0);try{let b=await fetch("/api/portal/auth/lookup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lookupType:w,lookupValue:y.trim()})}),c=await b.json();if(!b.ok)throw Error(c.error||"Lookup failed");H(c.token),v("verify-code"),a({title:"Verification Code Sent",description:"email"===w?"Check your email for the verification code.":"Check your phone for the verification code."})}catch(b){a({title:"Error",description:b.message||"Failed to send verification code",variant:"destructive"})}finally{D(!1)}},Y=async()=>{D(!0);try{let b=await fetch("/api/portal/auth/verify-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contactValue:y.trim(),code:A.trim(),token:G,lookupType:w})}),c=await b.json();if(!b.ok)throw Error(c.error||"Verification failed");if(c.customers&&c.customers.length>0)F(c.customers[0].id.toString()),v("authenticated"),a({title:"Welcome!",description:"Successfully logged in to your portal."});else throw Error("No customer account found")}catch(b){a({title:"Verification Failed",description:b.message||"Invalid verification code",variant:"destructive"})}finally{D(!1)}},Z=async()=>{if(E){L(!0);try{let a=await fetch(`/api/portal/customer/${E}`);if(!a.ok)throw Error("Failed to load customer data");let b=await a.json();J(b)}catch(b){a({title:"Error",description:"Failed to load your account data",variant:"destructive"})}finally{L(!1)}}},$=async()=>{try{await fetch("/api/portal/auth/logout",{method:"POST"}),F(null),J(null),v("lookup"),z(""),B(""),H(""),a({title:"Logged Out",description:"You have been successfully logged out."})}catch(a){console.error("[Portal] Logout error:",a)}},_=async()=>{if(!O.trim()||!Q.trim())return void a({title:"Missing Information",description:"Please provide at least a name and phone number.",variant:"destructive"});V(!0);try{let b=await fetch("/api/referrals/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({referrerName:I?.name||"Customer",referrerEmail:I?.email||"",referrerPhone:I?.phone||"",refereeName:O.trim(),refereePhone:Q.trim(),refereeEmail:S.trim()||""})}),c=await b.json();if(!b.ok)throw Error(c.error||"Failed to submit referral");a({title:"Referral Submitted!",description:"Thank you for referring a friend. We'll contact them soon!"}),P(""),R(""),T(""),N(!1),Z()}catch(b){a({title:"Submission Failed",description:b.message||"Failed to submit referral. Please try again.",variant:"destructive"})}finally{V(!1)}};return"lookup"===u?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/5 via-background to-accent/5 p-4",children:(0,b.jsxs)(e.Card,{className:"w-full max-w-md","data-testid":"card-portal-login",children:[(0,b.jsxs)(e.CardHeader,{className:"text-center",children:[(0,b.jsx)(e.CardTitle,{className:"text-2xl","data-testid":"text-portal-title",children:"Customer Portal"}),(0,b.jsx)(e.CardDescription,{"data-testid":"text-portal-subtitle",children:"Sign in to view your service history and account details"})]}),(0,b.jsxs)(e.CardContent,{className:"space-y-6",children:[(0,b.jsxs)(h.Tabs,{value:w,onValueChange:a=>x(a),children:[(0,b.jsxs)(h.TabsList,{className:"grid w-full grid-cols-2","data-testid":"tabs-login-method",children:[(0,b.jsxs)(h.TabsTrigger,{value:"email","data-testid":"tab-email-login",children:[(0,b.jsx)(k.Mail,{className:"w-4 h-4 mr-2"}),"Email"]}),(0,b.jsxs)(h.TabsTrigger,{value:"phone","data-testid":"tab-phone-login",children:[(0,b.jsx)(l.Phone,{className:"w-4 h-4 mr-2"}),"Phone"]})]}),(0,b.jsxs)(h.TabsContent,{value:"email",className:"space-y-4 mt-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"email","data-testid":"label-email",children:"Email Address"}),(0,b.jsx)(f.Input,{id:"email",type:"email",placeholder:"your@email.com",value:y,onChange:a=>z(a.target.value),onKeyDown:a=>"Enter"===a.key&&X(),"data-testid":"input-email"})]}),(0,b.jsx)(d.Button,{onClick:X,disabled:C||!y.trim(),className:"w-full","data-testid":"button-send-email-code",children:C?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(s.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Mail,{className:"w-4 h-4 mr-2"}),"Send Verification Email"]})})]}),(0,b.jsxs)(h.TabsContent,{value:"phone",className:"space-y-4 mt-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"phone","data-testid":"label-phone",children:"Phone Number"}),(0,b.jsx)(f.Input,{id:"phone",type:"tel",placeholder:"(512) 555-0123",value:y,onChange:a=>z(a.target.value),onKeyDown:a=>"Enter"===a.key&&X(),"data-testid":"input-phone"})]}),(0,b.jsx)(d.Button,{onClick:X,disabled:C||!y.trim(),className:"w-full","data-testid":"button-send-phone-code",children:C?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(s.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Phone,{className:"w-4 h-4 mr-2"}),"Send Verification Code"]})})]})]}),(0,b.jsx)("div",{className:"text-center text-sm text-muted-foreground",children:(0,b.jsx)("p",{children:"We'll send you a secure code to verify your identity"})})]})]})}):"verify-code"===u?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/5 via-background to-accent/5 p-4",children:(0,b.jsxs)(e.Card,{className:"w-full max-w-md","data-testid":"card-verify-code",children:[(0,b.jsxs)(e.CardHeader,{className:"text-center",children:[(0,b.jsx)(e.CardTitle,{className:"text-2xl","data-testid":"text-verify-title",children:"Verify Your Code"}),(0,b.jsxs)(e.CardDescription,{"data-testid":"text-verify-subtitle",children:["Enter the code we sent to ",y]})]}),(0,b.jsxs)(e.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"code","data-testid":"label-code",children:"Verification Code"}),(0,b.jsx)(f.Input,{id:"code",type:"text",placeholder:"123456",value:A,onChange:a=>B(a.target.value),onKeyDown:a=>"Enter"===a.key&&Y(),"data-testid":"input-code"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>{v("lookup"),B("")},className:"flex-1","data-testid":"button-back",children:"Back"}),(0,b.jsx)(d.Button,{onClick:Y,disabled:C||!A.trim(),className:"flex-1","data-testid":"button-verify",children:C?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(s.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Verifying..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.CheckCircle,{className:"w-4 h-4 mr-2"}),"Verify"]})})]}),(0,b.jsx)("div",{className:"text-center",children:(0,b.jsx)(d.Button,{variant:"ghost",onClick:X,disabled:C,"data-testid":"button-resend",children:"Resend Code"})})]})]})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-background to-accent/5",children:[(0,b.jsx)("div",{className:"bg-card border-b",children:(0,b.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-2xl font-bold","data-testid":"text-welcome",children:["Welcome",I?.name?`, ${I.name}`:""]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground","data-testid":"text-account-id",children:["Account #",E]})]}),(0,b.jsxs)(d.Button,{variant:"outline",onClick:$,"data-testid":"button-logout",children:[(0,b.jsx)(r.LogOut,{className:"w-4 h-4 mr-2"}),"Logout"]})]})})}),(0,b.jsx)("div",{className:"container mx-auto px-4 py-8",children:K?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)(s.Loader2,{className:"w-8 h-8 animate-spin text-primary","data-testid":"loader-data"})}):I?(0,b.jsxs)("div",{className:"grid gap-6",children:[(0,b.jsxs)("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsxs)(e.Card,{"data-testid":"card-stat-appointments",children:[(0,b.jsxs)(e.CardHeader,{className:"pb-3",children:[(0,b.jsx)(e.CardDescription,{children:"Upcoming Appointments"}),(0,b.jsx)(e.CardTitle,{className:"text-3xl",children:I.appointments?.length||0})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)(n.Calendar,{className:"w-4 h-4 text-muted-foreground"})})]}),(0,b.jsxs)(e.Card,{"data-testid":"card-stat-invoices",children:[(0,b.jsxs)(e.CardHeader,{className:"pb-3",children:[(0,b.jsx)(e.CardDescription,{children:"Recent Invoices"}),(0,b.jsx)(e.CardTitle,{className:"text-3xl",children:I.invoices?.length||0})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)(o.FileText,{className:"w-4 h-4 text-muted-foreground"})})]}),(0,b.jsxs)(e.Card,{"data-testid":"card-stat-memberships",children:[(0,b.jsxs)(e.CardHeader,{className:"pb-3",children:[(0,b.jsx)(e.CardDescription,{children:"Memberships"}),(0,b.jsx)(e.CardTitle,{className:"text-3xl",children:I.memberships?.length||0})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)(q.Shield,{className:"w-4 h-4 text-muted-foreground"})})]}),(0,b.jsxs)(e.Card,{"data-testid":"card-stat-credits",children:[(0,b.jsxs)(e.CardHeader,{className:"pb-3",children:[(0,b.jsx)(e.CardDescription,{children:"Referral Credits"}),(0,b.jsxs)(e.CardTitle,{className:"text-3xl",children:["$",I.credits||0]})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)(p.Gift,{className:"w-4 h-4 text-muted-foreground"})})]})]}),(0,b.jsxs)(h.Tabs,{defaultValue:"appointments",className:"w-full",children:[(0,b.jsxs)(h.TabsList,{className:"grid w-full grid-cols-4","data-testid":"tabs-sections",children:[(0,b.jsx)(h.TabsTrigger,{value:"appointments","data-testid":"tab-appointments",children:"Appointments"}),(0,b.jsx)(h.TabsTrigger,{value:"invoices","data-testid":"tab-invoices",children:"Invoices"}),(0,b.jsx)(h.TabsTrigger,{value:"memberships","data-testid":"tab-memberships",children:"Memberships"}),(0,b.jsx)(h.TabsTrigger,{value:"referrals","data-testid":"tab-referrals",children:"Referrals"})]}),(0,b.jsx)(h.TabsContent,{value:"appointments",className:"space-y-4",children:(0,b.jsxs)(e.Card,{"data-testid":"card-appointments-list",children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Your Appointments"}),(0,b.jsx)(e.CardDescription,{children:"View and manage your scheduled services"})]}),(0,b.jsx)(e.CardContent,{children:I.appointments?.length>0?(0,b.jsx)("div",{className:"space-y-4",children:I.appointments.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg","data-testid":`appointment-${c}`,children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.serviceName||"Service"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.start?new Date(a.start).toLocaleDateString():"Date TBD"})]}),(0,b.jsx)(i.Badge,{"data-testid":`badge-appointment-status-${c}`,children:a.status||"Scheduled"})]},c))}):(0,b.jsx)("p",{className:"text-muted-foreground text-center py-8","data-testid":"text-no-appointments",children:"No appointments scheduled"})})]})}),(0,b.jsx)(h.TabsContent,{value:"invoices",className:"space-y-4",children:(0,b.jsxs)(e.Card,{"data-testid":"card-invoices-list",children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Your Invoices"}),(0,b.jsx)(e.CardDescription,{children:"View your service history and payments"})]}),(0,b.jsx)(e.CardContent,{children:I.invoices?.length>0?(0,b.jsx)("div",{className:"space-y-4",children:I.invoices.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg","data-testid":`invoice-${c}`,children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"font-medium",children:["Invoice #",a.number||c+1]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.date?new Date(a.date).toLocaleDateString():"Date unknown"})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("p",{className:"font-medium",children:["$",a.total||"0.00"]}),(0,b.jsx)(i.Badge,{variant:a.paid?"default":"secondary","data-testid":`badge-invoice-status-${c}`,children:a.paid?"Paid":"Pending"})]})]},c))}):(0,b.jsx)("p",{className:"text-muted-foreground text-center py-8","data-testid":"text-no-invoices",children:"No invoices available"})})]})}),(0,b.jsx)(h.TabsContent,{value:"memberships",className:"space-y-4",children:(0,b.jsxs)(e.Card,{"data-testid":"card-memberships-list",children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Your Memberships"}),(0,b.jsx)(e.CardDescription,{children:"Active membership plans and benefits"})]}),(0,b.jsx)(e.CardContent,{children:I.memberships?.length>0?(0,b.jsx)("div",{className:"space-y-4",children:I.memberships.map((a,c)=>(0,b.jsxs)("div",{className:"p-4 border rounded-lg","data-testid":`membership-${c}`,children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("p",{className:"font-medium",children:a.name||"VIP Membership"}),(0,b.jsx)(i.Badge,{"data-testid":`badge-membership-status-${c}`,children:a.status||"Active"})]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Expires: ",a.expiresAt?new Date(a.expiresAt).toLocaleDateString():"N/A"]})]},c))}):(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("p",{className:"text-muted-foreground mb-4","data-testid":"text-no-memberships",children:"No active memberships"}),(0,b.jsx)(d.Button,{variant:"outline","data-testid":"button-learn-membership",children:"Learn About VIP Membership"})]})})]})}),(0,b.jsx)(h.TabsContent,{value:"referrals",className:"space-y-4",children:(0,b.jsxs)(e.Card,{"data-testid":"card-referrals-list",children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Your Referrals"}),(0,b.jsxs)(e.CardDescription,{children:["Track your referrals and earn $",I.credits||0," in credits"]})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"p-4 bg-accent/10 rounded-lg text-center",children:[(0,b.jsx)(p.Gift,{className:"w-12 h-12 text-primary mx-auto mb-2"}),(0,b.jsx)("p",{className:"font-medium mb-1",children:"Refer friends and earn rewards!"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Get $25 off your next service for every referral"}),(0,b.jsx)(d.Button,{onClick:()=>N(!0),"data-testid":"button-submit-referral",children:"Submit a Referral"})]}),I.referrals?.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h3",{className:"font-medium text-sm",children:"Your Referrals"}),I.referrals.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg","data-testid":`referral-${c}`,children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-sm",children:a.name}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:a.status})]}),(0,b.jsx)(i.Badge,{variant:"secondary","data-testid":`badge-referral-status-${c}`,children:a.credited?"Credited":"Pending"})]},c))]})]})})]})})]})]}):(0,b.jsx)(e.Card,{children:(0,b.jsx)(e.CardContent,{className:"py-12 text-center",children:(0,b.jsx)("p",{className:"text-muted-foreground","data-testid":"text-no-data",children:"Unable to load account data"})})})})]}),(0,b.jsx)(j.Dialog,{open:M,onOpenChange:N,children:(0,b.jsxs)(j.DialogContent,{"data-testid":"dialog-referral-submission",children:[(0,b.jsxs)(j.DialogHeader,{children:[(0,b.jsx)(j.DialogTitle,{"data-testid":"text-referral-modal-title",children:"Submit a Referral"}),(0,b.jsx)(j.DialogDescription,{"data-testid":"text-referral-modal-description",children:"Refer a friend and earn $25 off your next service!"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"referral-name","data-testid":"label-referral-name",children:"Friend's Name *"}),(0,b.jsx)(f.Input,{id:"referral-name",placeholder:"John Doe",value:O,onChange:a=>P(a.target.value),"data-testid":"input-referral-name"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"referral-phone","data-testid":"label-referral-phone",children:"Friend's Phone *"}),(0,b.jsx)(f.Input,{id:"referral-phone",type:"tel",placeholder:"(512) 555-0123",value:Q,onChange:a=>R(a.target.value),"data-testid":"input-referral-phone"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"referral-email","data-testid":"label-referral-email",children:"Friend's Email (Optional)"}),(0,b.jsx)(f.Input,{id:"referral-email",type:"email",placeholder:"friend@example.com",value:S,onChange:a=>T(a.target.value),"data-testid":"input-referral-email"})]}),(0,b.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>N(!1),disabled:U,className:"flex-1","data-testid":"button-cancel-referral",children:"Cancel"}),(0,b.jsx)(d.Button,{onClick:_,disabled:U||!O.trim()||!Q.trim(),className:"flex-1","data-testid":"button-submit-referral-form",children:U?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(s.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Submitting..."]}):"Submit Referral"})]})]})]})})]})}a.s(["default",()=>u])}];

//# sourceMappingURL=app_portal_page_tsx_681d7b2c._.js.map
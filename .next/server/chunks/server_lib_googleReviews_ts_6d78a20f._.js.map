{"version":3,"sources":["turbopack:///[project]/server/lib/reviewCategorization.ts","turbopack:///[project]/server/lib/googleReviews.ts"],"sourcesContent":["// Auto-categorize reviews based on keywords in review text\n\nexport type ReviewCategory = \n  | 'water_heater'\n  | 'drain'\n  | 'toilet'\n  | 'leak'\n  | 'faucet'\n  | 'pipe'\n  | 'sewer'\n  | 'gas'\n  | 'backflow'\n  | 'slab_leak'\n  | 'repiping'\n  | 'garbage_disposal'\n  | 'general';\n\ninterface CategoryKeywords {\n  category: ReviewCategory;\n  keywords: string[];\n}\n\nconst categoryKeywords: CategoryKeywords[] = [\n  {\n    category: 'water_heater',\n    keywords: ['water heater', 'tankless', 'hot water', 'heater'],\n  },\n  {\n    category: 'drain',\n    keywords: ['drain', 'clog', 'unclog', 'backup', 'snake', 'clear'],\n  },\n  {\n    category: 'toilet',\n    keywords: ['toilet', 'commode', 'bowl', 'flush'],\n  },\n  {\n    category: 'leak',\n    keywords: ['leak', 'leaking', 'drip', 'dripping'],\n  },\n  {\n    category: 'faucet',\n    keywords: ['faucet', 'tap', 'sink'],\n  },\n  {\n    category: 'pipe',\n    keywords: ['pipe', 'piping', 'burst'],\n  },\n  {\n    category: 'sewer',\n    keywords: ['sewer', 'septic', 'main line'],\n  },\n  {\n    category: 'gas',\n    keywords: ['gas line', 'gas', 'natural gas'],\n  },\n  {\n    category: 'backflow',\n    keywords: ['backflow', 'back flow', 'cross connection'],\n  },\n  {\n    category: 'slab_leak',\n    keywords: ['slab leak', 'under slab', 'foundation'],\n  },\n  {\n    category: 'repiping',\n    keywords: ['repipe', 'repiping', 'replace pipe', 'new pipe'],\n  },\n  {\n    category: 'garbage_disposal',\n    keywords: ['garbage disposal', 'disposal', 'disposer'],\n  },\n];\n\n/**\n * Auto-categorize a review based on keywords in the review text\n * Returns an array of categories (can be multiple if review mentions multiple services)\n * Returns ['general'] if no specific service is mentioned\n */\nexport function categorizeReview(reviewText: string): ReviewCategory[] {\n  const lowerText = reviewText.toLowerCase();\n  const categories: ReviewCategory[] = [];\n\n  for (const { category, keywords } of categoryKeywords) {\n    const hasKeyword = keywords.some(keyword => lowerText.includes(keyword.toLowerCase()));\n    if (hasKeyword) {\n      categories.push(category);\n    }\n  }\n\n  // If no categories found, mark as general\n  if (categories.length === 0) {\n    return ['general'];\n  }\n\n  return categories;\n}\n\n/**\n * Filter reviews by category\n */\nexport function filterReviewsByCategory(\n  reviews: Array<{ categories?: string[] }>,\n  category: ReviewCategory\n): Array<{ categories?: string[] }> {\n  return reviews.filter(review => \n    review.categories && review.categories.includes(category)\n  );\n}\n","import type { InsertGoogleReview } from \"@shared/schema\";\nimport { categorizeReview } from \"./reviewCategorization\";\n\ninterface GooglePlacesReview {\n  author_name: string;\n  author_url?: string;\n  profile_photo_url?: string;\n  rating: number;\n  text: string;\n  relative_time_description: string;\n  time: number;\n}\n\ninterface GooglePlacesResponse {\n  result?: {\n    reviews?: GooglePlacesReview[];\n    rating?: number;\n    user_ratings_total?: number;\n  };\n  status: string;\n  error_message?: string;\n}\n\nexport async function fetchGoogleReviews(): Promise<InsertGoogleReview[]> {\n  const apiKey = process.env.GOOGLE_PLACES_API_KEY;\n  const placeId = process.env.GOOGLE_PLACE_ID;\n\n  if (!apiKey || !placeId) {\n    console.error(\"Missing Google Places API credentials\");\n    return [];\n  }\n\n  try {\n    const url = `https://maps.googleapis.com/maps/api/place/details/json?place_id=${placeId}&fields=reviews,rating,user_ratings_total&reviews_sort=newest&key=${apiKey}`;\n    \n    const response = await fetch(url);\n    const data: GooglePlacesResponse = await response.json();\n\n    if (data.status !== \"OK\") {\n      console.error(\"Google Places API error:\", data.status, data.error_message);\n      return [];\n    }\n\n    if (!data.result?.reviews) {\n      console.log(\"No reviews found for place\");\n      return [];\n    }\n\n    return data.result.reviews.map((review): InsertGoogleReview => {\n      const categories = categorizeReview(review.text);\n      \n      return {\n        authorName: review.author_name,\n        authorUrl: review.author_url || null,\n        profilePhotoUrl: review.profile_photo_url || null,\n        rating: review.rating,\n        text: review.text,\n        relativeTime: review.relative_time_description,\n        timestamp: review.time,\n        categories,\n        source: 'places_api',\n        reviewId: null,\n      };\n    });\n  } catch (error) {\n    console.error(\"Error fetching Google reviews:\", error);\n    return [];\n  }\n}\n\nexport function filterReviewsByKeywords(\n  reviews: InsertGoogleReview[], \n  keywords: string[]\n): InsertGoogleReview[] {\n  if (keywords.length === 0) return reviews;\n  \n  return reviews.filter(review => {\n    const reviewText = review.text.toLowerCase();\n    return keywords.some(keyword => reviewText.includes(keyword.toLowerCase()));\n  });\n}\n\nexport function getHighRatedReviews(\n  reviews: InsertGoogleReview[], \n  minRating: number = 4\n): InsertGoogleReview[] {\n  return reviews.filter(review => review.rating >= minRating);\n}\n"],"names":[],"mappings":"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"}